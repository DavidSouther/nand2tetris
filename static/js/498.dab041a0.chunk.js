"use strict";(self.webpackChunk_computron5k_web=self.webpackChunk_computron5k_web||[]).push([[498],{3498:function(t,e,n){n.r(e),n.d(e,{Chip:function(){return Zi},default:function(){return bi}});var i=n(649),r=n(2951),a=n(1976),s=n(3243),u=n(7597),o=n(7591),c=n(4337),l=n(1092),h=n(7791),d=n(1026),v=n(8061),f=n(6167),p=n(2502),m=n(1585),g=n(7878);function Z(t){return{pin:t,bits:(0,m.w)(0,t.width).map((function(e){return[e,t.voltage(e)]})).reverse()}}function b(t){return(0,i.Z)(t.entries()).map(Z)}var k=function(t){var e=t.sim,n=e.inPins,i=e.outPins,r=e.internalPins;return(0,g.jsx)("table",{className:"pinout",children:(0,g.jsxs)("tbody",{children:[(0,g.jsx)(x,{pins:n,header:p.ag._("{0, plural, one {Input pin} other {Input pins}}",{0:n.length}),toggle:t.toggle}),(0,g.jsx)(x,{pins:i,header:p.ag._("{0, plural, one {Output pin} other {Output pins}}",{0:i.length}),disabled:t.sim.pending}),(0,g.jsx)(x,{pins:r,header:p.ag._("{0, plural, one {Internal pin} other {Internal pins}}",{0:r.length}),disabled:t.sim.pending})]})})},x=function(t){return(0,g.jsxs)(g.Fragment,{children:[t.pins.length>0&&(0,g.jsx)("tr",{children:(0,g.jsx)("th",{colSpan:2,children:t.header})}),(0,i.Z)(t.pins).map((function(e){return(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{children:e.pin.name}),(0,g.jsx)("td",{children:(0,g.jsx)(y,{pin:e,toggle:t.toggle,disabled:t.disabled})})]},e.pin.name)}))]})},y=function(t){var e=t.pin,n=t.toggle,i=t.disabled,r=void 0!==i&&i;return(0,g.jsx)("fieldset",{role:"group",style:{width:"".concat(e.bits.length,"rem")},children:e.bits.map((function(t){var i=(0,d.Z)(t,2),a=i[0],s=i[1];return(0,g.jsx)("button",{onClick:function(){return null===n||void 0===n?void 0:n(e.pin,a)},disabled:r,"data-testid":"pin-".concat(a),children:s},a)}))})},w=n(726),j=n(4625),C=n(4408),S=n(5640),M=n(326),A="Unknown parse error",P={Base:S.Z.grammar('\nBase {\n  Root = Value*\n\n  At = at\n  Bang = bang\n  Bar = bar\n  CloseAngle = closeAngle\n  CloseBrace = closeBrace\n  CloseParen = closeParen\n  CloseSquare = closeSquare\n  Comma = comma\n  Dot = dot\n  DoubleQuote = doubleQuote\n  Equal = equal\n  OpenAngle = openAngle\n  OpenBrace = openBrace\n  OpenParen = openParen\n  OpenSquare = openSquare\n  Percent = percent\n  Semi = semi\n  Underscore = underscore\n\n  at = "@"\n  bang = "!"\n  bar = "|"\n  closeAngle = ">"\n  closeBrace = "}"\n  closeParen = ")"\n  closeSquare = "]"\n  comma = ","\n  dot = "."\n  doubleQuote = "\\""\n  equal = "="\n  minus = "-"\n  newline = "\\r"? "\\n"\n  openAngle = "<"\n  openBrace = "{"\n  openParen = "("\n  openSquare = "["\n  percent = "%"\n  semi = ";"\n  underscore = "_"\n\n  Value = identifier | number | boolean\n\n  boolean = true | false\n  True = true\n  False = false\n  true = "true"\n  false = "false"\n\n  Name = identifier\n  identifier = (letter|underscore) (alnum|underscore|"."|"$")*\n\n  Number = number\n  number = hexNumber | decNumber | binNumber\n  binNumber = ("%B") ("0"|"1")+\n  hexNumber = ("%X") hexDigit+\n  decNumber = ("%D")? (wholeDec | realDec)\n  wholeDec = minus? digit+\n  realDec = minus? digit* "." digit+\n\n  String = DoubleQuote (~doubleQuote any)* doubleQuote\n  \n  spaces := (lineComment | comment | space)*\n  commentStart = "/*"\n  commentEnd = "*/"\n  comment = commentStart (~commentEnd any)* commentEnd\n  lineCommentStart = "//"\n  lineComment = lineCommentStart (~"\\n" any)* "\\n"\n\n  List<elem, sep> = NonemptyListOf<elem, sep> sep?\n  EmptyList<elem, sep> = EmptyList<elem, sep> sep?\n}')},V=P.Base.createSemantics();function O(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(t){return t.root};return function(i){try{var r,a,s=t.match(i);if(s.succeeded()){var u=e(s),o=n(u);return(0,j.Ok)(o)}return(0,j.UG)({message:null!==(r=s.message)&&void 0!==r?r:A,shortMessage:null!==(a=s.shortMessage)&&void 0!==a?a:A})}catch(c){return(0,j.UG)(c)}}}V.extendOperation("asIteration",{List:function(t,e){return t.asIteration()}}),V.addAttribute("value",{decNumber:function(t,e){return(0,M.o5)(e.sourceString)},wholeDec:function(t,e){return(0,M.o5)(e.sourceString)},binNumber:function(t,e){return(0,M.C$)(e.sourceString)},hexNumber:function(t,e){return(0,M.Af)(e.sourceString)},Number:function(t){return t.value},Name:function(t){return t.name},identifier:function(t,e){return this.sourceString}}),V.addAttribute("name",{identifier:function(t,e){return this.sourceString},Name:function(t){var e;return null===(e=this.child(0))||void 0===e?void 0:e.name}}),V.addAttribute("String",{String:function(t,e,n){return e.sourceString}});var D='\nHdl <: Base{\n  Root := Chip\n  Chip = "CHIP" Name OpenBrace ChipBody CloseBrace\n  ChipBody = InList? OutList? PartList ClockedList?\n  InList = "IN" PinList Semi\n  OutList = "OUT" PinList Semi\n  PartList = BuiltinPart | Parts\n  PinList = List<PinDecl, Comma>\n  PinDecl = Name PinWidth?\n  PinWidth = OpenSquare decNumber CloseSquare\n  BuiltinPart = "BUILTIN" Semi\n  Parts = "PARTS:" Part*\n  Part = Name "(" Wires ")" Semi\n  Wires = List<Wire, Comma>\n  Wire = WireSide Equal (WireSide | True | False) \n  WireSide = Name SubBus? \n  SubBus = OpenSquare decNumber subBusRest? CloseSquare\n  subBusRest = ".." decNumber\n  ClockedList = "CLOCKED" SimplePinList Semi\n  SimplePinList = List<Name, Comma>\n}',N=S.Z.grammar(D,P),R=N.extendSemantics(V);R.addAttribute("SubBus",{SubBus:function(t,e,n,i){var r,a,s,u=e.value;return{start:u,end:null!==(r=null===(a=n.child(0))||void 0===a||null===(s=a.child(1))||void 0===s?void 0:s.value)&&void 0!==r?r:u}}}),R.addAttribute("WireSide",{WireSide:function(t,e){var n,i,r=t.name,a=null!==(n=null===(i=e.child(0))||void 0===i?void 0:i.SubBus)&&void 0!==n?n:{start:void 0,end:void 0};return{pin:r,start:a.start,end:a.end}}}),R.addAttribute("Wire",{Wire:function(t,e,n){var i=n.isTerminal()?{pin:n.sourceString}:n.WireSide;return{lhs:t.WireSide,rhs:i}}}),R.addAttribute("Wires",{Wires:function(t){return t.asIteration().children.map((function(t){return t.Wire}))}}),R.addAttribute("Part",{Part:function(t,e,n,i,r){return{name:t.name,wires:n.Wires}}}),R.addAttribute("Parts",{Parts:function(t,e){return e.children.map((function(t){return t.Part}))},BuiltinPart:function(t,e){return"BUILTIN"}}),R.addAttribute("PartList",{PartList:function(t){return t.Parts}}),R.addAttribute("Clocked",{ClockedList:function(t,e,n){var i;return null!==(i=e.asIteration().children.map((function(t){return t.sourceString})))&&void 0!==i?i:[]}}),R.addAttribute("PinDecl",{PinDecl:function(t,e){var n,i,r;return{pin:t.name,width:null!==(n=null===(i=e.child(0))||void 0===i||null===(r=i.child(1))||void 0===r?void 0:r.value)&&void 0!==n?n:1}}}),R.addAttribute("PinList",{PinList:function(t){return t.asIteration().children.map((function(t){return t.PinDecl}))}}),R.addAttribute("Chip",{Chip:function(t,e,n,i,r){var a,s,u,o,c,l,h,d;return{name:e.name,ins:null!==(a=null===(s=i.child(0).child(0))||void 0===s||null===(u=s.child(1))||void 0===u?void 0:u.PinList)&&void 0!==a?a:[],outs:null!==(o=null===(c=i.child(1).child(0))||void 0===c||null===(l=c.child(1))||void 0===l?void 0:l.PinList)&&void 0!==o?o:[],parts:null!==(h=i.child(2).PartList)&&void 0!==h?h:[],clocked:null===(d=i.child(3).child(0))||void 0===d?void 0:d.Clocked}}}),R.addAttribute("Root",{Root:function(t){var e;return null===(e=t.child(0))||void 0===e?void 0:e.Chip}});var F={parser:N,grammar:D,semantics:R,parse:O(N,R,(function(t){return t.Chip}))},I='\nTst <: Base {\n  Root := Tst\n  Tst = (TstStatement | TstRepeat | TstWhile)+\n\n  TstRepeat = Repeat Number? OpenBrace TstStatement+ CloseBrace\n  TstWhile = While Condition OpenBrace TstStatement+ CloseBrace\n  TstStatement = List<TstOperation, ","> (Semi | Bang)\n\n  TstOperation =\n    | TstOutputListOperation\n    | TstEvalOperation\n    | TstSetOperation\n    | TstOutputOperation\n    | TstEchoOperation\n    | TstClearEchoOperation\n    | TstLoadROMOperation\n\n  TstLoadROMOperation = ROM32K Load FileName\n  TstOutputListOperation = "output-list" OutputFormat+\n  OutputFormat = Name Index? percent FormatStyle wholeDec dot wholeDec dot wholeDec\n  TstSetOperation = Set Name Index? Number\n  Index = OpenSquare wholeDec? CloseSquare\n  Condition = Value CompareOp Value\n  TstEvalOperation = Eval | Tick | Tock\n  TstOutputOperation = Output\n  TstEchoOperation = Echo String\n  TstClearEchoOperation = ClearEcho\n\n  FileName = Name\n\n  Set = "set"\n  Eval = "eval"\n  Tick = "tick"\n  Tock = "tock"\n  Echo = "echo"\n  Repeat = "repeat"\n  ClearEcho = "clear-echo"\n  Output = "output"\n  OutputList = "output-list"\n  FormatStyle = "B"|"D"|"S"|"X"\n  ROM32K = "ROM32K"\n  Load = "load"\n  While = "while"\n\n  CompareOp = "<>" | "<=" | ">=" | "=" | "<" | ">"\n}',T=S.Z.grammar(I,P),E=T.extendSemantics(V);E.extendAttribute("value",{Index:function(t,e,n){var i,r;return null!==(i=null===e||void 0===e||null===(r=e.child(0))||void 0===r?void 0:r.value)&&void 0!==i?i:-1}}),E.extendAttribute("name",{FileName:function(t){return t.name}}),E.addAttribute("index",{Index:function(t,e,n){var i,r;return null!==(i=null===(r=e.child(0))||void 0===r?void 0:r.value)&&void 0!==i?i:0}}),E.addAttribute("format",{OutputFormat:function(t,e,n,i,r,a,s,u,o){var c,l,h=t.name,d=i.sourceString,v=r.value,f=s.value,p=o.value;return{id:h,builtin:void 0!==(null===e||void 0===e?void 0:e.child(0)),address:null!==(c=null===e||void 0===e||null===(l=e.child(0))||void 0===l?void 0:l.value)&&void 0!==c?c:-1,style:d,width:f,lpad:v,rpad:p}}}),E.addAttribute("operation",{TstEvalOperation:function(t){return{op:t.sourceString}},TstOutputOperation:function(t){return{op:"output"}},TstOutputListOperation:function(t,e){return{op:"output-list",spec:e.children.map((function(t){return t.format}))}},TstSetOperation:function(t,e,n,i){var r,a,s={op:"set",id:e.name,value:i.value},u=null===(r=n.child(0))||void 0===r||null===(a=r.child(1))||void 0===a?void 0:a.child(0);return u&&(s.index=u.value),s},TstEchoOperation:function(t,e){return{op:"echo",message:e.String}},TstClearEchoOperation:function(t){return{op:"clear-echo"}},TstLoadROMOperation:function(t,e,n){return{op:"load",file:n.name}}}),E.addAttribute("condition",{Condition:function(t,e,n){var i=t.value,r=e.sourceString;return{left:i,right:n.value,op:r}}}),E.addAttribute("statement",{TstWhile:function(t,e,n,i,r){return{statements:i.children.map((function(t){return t.statement})),condition:e.condition,span:{start:t.source.startIdx,end:e.source.endIdx}}},TstRepeat:function(t,e,n,i,r){var a,s;return{statements:i.children.map((function(t){return t.statement})),count:null!==(a=null===(s=e.child(0))||void 0===s?void 0:s.value)&&void 0!==a?a:-1,span:{start:t.source.startIdx,end:e.source.endIdx}}},TstStatement:function(t,e){var n={ops:t.asIteration().children.map((function(t){return t.operation})),span:{start:this.source.startIdx,end:this.source.endIdx}};return"!"===e.sourceString&&(n.break=!0),n}}),E.addAttribute("tst",{Tst:function(t){return{lines:t.children.map((function(t){return t.statement}))}}}),E.addAttribute("root",{Root:function(t){return t.tst}});var L,_,B={grammar:I,semantics:E,parser:T,parse:O(T,E)},W=n(7538),U=n(3943),H=n(9422),J=n(7169),K=n(4649),z=n(5541),G=n(1496),q=n(9810),$=function(){function t(){(0,r.Z)(this,t),(0,K.Z)(this,"level",Q),(0,K.Z)(this,"ticks",0),(0,K.Z)(this,"subject",new G.X({level:this.level,ticks:this.ticks})),(0,K.Z)(this,"frameSubject",new q.x),(0,K.Z)(this,"$",this.subject),(0,K.Z)(this,"frame$",this.frameSubject)}return(0,a.Z)(t,[{key:"isHigh",get:function(){return this.level===X}},{key:"isLow",get:function(){return this.level===Q}},{key:"next",value:function(){this.subject.next({level:this.level,ticks:this.ticks})}},{key:"reset",value:function(){this.level=Q,this.ticks=0,this.next()}},{key:"tick",value:function(){(0,z.hu)(this.level===Q,"Can only tick up from LOW"),this.level=X,this.next()}},{key:"tock",value:function(){(0,z.hu)(this.level===X,"Can only tock down from HIGH"),this.level=Q,this.ticks+=1,this.next()}},{key:"toggle",value:function(){this.level===X?this.tock():this.tick()}},{key:"eval",value:function(){this.tick(),this.tock()}},{key:"frame",value:function(){this.frameSubject.next()}},{key:"toString",value:function(){return"".concat(this.ticks).concat(this.level===X?"+":"")}}],[{key:"get",value:function(){return void 0===L&&(L=new t),L}}]),t}(),X=1,Q=0,Y=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;(0,r.Z)(this,t),(0,K.Z)(this,"name",void 0),(0,K.Z)(this,"width",void 0),(0,K.Z)(this,"state",void 0),(0,K.Z)(this,"next",[]),this.name=e,this.width=n,this.state=(0,m.w)(0,this.width).map((function(){return Q}))}return(0,a.Z)(t,[{key:"ensureWidth",value:function(t){(0,z.hu)(t<=16,"Cannot widen past 16 to ".concat(t," bits")),this.width<t&&(this.width=t,this.state=[].concat((0,i.Z)(this.state),(0,i.Z)((0,m.w)(this.width,t).map((function(){return Q})))))}},{key:"connect",value:function(t){this.next.push(t),t.busVoltage=this.busVoltage}},{key:"pull",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,z.hu)(e>=0&&e<this.width,"Bit out of bounds: ".concat(this.name,"@").concat(e)),this.state[e]=t,this.next.forEach((function(n){return n.pull(t,e)}))}},{key:"voltage",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(0,z.hu)(t>=0&&t<this.width),this.state[t]}},{key:"busVoltage",get:function(){var t=this;return(0,m.w)(0,this.width).reduce((function(e,n){return e|t.state[n]<<n}),0)},set:function(t){var e,n=this,i=(0,w.Z)((0,m.w)(0,this.width));try{for(i.s();!(e=i.n()).done;){var r=e.value;this.state[r]=(t&1<<r)>>r}}catch(a){i.e(a)}finally{i.f()}this.next.forEach((function(t){return t.busVoltage=n.busVoltage}))}},{key:"toggle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.voltage(t)===Q?X:Q;this.pull(e,t)}}]),t}(),tt=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(t,i){var a,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return(0,r.Z)(this,n),a=e.call(this,t.name),(0,K.Z)((0,J.Z)(a),"bus",void 0),(0,K.Z)((0,J.Z)(a),"start",void 0),(0,K.Z)((0,J.Z)(a),"width",void 0),a.bus=t,a.start=i,a.width=s,(0,z.hu)(i>=0&&i+s<=t.width,"Mismatched InSubBus dimensions on ".concat(t.name," (").concat(s," + ").concat(i," > ").concat(t.width,")")),a.connect(t),a}return(0,a.Z)(n,[{key:"pull",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,z.hu)(e>=0&&e<this.width),this.bus.pull(t,this.start+e)}},{key:"voltage",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(0,z.hu)(t>=0&&t<this.width),this.bus.voltage(this.start+t)}},{key:"busVoltage",get:function(){return this.bus.busVoltage>>this.start&dt(this.width)},set:function(t){var e=this.bus.busVoltage&~dt(this.width+this.start),n=this.bus.busVoltage&dt(this.start),i=(t&dt(this.width))<<this.start;this.bus.busVoltage=e|i|n}},{key:"connect",value:function(t){(0,z.hu)(this.start+this.width<=t.width,"Mismatched InSubBus connection dimensions (From ".concat(t.name," to ").concat(this.name,")")),this.bus=t}}]),n}(Y),et=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(t,i){var a,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return(0,r.Z)(this,n),a=e.call(this,t.name),(0,K.Z)((0,J.Z)(a),"bus",void 0),(0,K.Z)((0,J.Z)(a),"start",void 0),(0,K.Z)((0,J.Z)(a),"width",void 0),a.bus=t,a.start=i,a.width=s,(0,z.hu)(i>=0&&s<=t.width,"Mismatched OutSubBus dimensions"),a.connect(t),a}return(0,a.Z)(n,[{key:"busVoltage",get:function(){return this.bus.busVoltage&dt(this.width)},set:function(t){this.bus.busVoltage=(t&dt(this.width+this.start))>>this.start}},{key:"connect",value:function(t){(0,z.hu)(this.width<=t.width,"Mismatched OutSubBus connection dimensions"),this.bus=t}}]),n}(Y),nt=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(t,i){var a;return(0,r.Z)(this,n),a=e.call(this,t,16),(0,K.Z)((0,J.Z)(a),"value",void 0),a.value=i,a}return(0,a.Z)(n,[{key:"pullHigh",value:function(){}},{key:"pullLow",value:function(){}},{key:"voltage",value:function(){return 1&this.busVoltage}},{key:"busVoltage",get:function(){return this.value},set:function(t){}}]),n}(Y),it=new nt("true",65535),rt=new nt("false",0);function at(t){var e,n=null===(e=t.match((0,H.Z)(/([a-zA-Z]+)(\[(\d+)\])?/,{pin:1,w:3})))||void 0===e?void 0:e.groups,i=n.pin,r=n.w;return{pin:i,width:r?Number(r):1}}_=Symbol.iterator;var st=function(){function t(){(0,r.Z)(this,t),(0,K.Z)(this,"map",new Map)}return(0,a.Z)(t,[{key:"insert",value:function(t){var e=t.name;(0,z.hu)(!this.map.has(e),"Pins already has ".concat(e,"!")),this.map.set(e,t)}},{key:"emplace",value:function(t,e){if(this.has(t))return this.get(t);var n=new Y(t,e);return this.insert(n),n}},{key:"has",value:function(t){return this.map.has(t)}},{key:"get",value:function(t){return this.map.get(t)}},{key:"entries",value:function(){return this.map.values()}},{key:_,value:function(){return this.map[Symbol.iterator]()}}]),t}(),ut=0,ot=function(){function t(e,n,i){var a=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];(0,r.Z)(this,t),(0,K.Z)(this,"name",void 0),(0,K.Z)(this,"id",ut++),(0,K.Z)(this,"ins",new st),(0,K.Z)(this,"outs",new st),(0,K.Z)(this,"pins",new st),(0,K.Z)(this,"parts",new Set),(0,K.Z)(this,"clockedPins",void 0),this.name=i;var o,c=(0,w.Z)(e);try{for(c.s();!(o=c.n()).done;){var l=o.value,h=void 0!==l.pin?l:at(l),d=h.pin,v=h.width,f=void 0===v?1:v;this.ins.insert(new Y(d,f))}}catch(V){c.e(V)}finally{c.f()}var p,m=(0,w.Z)(n);try{for(m.s();!(p=m.n()).done;){var g=p.value,Z=void 0!==g.pin?g:at(g),b=Z.pin,k=Z.width,x=void 0===k?1:k;this.outs.insert(new Y(b,x))}}catch(V){m.e(V)}finally{m.f()}var y,j=(0,w.Z)(s);try{for(j.s();!(y=j.n()).done;){var C=y.value,S=void 0!==C.pin?C:at(C),M=S.pin,A=S.width,P=void 0===A?1:A;this.pins.insert(new Y(M,P))}}catch(V){j.e(V)}finally{j.f()}this.clockedPins=new Set(u),$.get().$.subscribe((function(){return a.eval()}))}return(0,a.Z)(t,[{key:"clocked",get:function(){if(this.clockedPins.size>0)return!0;var t,e=(0,w.Z)(this.parts);try{for(e.s();!(t=e.n()).done;){if(t.value.clocked)return!0}}catch(n){e.e(n)}finally{e.f()}return!1}},{key:"reset",value:function(){var t,e=(0,w.Z)(this.ins);try{for(e.s();!(t=e.n()).done;){var n=(0,d.Z)(t.value,2);n[0];n[1].busVoltage=0}}catch(a){e.e(a)}finally{e.f()}var i,r=(0,w.Z)(this.parts);try{for(r.s();!(i=r.n()).done;){i.value.reset()}}catch(a){r.e(a)}finally{r.f()}this.eval()}},{key:"in",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"in";return(0,z.hu)(this.hasIn(t),"No in pin ".concat(t)),this.ins.get(t)}},{key:"out",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"out";return(0,z.hu)(this.hasOut(t),"No in pin ".concat(t)),this.outs.get(t)}},{key:"hasIn",value:function(t){return this.ins.has(t)}},{key:"hasOut",value:function(t){return this.outs.has(t)}},{key:"pin",value:function(t){return(0,z.hu)(this.pins.has(t)),this.pins.get(t)}},{key:"get",value:function(t,e){return this.ins.has(t)?this.ins.get(t):this.outs.has(t)?this.outs.get(t):this.pins.has(t)?this.pins.get(t):this.getBuiltin(t,e)}},{key:"getBuiltin",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(vt.includes(t)){var n,i=(0,w.Z)(this.parts);try{for(i.s();!(n=i.n()).done;){var r=n.value,a=r.get(t,e);if(a)return a}}catch(s){i.e(s)}finally{i.f()}}}},{key:"isOutPin",value:function(t){return this.outs.has(t)}},{key:"wire",value:function(t,e){this.parts.add(t);var n,i=(0,w.Z)(e);try{for(i.s();!(n=i.n()).done;){var r=n.value,a=r.to,s=r.from;t.isOutPin(a.name)?this.wireOutPin(t,a,s):this.wireInPin(t,a,s)}}catch(u){i.e(u)}finally{i.f()}}},{key:"findPin",value:function(t,e){return"true"===t.toLowerCase()||"1"===t?it:"false"===t.toLowerCase()||"0"===t?rt:this.ins.has(t)?this.ins.get(t):this.outs.has(t)?this.outs.get(t):this.pins.emplace(t,e)}},{key:"wireOutPin",value:function(t,e,n){var i,r,a,s=(0,z.kP)(t.outs.get(e.name),(function(){return"Cannot wire to missing pin ".concat(e.name)}));null!==(i=e.width)&&void 0!==i||(e.width=s.width);var u=this.findPin(n.name,null!==(r=n.width)&&void 0!==r?r:e.width),o=this.pins.has(u.name);if(null!==(a=n.width)&&void 0!==a||(n.width=u.width),u instanceof nt)throw new Error("Cannot wire to constant bus");o&&u instanceof Y&&u.ensureWidth(n.start+n.width),(n.start>0||n.width!==u.width)&&(u=new tt(u,n.start,n.width)),(e.start>0||e.width!==u.width)&&(u=new et(u,e.start,e.width)),s.connect(u)}},{key:"wireInPin",value:function(t,e,n){var i,r,a,s=(0,z.kP)(t.ins.get(e.name),(function(){return"Cannot wire to missing pin ".concat(e.name)}));null!==(i=e.width)&&void 0!==i||(e.width=s.width);var u=this.findPin(n.name,null!==(r=n.width)&&void 0!==r?r:e.width);null!==(a=n.width)&&void 0!==a||(n.width=u.width),(e.start>0||e.width!==u.width)&&(s=new tt(s,e.start,e.width)),["true","false"].includes(u.name)||(n.start>0||n.width!==u.width)&&(s=new et(s,n.start,n.width)),u.connect(s)}},{key:"eval",value:function(){var t,e=(0,w.Z)(this.parts);try{for(e.s();!(t=e.n()).done;){t.value.eval()}}catch(n){e.e(n)}finally{e.f()}}},{key:"tick",value:function(){this.eval()}},{key:"tock",value:function(){this.eval()}},{key:"remove",value:function(){var t,e=(0,w.Z)(this.parts);try{for(e.s();!(t=e.n()).done;){t.value.remove()}}catch(n){e.e(n)}finally{e.f()}}},{key:"load",value:function(){var t=(0,h.Z)((0,l.Z)().mark((function t(e,n){var i,r,a;return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=(0,w.Z)(this.parts),t.prev=1,i.s();case 3:if((r=i.n()).done){t.next=10;break}if("ROM32K"!==(a=r.value).name){t.next=8;break}return t.next=8,a.load(e,n);case 8:t.next=3;break;case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(1),i.e(t.t0);case 15:return t.prev=15,i.f(),t.finish(15);case 18:case"end":return t.stop()}}),t,this,[[1,12,15,18]])})));return function(e,n){return t.apply(this,arguments)}}()}]),t}(),ct=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){var t;return(0,r.Z)(this,n),(t=e.call(this,[],[])).outs.insert(rt),t}return(0,a.Z)(n)}(ot),lt=new WeakMap,ht=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){var t;(0,r.Z)(this,n);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return t=e.call.apply(e,[this].concat(a)),(0,W.Z)((0,J.Z)(t),lt,{writable:!0,value:$.get().$.subscribe((function(e){e.level===Q?t.tock():t.tick()}))}),t}return(0,a.Z)(n,[{key:"clocked",get:function(){return!0}},{key:"remove",value:function(){(0,U.Z)(this,lt).unsubscribe(),(0,s.Z)((0,u.Z)(n.prototype),"remove",this).call(this)}}]),n}(ot);function dt(t){return Math.pow(2,t)-1}var vt=["Register","ARegister","DRegister","PC","RAM8","RAM64","RAM512","RAM4K","RAM16K","ROM32K","Screen","Keyboard","Memory"];var ft=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.call(this,["a","b"],["out"])}return(0,a.Z)(n,[{key:"eval",value:function(){var t=function(t,e){return[1===t&&1===e?X:Q]}(this.in("a").voltage(),this.in("b").voltage()),e=(0,d.Z)(t,1)[0];this.out().pull(e)}}]),n}(ot),pt=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.call(this,["a[16]","b[16]"],["out[16]"])}return(0,a.Z)(n,[{key:"eval",value:function(){var t=function(t,e){return[t&e&65535]}(this.in("a").busVoltage,this.in("b").busVoltage),e=(0,d.Z)(t,1)[0];this.out().busVoltage=e}}]),n}(ot);var mt=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.call(this,["in","sel"],["a","b"])}return(0,a.Z)(n,[{key:"eval",value:function(){var t=function(t,e){return[e===Q&&t===X?X:Q,e===X&&t===X?X:Q]}(this.in("in").voltage(),this.in("sel").voltage()),e=(0,d.Z)(t,2),n=e[0],i=e[1];this.out("a").pull(n),this.out("b").pull(i)}}]),n}(ot),gt=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.call(this,["in","sel[2]"],["a","b","c","d"])}return(0,a.Z)(n,[{key:"eval",value:function(){var t=function(t,e){return[0===e&&t===X?X:Q,1===e&&t===X?X:Q,2===e&&t===X?X:Q,3===e&&t===X?X:Q]}(this.in("in").voltage(),this.in("sel").busVoltage),e=(0,d.Z)(t,4),n=e[0],i=e[1],r=e[2],a=e[3];this.out("a").pull(n),this.out("b").pull(i),this.out("c").pull(r),this.out("d").pull(a)}}]),n}(ot),Zt=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.call(this,["in","sel[3]"],["a","b","c","d","e","f","g","h"])}return(0,a.Z)(n,[{key:"eval",value:function(){var t=function(t,e){return[0===e&&t===X?X:Q,1===e&&t===X?X:Q,2===e&&t===X?X:Q,3===e&&t===X?X:Q,4===e&&t===X?X:Q,5===e&&t===X?X:Q,6===e&&t===X?X:Q,7===e&&t===X?X:Q]}(this.in("in").voltage(),this.in("sel").busVoltage),e=(0,d.Z)(t,8),n=e[0],i=e[1],r=e[2],a=e[3],s=e[4],u=e[5],o=e[6],c=e[7];this.out("a").pull(n),this.out("b").pull(i),this.out("c").pull(r),this.out("d").pull(a),this.out("e").pull(s),this.out("f").pull(u),this.out("g").pull(o),this.out("h").pull(c)}}]),n}(ot);function bt(t,e,n){return[n===Q?t:e]}function kt(t,e,n,i,r){var a=1&r;return 0===(2&r)?bt(t,e,a):bt(n,i,a)}var xt=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.call(this,["a","b","sel"],["out"])}return(0,a.Z)(n,[{key:"eval",value:function(){var t=function(t,e,n){return[n===Q?t:e]}(this.in("a").voltage(),this.in("b").voltage(),this.in("sel").voltage()),e=(0,d.Z)(t,1)[0];this.out().pull(e)}}]),n}(ot),yt=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.call(this,["a[16]","b[16]","sel"],["out[16]"])}return(0,a.Z)(n,[{key:"eval",value:function(){var t=bt(this.in("a").busVoltage,this.in("b").busVoltage,this.in("sel").voltage()),e=(0,d.Z)(t,1)[0];this.out().busVoltage=e}}]),n}(ot),wt=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.call(this,["a[16]","b[16]","c[16]","d[16]","sel[2]"],["out[16]"])}return(0,a.Z)(n,[{key:"eval",value:function(){var t=kt(this.in("a").busVoltage,this.in("b").busVoltage,this.in("c").busVoltage,this.in("d").busVoltage,this.in("sel").busVoltage),e=(0,d.Z)(t,1)[0];this.out().busVoltage=e}}]),n}(ot),jt=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.call(this,["a[16]","b[16]","c[16]","d[16]","e[16]","f[16]","g[16]","h[16]","sel[3]"],["out[16]"])}return(0,a.Z)(n,[{key:"eval",value:function(){var t=function(t,e,n,i,r,a,s,u,o){var c=3&o;return 0===(4&o)?kt(t,e,n,i,c):kt(r,a,s,u,c)}(this.in("a").busVoltage,this.in("b").busVoltage,this.in("c").busVoltage,this.in("d").busVoltage,this.in("e").busVoltage,this.in("f").busVoltage,this.in("g").busVoltage,this.in("h").busVoltage,this.in("sel").busVoltage),e=(0,d.Z)(t,1)[0];this.out().busVoltage=e}}]),n}(ot);var Ct=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.call(this,["a","b"],["out"])}return(0,a.Z)(n,[{key:"eval",value:function(){var t=function(t,e){return[1===t&&1===e?Q:X]}(this.in("a").voltage(),this.in("b").voltage()),e=(0,d.Z)(t,1)[0];this.out().pull(e)}}]),n}(ot),St=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.call(this,["a[16]","b[16]"],["out[16]"])}return(0,a.Z)(n,[{key:"eval",value:function(){var t=this.in("a").busVoltage,e=this.in("b").busVoltage;this.out().busVoltage=(0,M.C2)(t,e)}}]),n}(ot);var Mt=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.call(this,["in"],["out"])}return(0,a.Z)(n,[{key:"eval",value:function(){var t=this.in("in").voltage(),e=[t===Q?X:Q],n=(0,d.Z)(e,1)[0];this.out().pull(n)}}]),n}(ot),At=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.call(this,["in[16]"],["out[16]"])}return(0,a.Z)(n,[{key:"eval",value:function(){var t=[65535&~this.in().busVoltage],e=(0,d.Z)(t,1)[0];this.out().busVoltage=e}}]),n}(ot);function Pt(t,e){return[1===t||1===e?X:Q]}var Vt=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.call(this,["a","b"],["out"])}return(0,a.Z)(n,[{key:"eval",value:function(){var t=Pt(this.in("a").voltage(),this.in("b").voltage()),e=(0,d.Z)(t,1)[0];this.out().pull(e)}}]),n}(ot),Ot=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.call(this,["a[16]","b[16]"],["out[16]"])}return(0,a.Z)(n,[{key:"eval",value:function(){var t=function(t,e){return[65535&(t|e)]}(this.in("a").busVoltage,this.in("b").busVoltage),e=(0,d.Z)(t,1)[0];this.out().busVoltage=e}}]),n}(ot),Dt=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.call(this,["in[8]"],["out"],"Or8way")}return(0,a.Z)(n,[{key:"eval",value:function(){var t=this.in().busVoltage,e=[0===(255&t)?Q:X],n=(0,d.Z)(e,1)[0];this.out().pull(n)}}]),n}(ot);var Nt=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.call(this,["a","b"],["out"])}return(0,a.Z)(n,[{key:"eval",value:function(){var t=function(t,e){return[t===X&&e===Q||t===Q&&e===X?X:Q]}(this.in("a").voltage(),this.in("b").voltage()),e=(0,d.Z)(t,1)[0];this.out().pull(e)}}]),n}(ot),Rt=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.call(this,["a[16]","b[16]"],["out[16]"])}return(0,a.Z)(n,[{key:"eval",value:function(){var t=function(t,e){return[65535&(t^e)]}(this.in("a").busVoltage,this.in("b").busVoltage),e=(0,d.Z)(t,1)[0];this.out().busVoltage=e}}]),n}(ot);function Ft(t,e){return[t+e&65535]}var It=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.call(this,["a[16]","b[16]"],["out[16]"],"Add16")}return(0,a.Z)(n,[{key:"eval",value:function(){var t=Ft(this.in("a").busVoltage,this.in("b").busVoltage),e=(0,d.Z)(t,1)[0];this.out().busVoltage=e}}]),n}(ot),Tt=n(6693),Et=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.call(this,["x[16]","y[16]","zx","nx","zy","ny","f","no"],["out[16]"],"ALU")}return(0,a.Z)(n,[{key:"eval",value:function(){var t=this.in("x").busVoltage,e=this.in("y").busVoltage,n=(this.in("zx").busVoltage<<5)+(this.in("nx").busVoltage<<4)+(this.in("zy").busVoltage<<3)+(this.in("ny").busVoltage<<2)+(this.in("f").busVoltage<<1)+(this.in("no").busVoltage<<0),i=(0,Tt.Bb)(n,t,e),r=(0,d.Z)(i,1)[0];this.out().busVoltage=r}}]),n}(ot),Lt=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.call(this,["x[16]","y[16]","zx","nx","zy","ny","f","no"],["out[16]","zr","ng"],"ALU")}return(0,a.Z)(n,[{key:"eval",value:function(){var t=this.in("x").busVoltage,e=this.in("y").busVoltage,n=(this.in("zx").busVoltage<<5)+(this.in("nx").busVoltage<<4)+(this.in("zy").busVoltage<<3)+(this.in("ny").busVoltage<<2)+(this.in("f").busVoltage<<1)+(this.in("no").busVoltage<<0),i=(0,Tt.Bb)(n,t,e),r=(0,d.Z)(i,2),a=r[0],s=r[1],u=s===Tt.vU.Negative?X:Q,o=s===Tt.vU.Zero?X:Q;this.out("out").busVoltage=a,this.out("ng").pull(u),this.out("zr").pull(o)}},{key:"op",value:function(){var t=(this.in("zx").busVoltage<<5)+(this.in("nx").busVoltage<<4)+(this.in("zy").busVoltage<<3)+(this.in("ny").busVoltage<<2)+(this.in("f").busVoltage<<1)+(this.in("no").busVoltage<<0);return t}}]),n}(ot);function _t(t,e){return[1===t&&0===e||0===t&&1===e?X:Q,1===t&&1===e?X:Q]}var Bt=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.call(this,["a","b"],["sum","carry"])}return(0,a.Z)(n,[{key:"eval",value:function(){var t=_t(this.in("a").voltage(),this.in("b").voltage()),e=(0,d.Z)(t,2),n=e[0],i=e[1];this.out("sum").pull(n),this.out("carry").pull(i)}}]),n}(ot);var Wt=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.call(this,["a","b","c"],["sum","carry"])}return(0,a.Z)(n,[{key:"eval",value:function(){var t=function(t,e,n){var i=_t(t,e),r=(0,d.Z)(i,2),a=r[0],s=r[1],u=_t(a,n),o=(0,d.Z)(u,2),c=o[0],l=Pt(s,o[1]);return[c,(0,d.Z)(l,1)[0]]}(this.in("a").voltage(),this.in("b").voltage(),this.in("c").voltage()),e=(0,d.Z)(t,2),n=e[0],i=e[1];this.out("sum").pull(n),this.out("carry").pull(i)}}]),n}(ot);var Ut=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.call(this,["in[16]"],["out[16]"],"Inc16")}return(0,a.Z)(n,[{key:"eval",value:function(){var t=this.in().busVoltage,e=Ft(t,1),n=(0,d.Z)(e,1)[0];this.out().busVoltage=n}}]),n}(ot),Ht=n(2648),Jt=n(7693),Kt='\nASM <: Base {\n  Root := ASM\n  ASM = Instruction*\n  \n  Instruction = Label|AInstruction|CInstruction\n  \n  Label = OpenParen identifier closeParen\n  AInstruction = at (identifier | decNumber)\n  CInstruction = assign? op jmp?\n  \n  assign = (\n      "AMD"\n      | "AM"\n      | "AD"\n      | "MD"\n      | "M"\n      | "D"\n      | "A"\n      ) equal\n      \n  op =\n      | "0" | "1" | "-1"\n      | "!D" | "!A" | "!M"\n      | "-D" | "-A" | "-M"\n      | "D+1" | "A+1" | "M+1"\n      | "D-1" | "A-1" | "M-1"\n      | "D+A" | "D+M"\n      | "D-A" | "D-M"\n      | "A-D" | "M-D"\n      | "D&A" | "D&M"\n      | "D|A" | "D|M"\n      | "D" | "A" | "M"\n\n\n  jmp = semi ("JGT" | "JEQ" | "JGE" | "JLT" | "JNE" | "JLE" | "JMP")\n}',zt=S.Z.grammar(Kt,P),Gt=zt.extendSemantics(V);function qt(t){return void 0!==t.label}Gt.addAttribute("root",{Root:function(t){return this.asm}}),Gt.addAttribute("asm",{Root:function(t){return{instructions:t.child(0).children.map((function(t){return t.instruction}))}}}),Gt.addAttribute("instruction",{AInstruction:function(t,e){try{return{type:"A",label:e.name}}catch(n){}try{return{type:"A",value:e.value}}catch(n){}throw new Error("AsmAInstruction must have either a name or a value")},CInstruction:function(t,e,n){var i,r,a,s,u=null===(i=t.child(0))||void 0===i||null===(r=i.child(0))||void 0===r?void 0:r.sourceString,o=e.sourceString.replace("M","A"),c=null===(a=n.child(0))||void 0===a||null===(s=a.child(1))||void 0===s?void 0:s.sourceString,l=t.sourceString.includes("M")||e.sourceString.includes("M"),h={type:"C",op:Tt.PH.asm[o],isM:l};return c&&(h.jump=Tt.lK.asm[c]),u&&(h.store=Tt.Uc.asm[u]),h},Label:function(t,e,n){return{type:"L",label:e.name}}});var $t={grammar:Kt,semantics:Gt,parser:zt,parse:O(zt,Gt),passes:{fillLabel:function(t){var e,n=16,i=new Map([["R0",0],["R1",1],["R2",2],["R3",3],["R4",4],["R5",5],["R6",6],["R7",7],["R8",8],["R9",9],["R10",10],["R11",11],["R12",12],["R13",13],["R14",14],["R15",15],["SP",0],["LCL",1],["ARG",2],["THIS",3],["THAT",4],["SCREEN",re],["KBD",ae]]),r=[],a=0,s=(0,w.Z)(t.instructions);try{for(s.s();!(e=s.n()).done;){var u=e.value;if("L"!==u.type)a+=1,"A"===u.type&&qt(u)&&r.push(u);else{if(i.has(u.label))throw new Error("ASM Duplicate label ".concat(u.label));i.set(u.label,a)}}}catch(o){s.e(o)}finally{s.f()}r.forEach((function(t){var e,r=(e=t.label,i.has(e)||(i.set(e,n),n+=1),(0,z.kP)(i.get(e),"Label not in symbols: ".concat(e)));t.value=r,delete t.label}))},emit:function(t){return t.instructions.map((function(t){if("A"===t.type){if(qt(t))throw new Error("ASM Emitting unfilled A instruction");return t.value}if("C"===t.type)return(0,Jt.p)(t.isM,t.op,t.store,t.jump)})).filter((function(t){return void 0!==t}))}}};function Xt(t,e){return Qt.apply(this,arguments)}function Qt(){return Qt=(0,h.Z)((0,l.Z)().mark((function t(e,n){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.endsWith(".hack")){t.next=2;break}return t.abrupt("return",ee(e,n));case 2:if(!n.endsWith(".asm")){t.next=4;break}return t.abrupt("return",Yt(e,n));case 4:throw new Error("Cannot load file without hack or asm extension ".concat(n));case 5:case"end":return t.stop()}}),t)}))),Qt.apply(this,arguments)}function Yt(t,e){return te.apply(this,arguments)}function te(){return te=(0,h.Z)((0,l.Z)().mark((function t(e,n){var i,r,a;return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.readFile(n);case 2:if(i=t.sent,r=$t.parse(i),!(0,j.dZ)(r)){t.next=6;break}throw(0,j.UG)(r);case 6:return a=(0,j.Ok)(r),$t.passes.fillLabel(a),t.abrupt("return",$t.passes.emit(a));case 9:case"end":return t.stop()}}),t)}))),te.apply(this,arguments)}function ee(t,e){return ne.apply(this,arguments)}function ne(){return ne=(0,h.Z)((0,l.Z)().mark((function t(e,n){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.readFile(n);case 2:return t.abrupt("return",t.sent.split("\n").filter((function(t){return""!==t.trim()})).map(M.C$));case 3:case"end":return t.stop()}}),t)}))),ne.apply(this,arguments)}var ie=["bin","dec","hex","asm"],re=16384,ae=24576,se=new WeakMap,ue=function(){function t(e){(0,r.Z)(this,t),(0,W.Z)(this,se,{writable:!0,value:void 0}),(0,K.Z)(this,"updates",new q.x),(0,Ht.Z)(this,se,new Int16Array(e))}return(0,a.Z)(t,[{key:"size",get:function(){return(0,U.Z)(this,se).length}},{key:"get",value:function(t){var e;return t<0||t>=this.size?65535:null!==(e=(0,U.Z)(this,se)[t])&&void 0!==e?e:0}},{key:"set",value:function(t,e){t>=0&&t<this.size&&((0,U.Z)(this,se)[t]=65535&e)}},{key:"update",value:function(t,e,n){var i;switch(n){case"asm":i=(0,Jt.op)(e);break;case"bin":i=(0,M.C$)(e);break;case"hex":i=(0,M.Af)(e);break;default:i=(0,M.o5)(e)}isFinite(i)&&i<=65535&&(this.set(t,i),this.updates.next())}},{key:"load",value:function(){var t=(0,h.Z)((0,l.Z)().mark((function t(e,n){var i=this;return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Xt(e,n);case 3:t.sent.map((function(t,e){return i.set(e,t)})),t.next=9;break;case 6:throw t.prev=6,t.t0=t.catch(0),new Error("Memory Failed to load file ".concat(n));case 9:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(e,n){return t.apply(this,arguments)}}()},{key:"range",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.size;return(0,i.Z)((0,U.Z)(this,se).slice(t,e))}},{key:"map",value:(0,l.Z)().mark((function t(e){var n,i,r,a=arguments;return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=a.length>1&&void 0!==a[1]?a[1]:0,i=a.length>2&&void 0!==a[2]?a[2]:this.size,(0,z.hu)(n<i),r=n;case 4:if(!(r<i)){t.next=10;break}return t.next=7,e(r,this.get(r));case 7:r++,t.next=4;break;case 10:case"end":return t.stop()}}),t,this)}))}]),t}(),oe=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(t,i){var a;return(0,r.Z)(this,n),a=e.call(this,["in[16]","load","address[".concat(t,"]")],["out[16]"],i),(0,K.Z)((0,J.Z)(a),"width",void 0),(0,K.Z)((0,J.Z)(a),"_memory",void 0),(0,K.Z)((0,J.Z)(a),"_nextData",0),(0,K.Z)((0,J.Z)(a),"_address",0),a.width=t,a._memory=new ue(Math.pow(2,a.width)),a}return(0,a.Z)(n,[{key:"memory",get:function(){return this._memory}},{key:"address",get:function(){return this._address}},{key:"tick",value:function(){var t=this.in("load").voltage();this._address=this.in("address").busVoltage,t&&(this._nextData=this.in().busVoltage,this._memory.set(this._address,this._nextData))}},{key:"tock",value:function(){var t,e;this.out().busVoltage=null!==(t=null===(e=this._memory)||void 0===e?void 0:e.get(this._address))&&void 0!==t?t:0}},{key:"eval",value:function(){var t,e,n=this.in("address").busVoltage;this.out().busVoltage=null!==(t=null===(e=this._memory)||void 0===e?void 0:e.get(n))&&void 0!==t?t:0}},{key:"at",value:function(t){var e=this;return(0,z.hu)(t<this._memory.size,(function(){return"Request out of bounds (".concat(t," >= ").concat(e._memory.size,")")})),new ce("".concat(this.name,"[").concat(t,"]"),t,this._memory)}}]),n}(ht),ce=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(t,i,a){var s;return(0,r.Z)(this,n),s=e.call(this,t),(0,K.Z)((0,J.Z)(s),"index",void 0),(0,K.Z)((0,J.Z)(s),"ram",void 0),s.index=i,s.ram=a,s}return(0,a.Z)(n,[{key:"busVoltage",get:function(){return this.ram.get(this.index)},set:function(t){this.ram.set(this.index,t)}}]),n}(Y),le=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(t){return(0,r.Z)(this,n),e.call(this,3,t)}return(0,a.Z)(n)}(oe),he=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(t){return(0,r.Z)(this,n),e.call(this,6,t)}return(0,a.Z)(n)}(oe),de=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(t){return(0,r.Z)(this,n),e.call(this,9,t)}return(0,a.Z)(n)}(oe),ve=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(t){return(0,r.Z)(this,n),e.call(this,12,t)}return(0,a.Z)(n)}(oe),fe=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(t){return(0,r.Z)(this,n),e.call(this,14,t)}return(0,a.Z)(n)}(oe);function pe(){return{A:0,D:0,PC:0,ALU:0,flag:Tt.vU.Zero}}var me=32768,ge=36864,Ze=36864,be=36864,ke=4032,xe=32800,ye=32784,we=32776,je=32769,Ce=32770,Se=32772;function Me(t){function e(e){return(t&e)===e}return{c:e(me),x1:e(ge),x2:e(Ze),am:e(be),op:(t&ke)>>6,d1:e(xe),d2:e(ye),d3:e(we),j1:e(je),j2:e(Ce),j3:e(Se)}}function Ae(t,e){var n=t.inM,i=t.instruction,r=e.A,a=e.D,s=e.PC,u=Me(i),o=u.am?n:r,c=(0,Tt.Bb)(u.op,a,o),l=(0,d.Z)(c,2);return[{A:r,D:a,PC:s+1,ALU:l[0],flag:l[1]},u.d3]}function Pe(t,e){var n=t.inM,i=t.instruction,r=t.reset,a=e.A,s=e.D,u=e.PC,o=e.ALU,c=e.flag,l=Me(i),h=l.j1&&c===Tt.vU.Positive,d=l.j2&&c===Tt.vU.Zero,v=l.j3&&c===Tt.vU.Negative;u=r?0:h||d||v?a:u,l.d2&&(s=o),l.c?l.d1&&(a=o):a=32767&i;var f=l.am?n:a,p=(0,Tt.Bb)(l.op,s,f);return o=p[0],c=p[1],[{addressM:a,outM:o,writeM:l.d3},{A:a,D:s,ALU:o,flag:c,PC:u}]}var Ve=new WeakMap,Oe=new WeakMap,De=new WeakMap,Ne=new WeakMap,Re=function(){function t(e){var n=e.RAM,i=void 0===n?new ue(32767):n,a=e.ROM;(0,r.Z)(this,t),(0,K.Z)(this,"RAM",void 0),(0,K.Z)(this,"ROM",void 0),(0,W.Z)(this,Ve,{writable:!0,value:0}),(0,W.Z)(this,Oe,{writable:!0,value:0}),(0,W.Z)(this,De,{writable:!0,value:0}),(0,W.Z)(this,Ne,{writable:!0,value:{A:0,D:0,PC:0,ALU:0,flag:Tt.vU.Zero}}),this.RAM=i,this.ROM=a}return(0,a.Z)(t,[{key:"state",get:function(){return(0,U.Z)(this,Ne)}},{key:"PC",get:function(){return(0,U.Z)(this,Ve)}},{key:"A",get:function(){return(0,U.Z)(this,Oe)}},{key:"D",get:function(){return(0,U.Z)(this,De)}},{key:"reset",value:function(){(0,Ht.Z)(this,Ve,0),(0,Ht.Z)(this,Oe,0),(0,Ht.Z)(this,De,0)}},{key:"tick",value:function(){var t=function(t,e){var n=Ae(t,e),i=(0,d.Z)(n,2),r=i[0];return i[1],Pe(t,r)}({inM:this.RAM.get((0,U.Z)(this,Oe)),instruction:this.ROM.get((0,U.Z)(this,Ve)),reset:!1},{A:(0,U.Z)(this,Oe),D:(0,U.Z)(this,De),PC:(0,U.Z)(this,Ve),ALU:(0,U.Z)(this,De),flag:Tt.vU.Zero}),e=(0,d.Z)(t,2),n=e[0],i=n.addressM,r=n.outM,a=n.writeM,s=e[1],u=s.A,o=s.D,c=s.PC;(0,Ht.Z)(this,Oe,u),(0,Ht.Z)(this,De,o),(0,Ht.Z)(this,Ve,c),a&&this.RAM.set(i,r)}}]),t}(),Fe=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.call(this,16,"ROM")}return(0,a.Z)(n,[{key:"load",value:function(){var t=(0,h.Z)((0,l.Z)().mark((function t(e,n){var i=this;return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Xt(e,n);case 3:t.sent.map((function(t,e){return i.at(e).busVoltage=t})),t.next=9;break;case 6:throw t.prev=6,t.t0=t.catch(0),new Error("ROM32K Failed to load file ".concat(n));case 9:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(e,n){return t.apply(this,arguments)}}()}]),n}(oe),Ie=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.call(this,13,"Screen")}return(0,a.Z)(n)}(oe);(0,K.Z)(Ie,"OFFSET",re);var Te=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.call(this,[],["out[16]"],"Keyboard")}return(0,a.Z)(n,[{key:"setKey",value:function(t){this.out().busVoltage=65535&t}},{key:"clearKey",value:function(){this.out().busVoltage=0}}]),n}(ot);(0,K.Z)(Te,"OFFSET",ae);var Ee=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){var t;return(0,r.Z)(this,n),t=e.call(this,["in[16]","load","address[15])"],["out[16]"],"Memory"),(0,K.Z)((0,J.Z)(t),"ram",new fe),(0,K.Z)((0,J.Z)(t),"screen",new Ie),(0,K.Z)((0,J.Z)(t),"keyboard",new Te),(0,K.Z)((0,J.Z)(t),"address",0),t.parts.add(t.keyboard),t.parts.add(t.screen),t.parts.add(t.ram),t}return(0,a.Z)(n,[{key:"tick",value:function(){var t=this.in("load").voltage();if(this.address=this.in("address").busVoltage,t){var e=this.in().busVoltage;this.address>=Te.OFFSET||(this.address>=Ie.OFFSET?this.screen.at(this.address-Ie.OFFSET).busVoltage=e:this.ram.at(this.address).busVoltage=e)}}},{key:"tock",value:function(){this.eval()}},{key:"eval",value:function(){if(this.ram){this.address=this.in("address").busVoltage;var t,e,n=0;if(this.address>=Te.OFFSET)n=null!==(t=null===(e=this.keyboard)||void 0===e?void 0:e.out().busVoltage)&&void 0!==t?t:0;else if(this.address>=Ie.OFFSET){var i,r;n=null!==(i=null===(r=this.screen)||void 0===r?void 0:r.at(this.address-Ie.OFFSET).busVoltage)&&void 0!==i?i:0}else{var a,s;n=null!==(a=null===(s=this.ram)||void 0===s?void 0:s.at(this.address).busVoltage)&&void 0!==a?a:0}this.out().busVoltage=n}}},{key:"in",value:function(t){if(null!==t&&void 0!==t&&t.startsWith("RAM16K")){var e,i,r,a=(0,M.o5)(null!==(e=null===(i=t.match((0,H.Z)(/\[(\d+)\]/,{idx:1})))||void 0===i||null===(r=i.groups)||void 0===r?void 0:r.idx)&&void 0!==e?e:"0");return this.ram.at(a)}if(null!==t&&void 0!==t&&t.startsWith("Screen")){var o,c,l,h=(0,M.o5)(null!==(o=null===(c=t.match((0,H.Z)(/\[(\d+)\]/,{idx:1})))||void 0===c||null===(l=c.groups)||void 0===l?void 0:l.idx)&&void 0!==o?o:"0");return this.screen.at(h)}return(0,s.Z)((0,u.Z)(n.prototype),"in",this).call(this,t)}},{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.startsWith("RAM16K")?this.at(16383&e):t.startsWith("Screen")?this.at(e&8191+Ie.OFFSET):t.startsWith("Keyboard")?this.at(Te.OFFSET):t.startsWith("Memory")?this.at(e):(0,s.Z)((0,u.Z)(n.prototype),"get",this).call(this,t,e)}},{key:"at",value:function(t){return t>=Te.OFFSET?this.keyboard.out():t>=Ie.OFFSET?this.screen.at(t-Ie.OFFSET):this.ram.at(t)}}]),n}(ht),Le=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){var t;return(0,r.Z)(this,n),t=e.call(this,["inM[16]","instruction[16]","reset"],["outM[16]","writeM","addressM[15]","pc[15]"]),(0,K.Z)((0,J.Z)(t),"_state",pe()),t}return(0,a.Z)(n,[{key:"state",get:function(){return this._state}},{key:"tick",value:function(){var t,e=Ae(this.cpuInput(),this._state),n=(0,d.Z)(e,2),i=n[0],r=n[1];this._state=i,this.out("writeM").pull(r?X:Q),this.out("outM").busVoltage=null!==(t=this._state.ALU)&&void 0!==t?t:0}},{key:"tock",value:function(){var t,e,n,i;if(this._state){var r=Pe(this.cpuInput(),this._state),a=(0,d.Z)(r,2),s=a[0],u=a[1];this._state=u,this.out("addressM").busVoltage=null!==(t=s.addressM)&&void 0!==t?t:0,this.out("outM").busVoltage=null!==(e=s.outM)&&void 0!==e?e:0,this.out("writeM").pull(s.writeM?X:Q),this.out("pc").busVoltage=null!==(n=null===(i=this._state)||void 0===i?void 0:i.PC)&&void 0!==n?n:0}}},{key:"cpuInput",value:function(){return{inM:this.in("inM").busVoltage,instruction:this.in("instruction").busVoltage,reset:1===this.in("reset").busVoltage}}},{key:"get",value:function(t,e){return null!==t&&void 0!==t&&t.startsWith("ARegister")?new nt("ARegister",this._state.A):null!==t&&void 0!==t&&t.startsWith("DRegister")?new nt("DRegister",this._state.D):null!==t&&void 0!==t&&t.startsWith("PC")?new nt("PC",this._state.PC):(0,s.Z)((0,u.Z)(n.prototype),"get",this).call(this,t,e)}},{key:"reset",value:function(){this._state=pe(),(0,s.Z)((0,u.Z)(n.prototype),"reset",this).call(this)}}]),n}(ht),_e=new WeakMap,Be=new WeakMap,We=new WeakMap,Ue=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){var t;return(0,r.Z)(this,n),t=e.call(this,["reset"],[]),(0,W.Z)((0,J.Z)(t),_e,{writable:!0,value:new Ee}),(0,W.Z)((0,J.Z)(t),Be,{writable:!0,value:new Fe}),(0,W.Z)((0,J.Z)(t),We,{writable:!0,value:new Le}),t.wire((0,U.Z)((0,J.Z)(t),We),[{from:{name:"reset",start:0},to:{name:"reset",start:0}},{from:{name:"instruction",start:0},to:{name:"instruction",start:0}},{from:{name:"outM",start:0},to:{name:"inM",start:0}},{from:{name:"writeM",start:0},to:{name:"writeM",start:0}},{from:{name:"addressM",start:0},to:{name:"addressM",start:0}}]),t.wire((0,U.Z)((0,J.Z)(t),Be),[{from:{name:"pc",start:0},to:{name:"address",start:0}},{from:{name:"instruction",start:0},to:{name:"out",start:0}}]),t.wire((0,U.Z)((0,J.Z)(t),_e),[{from:{name:"inM",start:0},to:{name:"in",start:0}},{from:{name:"writeM",start:0},to:{name:"load",start:0}},{from:{name:"addressM",start:0},to:{name:"address",start:0}},{from:{name:"outM",start:0},to:{name:"out",start:0}}]),t}return(0,a.Z)(n,[{key:"eval",value:function(){(0,s.Z)((0,u.Z)(n.prototype),"eval",this).call(this)}},{key:"get",value:function(t,e){return t.startsWith("PC")||t.startsWith("ARegister")||t.startsWith("DRegister")?(0,U.Z)(this,We).get(t):t.startsWith("RAM16K")?(0,U.Z)(this,_e).get(t,e):(0,s.Z)((0,u.Z)(n.prototype),"get",this).call(this,t,e)}},{key:"load",value:function(t,e){return(0,U.Z)(this,Be).load(t,e)}}]),n}(ot),He=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(t){var i;return(0,r.Z)(this,n),i=e.call(this,["in","load"],["out"],t),(0,K.Z)((0,J.Z)(i),"bit",Q),i}return(0,a.Z)(n,[{key:"tick",value:function(){this.in("load").voltage()===X&&(this.bit=this.in().voltage())}},{key:"tock",value:function(){var t;this.out().pull(null!==(t=this.bit)&&void 0!==t?t:0)}},{key:"reset",value:function(){this.bit=Q}}]),n}(ht),Je=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(t){var i;return(0,r.Z)(this,n),i=e.call(this,["in[16]","load"],["out[16]"],t),(0,K.Z)((0,J.Z)(i),"bits",0),i}return(0,a.Z)(n,[{key:"tick",value:function(){this.in("load").voltage()===X&&(this.bits=65535&this.in().busVoltage)}},{key:"tock",value:function(){this.out().busVoltage=65535&this.bits}},{key:"get",value:function(t,e){return t===this.name?this.out():(0,s.Z)((0,u.Z)(n.prototype),"get",this).call(this,t,e)}},{key:"reset",value:function(){this.bits=0}}]),n}(ht),Ke=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.apply(this,arguments)}return(0,a.Z)(n)}(Je),ze=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(t){var i;return(0,r.Z)(this,n),i=e.call(this,["in[16]","load","inc","reset"],["out[16]"],t),(0,K.Z)((0,J.Z)(i),"bits",0),i}return(0,a.Z)(n,[{key:"tick",value:function(){this.in("reset").voltage()===X?this.bits=0:this.in("load").voltage()===X?this.bits=65535&this.in().busVoltage:this.in("inc").voltage()===X&&(this.bits+=1)}},{key:"tock",value:function(){this.out().busVoltage=65535&this.bits}},{key:"get",value:function(t,e){return t===this.name?this.out():(0,s.Z)((0,u.Z)(n.prototype),"get",this).call(this,t,e)}},{key:"reset",value:function(){this.bits=0}}]),n}(ht),Ge=new Map([["Nand",Ct],["Nand16",St],["Not",Mt],["Not16",At],["And",ft],["And16",pt],["Or",Vt],["Or16",Ot],["Or8Way",Dt],["XOr",Nt],["XOr16",Rt],["Xor",Nt],["Xor16",Rt],["Mux",xt],["Mux16",yt],["Mux4Way16",wt],["Mux8Way16",jt],["DMux",mt],["DMux4Way",gt],["DMux8Way",Zt],["HalfAdder",Bt],["FullAdder",Wt],["Add16",It],["Inc16",Ut],["ALU",Lt],["ALUNoStat",Et],["DFF",function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(t){return(0,r.Z)(this,n),e.call(this,["in"],["out"],t,["t"])}return(0,a.Z)(n,[{key:"tick",value:function(){var t=this.in().voltage();this.pin("t").pull(t)}},{key:"tock",value:function(){var t=this.pin("t").voltage();this.out().pull(t)}}]),n}(ht)],["Bit",He],["Register",Je],["ARegister",Je],["DRegister",Je],["PC",ze],["RAM8",le],["RAM64",he],["RAM512",de],["RAM4K",ve],["RAM16K",fe],["ROM32K",Fe],["Screen",Ie],["Keyboard",Te],["CPU",Le],["Computer",Ue],["Memory",Ee],["ARegister",Ke],["DRegister",Ke]].map((function(t){var e=(0,d.Z)(t,2),n=e[0],i=e[1];return[n,function(){var t=new i;return t.name=n,t}]})));function qe(t){var e=Ge.get(t);return e?(0,j.Ok)(e()):(0,j.UG)(new Error("Chip ".concat(t," not in builtin registry")))}function $e(t,e){if(void 0!==e){if(e>=t)return e-t+1;if(t>0&&0===e)return 1;throw new Error("Bus specification has start > end (".concat(t," > ").concat(e,")"))}}function Xe(t){if("BUILTIN"===t.parts)return qe(t.name.toString());var e,n=new ot(t.ins.map((function(t){var e=t.pin,n=t.width;return{pin:e.toString(),width:n}})),t.outs.map((function(t){var e=t.pin,n=t.width;return{pin:e.toString(),width:n}})),t.name.toString(),[],t.clocked),i=(0,w.Z)(t.parts);try{for(i.s();!(e=i.n()).done;){var r=e.value,a=qe(r.name.toString());if((0,j.dZ)(a))return a;var s=(0,j.Ok)(a),u=r.wires.map((function(t){var e,n,i,r,a=t.lhs,s=t.rhs;return{to:{name:a.pin.toString(),start:null!==(e=a.start)&&void 0!==e?e:0,width:$e(null!==(n=a.start)&&void 0!==n?n:0,a.end)},from:{name:s.pin.toString(),start:null!==(i=s.start)&&void 0!==i?i:0,width:$e(null!==(r=s.start)&&void 0!==r?r:0,s.end)}}}));try{n.wire(s,u)}catch(o){return(0,j.UG)(o)}}}catch(c){i.e(c)}finally{i.f()}return(0,j.Ok)(n)}var Qe=n(9956),Ye=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"%B1.1.1",i=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,u=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;if((0,r.Z)(this,t),(0,K.Z)(this,"variable",void 0),(0,K.Z)(this,"fmt",void 0),(0,K.Z)(this,"lPad",void 0),(0,K.Z)(this,"rPad",void 0),(0,K.Z)(this,"len",void 0),(0,K.Z)(this,"index",void 0),(0,K.Z)(this,"builtin",void 0),this.variable=e,n.startsWith("%")&&void 0===i&&void 0===a&&void 0===s){var c,l=null===(c=n.match((0,H.Z)(/^%([BDXS])(\d+)\.(\d+)\.(\d+)$/,{fmt:1,lPad:2,len:3,rPad:4})))||void 0===c?void 0:c.groups,h=l.fmt,d=l.lPad,v=l.rPad,f=l.len;this.fmt=h,this.lPad=parseInt(d),this.rPad=parseInt(v),this.len=parseInt(f),this.builtin=!1,this.index=-1}else(0,z.hu)(["B","X","D","S"].includes(n[0])),this.fmt=n[0],this.len=null!==i&&void 0!==i?i:3,this.lPad=null!==a&&void 0!==a?a:1,this.rPad=null!==s&&void 0!==s?s:1,this.builtin=null!==u&&void 0!==u&&u,this.index=null!==o&&void 0!==o?o:-1}return(0,a.Z)(t,[{key:"header",value:function(t){var e="".concat(this.variable);if(this.builtin){var n=this.index>=0?this.index:"";e="".concat(e,"[").concat(n,"]")}return e.length>this.len+this.lPad+this.rPad?e.substring(0,this.len+this.lPad+this.rPad):this.padCenter(e)}},{key:"print",value:function(t){var e=t.getVar(this.variable,this.index);if("S"===this.fmt)return this.padLeft(e);var n=(0,{B:M.Ly,D:M.E_,X:M.$v}[this.fmt])(e);return"D"===this.fmt?this.padRight(n):this.padCenter(n.slice(n.length-this.len))}},{key:"padCenter",value:function(t){var e=this.lPad+this.len+this.rPad,n=Math.floor((e-t.length)/2),i=e-n-t.length,r=n+t.length,a=r+i;return t=(t=t.padStart(r)).padEnd(a)}},{key:"padLeft",value:function(t){t=t.substring(0,this.len);var e=this.rPad+this.len,n=this.lPad+e;return t=(t=t.padEnd(e)).padStart(n)}},{key:"padRight",value:function(t){t=t.substring(0,this.len);var e=this.lPad+this.len,n=this.rPad+e;return t=(t=t.padStart(e)).padEnd(n)}}]),t}(),tn=function(){function t(){(0,r.Z)(this,t),(0,K.Z)(this,"instructions",[]),(0,K.Z)(this,"_outputList",[]),(0,K.Z)(this,"_log",""),(0,K.Z)(this,"fs",new Qe.Wd),(0,K.Z)(this,"_steps",void 0),(0,K.Z)(this,"_step",void 0),(0,K.Z)(this,"breakpoints",new Map)}return(0,a.Z)(t,[{key:"setFileSystem",value:function(t){this.fs=t}},{key:"echo",value:function(t){}},{key:"clearEcho",value:function(){}},{key:"load",value:function(){var t=(0,h.Z)((0,l.Z)().mark((function t(e){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",void 0);case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"compareTo",value:function(){var t=(0,h.Z)((0,l.Z)().mark((function t(e){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",void 0);case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"outputFile",value:function(t){}},{key:"outputList",value:function(t){this._outputList=t}},{key:"addInstruction",value:function(t){this.instructions.push(t)}},{key:"reset",value:function(){var t=this;this._steps=(0,l.Z)().mark((function e(){var n,i,r;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(0,w.Z)(t.instructions),e.prev=1,n.s();case 3:if((i=n.n()).done){e.next=8;break}return r=i.value,e.delegateYield(r.steps(t),"t0",6);case 6:e.next=3;break;case 8:e.next=13;break;case 10:e.prev=10,e.t1=e.catch(1),n.e(e.t1);case 13:return e.prev=13,n.f(),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,10,13,16]])}))(),this._log=""}},{key:"steps",get:function(){if(void 0===this._steps&&this.reset(),void 0===this._steps)throw new Error("Reset did not initialize steps");return this._steps}},{key:"currentStep",get:function(){var t;return null===(t=this._step)||void 0===t?void 0:t.value}},{key:"step",value:function(){var t=(0,h.Z)((0,l.Z)().mark((function t(){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._step=this.steps.next(),this._step.done){t.next=5;break}return t.next=4,this._step.value.do(this);case 4:return t.abrupt("return",!1);case 5:return t.abrupt("return",!0);case 6:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"run",value:function(){var t=(0,h.Z)((0,l.Z)().mark((function t(){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.step();case 2:if(t.sent){t.next=6;break}t.next=0;break;case 6:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"addBreakpoint",value:function(t,e){this.breakpoints.set(t,e)}},{key:"clearBreakpoints",value:function(){this.breakpoints.clear()}},{key:"output",value:function(){var t=this,e=this._outputList.map((function(e){return e.print(t)}));this._log+="|".concat(e.join("|"),"|\n")}},{key:"header",value:function(){var t=this,e=this._outputList.map((function(e){return e.header(t)}));this._log+="|".concat(e.join("|"),"|\n")}},{key:"log",value:function(){return this._log}}]),t}();function en(t){return void 0!==t.ops}function nn(t){return void 0!==t.condition}var rn=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){var t;(0,r.Z)(this,n);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return t=e.call.apply(e,[this].concat(a)),(0,K.Z)((0,J.Z)(t),"chip",new ct),(0,K.Z)((0,J.Z)(t),"clock",$.get()),t}return(0,a.Z)(n,[{key:"with",value:function(t){return this.chip=t,this}},{key:"hasVar",value:function(t){return"time"===t||(t="".concat(t),this.chip.hasIn(t)||this.chip.hasOut(t))}},{key:"getVar",value:function(t,e){if("time"===(t="".concat(t)))return this.clock.toString();var n=this.chip.get(t,e);return n?n instanceof Y?n.busVoltage:n.voltage():0}},{key:"setVar",value:function(t,e,n){var i=this.chip.get(t,n);i instanceof Y?i.busVoltage=e:null===i||void 0===i||i.pull(0===e?Q:X)}},{key:"eval",value:function(){this.chip.eval()}},{key:"tick",value:function(){this.chip.eval(),this.clock.tick()}},{key:"tock",value:function(){this.chip.eval(),this.clock.tock()}},{key:"load",value:function(){var t=(0,h.Z)((0,l.Z)().mark((function t(e){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.chip.load(this.fs,e);case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"run",value:function(){var t=(0,h.Z)((0,l.Z)().mark((function t(){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.clock.reset(),t.next=3,(0,s.Z)((0,u.Z)(n.prototype),"run",this).call(this);case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}],[{key:"from",value:function(t){var e,i=new n,r=(0,w.Z)(t.lines);try{for(r.s();!(e=r.n()).done;){var a=e.value;if(en(a))i.addInstruction(n.makeLineStatement(a));else{var s=nn(a)?new hn(new ln(a.condition.left,a.condition.right,a.condition.op)):new cn(a.count);s.span=a.span,i.addInstruction(s);var u,o=(0,w.Z)(a.statements);try{for(o.s();!(u=o.n()).done;){var c=u.value;s.addInstruction(n.makeLineStatement(c))}}catch(l){o.e(l)}finally{o.f()}}}}catch(l){r.e(l)}finally{r.f()}return i}},{key:"makeLineStatement",value:function(t){var e=new on;e.span=t.span;var i,r=(0,w.Z)(t.ops);try{for(r.s();!(i=r.n()).done;){var a=i.value;e.addInstruction(n.makeInstruction(a))}}catch(s){r.e(s)}finally{r.f()}return e}},{key:"makeInstruction",value:function(t){var e=t.op;switch(e){case"tick":return new mn;case"tock":return new gn;case"eval":return new pn;case"output":return new sn;case"set":return new an(t.id,t.value,t.index);case"output-list":return new un(t.spec);case"echo":return new dn(t.message);case"clear-echo":return new vn;case"load":return new fn(t.file);default:(0,z.qV)(e,"Unknown tst operation ".concat(e))}}}]),n}(tn),an=function(){function t(e,n,i){(0,r.Z)(this,t),(0,K.Z)(this,"variable",void 0),(0,K.Z)(this,"value",void 0),(0,K.Z)(this,"index",void 0),this.variable=e,this.value=n,this.index=i}return(0,a.Z)(t,[{key:"do",value:function(t){t.setVar(this.variable,this.value,this.index)}},{key:"steps",value:(0,l.Z)().mark((function t(){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this;case 2:case"end":return t.stop()}}),t,this)}))}]),t}(),sn=function(){function t(){(0,r.Z)(this,t)}return(0,a.Z)(t,[{key:"do",value:function(t){t.output()}},{key:"steps",value:(0,l.Z)().mark((function t(){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this;case 2:case"end":return t.stop()}}),t,this)}))}]),t}(),un=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];(0,r.Z)(this,t),(0,K.Z)(this,"outputs",[]);var n,i=(0,w.Z)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;this.addOutput(a)}}catch(s){i.e(s)}finally{i.f()}}return(0,a.Z)(t,[{key:"addOutput",value:function(t){this.outputs.push(new Ye(t.id,t.style,t.width,t.lpad,t.rpad,t.builtin,t.address))}},{key:"do",value:function(t){t.outputList(this.outputs),t.header()}},{key:"steps",value:(0,l.Z)().mark((function t(){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this;case 2:case"end":return t.stop()}}),t,this)}))}]),t}(),on=function(){function t(){(0,r.Z)(this,t),(0,K.Z)(this,"instructions",[]),(0,K.Z)(this,"span",void 0)}return(0,a.Z)(t,[{key:"addInstruction",value:function(t){this.instructions.push(t)}},{key:"do",value:function(t){var e,n=(0,w.Z)(this.instructions);try{for(n.s();!(e=n.n()).done;){e.value.do(t)}}catch(i){n.e(i)}finally{n.f()}}},{key:"steps",value:(0,l.Z)().mark((function t(e){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this;case 2:case"end":return t.stop()}}),t,this)}))}]),t}(),cn=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(t){var i;return(0,r.Z)(this,n),i=e.call(this),(0,K.Z)((0,J.Z)(i),"repeat",void 0),i.repeat=t,i}return(0,a.Z)(n,[{key:"do",value:function(){}},{key:"innerSteps",value:(0,l.Z)().mark((function t(e){var n,i,r;return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=(0,w.Z)(this.instructions),t.prev=1,n.s();case 3:if((i=n.n()).done){t.next=8;break}return r=i.value,t.delegateYield(r.steps(e),"t0",6);case 6:t.next=3;break;case 8:t.next=13;break;case 10:t.prev=10,t.t1=t.catch(1),n.e(t.t1);case 13:return t.prev=13,n.f(),t.finish(13);case 16:case"end":return t.stop()}}),t,this,[[1,10,13,16]])}))},{key:"steps",value:(0,l.Z)().mark((function t(e){var n;return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(-1!==this.repeat){t.next=9;break}return t.next=3,this;case 3:return t.delegateYield(this.innerSteps(e),"t0",5);case 5:t.next=3;break;case 7:t.next=17;break;case 9:n=0;case 10:if(!(n<this.repeat)){t.next=17;break}return t.next=13,this;case 13:return t.delegateYield(this.innerSteps(e),"t1",14);case 14:n++,t.next=10;break;case 17:case"end":return t.stop()}}),t,this)}))}]),n}(on),ln=function(){function t(e,n,i){(0,r.Z)(this,t),(0,K.Z)(this,"x",void 0),(0,K.Z)(this,"y",void 0),(0,K.Z)(this,"op",void 0),this.x=e,this.y=n,this.op=i}return(0,a.Z)(t,[{key:"check",value:function(t){var e=t.hasVar(this.x)?t.getVar(this.x):this.x,n=t.hasVar(this.y)?t.getVar(this.y):this.y;if("string"===typeof e||"string"===typeof n)switch(this.op){case"=":return"".concat(e)==="".concat(n);case"<>":return"".concat(e)!=="".concat(n)}else switch(this.op){case"<":return e<n;case"<=":return e<=n;case">":return e>n;case">=":return e>=n;case"=":return e===n;case"<>":return e!==n}return!1}}]),t}(),hn=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(t){var i;return(0,r.Z)(this,n),i=e.call(this),(0,K.Z)((0,J.Z)(i),"condition",void 0),i.condition=t,i}return(0,a.Z)(n,[{key:"steps",value:(0,l.Z)().mark((function t(e){var n,i,r;return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.condition.check(e)){t.next=21;break}return t.next=3,this;case 3:n=(0,w.Z)(this.instructions),t.prev=4,n.s();case 6:if((i=n.n()).done){t.next=11;break}return r=i.value,t.delegateYield(r.steps(e),"t0",9);case 9:t.next=6;break;case 11:t.next=16;break;case 13:t.prev=13,t.t1=t.catch(4),n.e(t.t1);case 16:return t.prev=16,n.f(),t.finish(16);case 19:t.next=0;break;case 21:case"end":return t.stop()}}),t,this,[[4,13,16,19]])}))}]),n}(on),dn=function(){function t(e){(0,r.Z)(this,t),(0,K.Z)(this,"content",void 0),this.content=e}return(0,a.Z)(t,[{key:"do",value:function(t){t.echo(this.content)}},{key:"steps",value:(0,l.Z)().mark((function t(){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this;case 2:case"end":return t.stop()}}),t,this)}))}]),t}(),vn=function(){function t(){(0,r.Z)(this,t)}return(0,a.Z)(t,[{key:"do",value:function(t){t.clearEcho()}},{key:"steps",value:(0,l.Z)().mark((function t(){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this;case 2:case"end":return t.stop()}}),t,this)}))}]),t}(),fn=function(){function t(e){(0,r.Z)(this,t),(0,K.Z)(this,"file",void 0),this.file=e}return(0,a.Z)(t,[{key:"do",value:function(){var t=(0,h.Z)((0,l.Z)().mark((function t(e){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.fs.pushd("/samples"),t.next=3,e.load(this.file);case 3:e.fs.popd();case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"steps",value:(0,l.Z)().mark((function t(){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this;case 2:case"end":return t.stop()}}),t,this)}))}]),t}(),pn=function(){function t(){(0,r.Z)(this,t),(0,K.Z)(this,"_chipTestInstruction_",!0)}return(0,a.Z)(t,[{key:"do",value:function(t){t.eval()}},{key:"steps",value:(0,l.Z)().mark((function t(){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this;case 2:case"end":return t.stop()}}),t,this)}))}]),t}(),mn=function(){function t(){(0,r.Z)(this,t),(0,K.Z)(this,"_chipTestInstruction_",!0)}return(0,a.Z)(t,[{key:"do",value:function(t){t.tick()}},{key:"steps",value:(0,l.Z)().mark((function t(){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this;case 2:case"end":return t.stop()}}),t,this)}))}]),t}(),gn=function(){function t(){(0,r.Z)(this,t),(0,K.Z)(this,"_chipTestInstruction_",!0)}return(0,a.Z)(t,[{key:"do",value:function(t){t.tock()}},{key:"steps",value:(0,l.Z)().mark((function t(){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this;case 2:case"end":return t.stop()}}),t,this)}))}]),t}(),Zn=(0,f.createContext)(new Qe.Wd(new Qe.Cy)),bn=n(8016),kn=n(8870),xn=n(1408);function yn(t,e){return(0,f.useReducer)((function(e,n){return(0,xn.ZP)(e,(function(e){t[n.action](e,n.payload)}))}),e)}function wn(t){var e=(0,f.useState)(t),n=(0,d.Z)(e,2),i=n[0],r=n[1];return(0,f.useEffect)((function(){r(t)}),[t]),[i,r]}var jn=[["01",p.ag._("Project 1")],["02",p.ag._("Project 2")],["03",p.ag._("Project 3")],["05",p.ag._("Project 5")]];function Cn(t){return"CHIP ".concat(t," {\n  IN in;\n  OUT out;\n  PARTS:\n}")}function Sn(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{clocked:t.clocked,inPins:b(t.ins),outPins:b(t.outs),internalPins:b(t.pins),parts:new Set(t.parts),pending:e,invalid:n}}var Mn=$.get();function An(t,e,n,r){var a=function(t){var e,n,i=null!==(e=t["/chip/project"])&&void 0!==e?e:"01",r=kn.CHIP_PROJECTS[i];return{project:i,chips:r,chipName:null!==(n=t["/chip/chip"])&&void 0!==n?n:r[0]}}(n),s=a.project,u=a.chipName,o=a.chips,c=new ct,v=new rn,f=function(){var t={project:s,chips:o,chipName:u,hasBuiltin:Ge.has(u),runningTest:!1},n=qe(t.chipName);(0,j.dZ)(n)?e((0,C.j)((0,j.UG)(n))):c=(0,j.Ok)(n);var i=Sn(c);return setTimeout((function(){g.reloadChip()})),{controls:t,files:{hdl:"",cmp:"",tst:"",out:""},sim:i}}(),m={setFiles:function(t,e){var n=e.hdl,i=void 0===n?t.files.hdl:n,r=e.tst,a=void 0===r?t.files.tst:r,s=e.cmp,u=void 0===s?t.files.cmp:s,o=e.out,c=void 0===o?"":o;t.files.hdl=i,t.files.tst=a,t.files.cmp=u,t.files.out=c},updateChip:function(t,e){var n;t.sim=Sn(c,null===e||void 0===e?void 0:e.pending,null===e||void 0===e?void 0:e.invalid),t.controls.chips=kn.CHIP_PROJECTS[t.controls.project],t.controls.chipName=null!==(n=c.name)&&void 0!==n?n:u,t.controls.chips.includes(t.controls.chipName)||(t.controls.chips=[].concat((0,i.Z)(t.controls.chips),[t.controls.chipName]))},setProject:function(t,e){var n=kn.CHIP_PROJECTS[e],i=t.controls.chipName&&n.includes(t.controls.chipName)?t.controls.chipName:n[0];t.controls.project=e,t.controls.chips=n,this.setChip(t,i)},setChip:function(t,e){t.controls.chipName=e,t.controls.hasBuiltin=Ge.has(e)},testRunning:function(t){t.controls.runningTest=!0},testFinished:function(t){t.controls.runningTest=!1},updateTestStep:function(t){var e,n,i,r;t.files.out=null!==(e=null===(n=v)||void 0===n?void 0:n.log())&&void 0!==e?e:"",t.controls.span=null===(i=v)||void 0===i||null===(r=i.currentStep)||void 0===r?void 0:r.span,this.updateChip(t,{pending:t.sim.pending,invalid:t.sim.invalid})}},g={setProject:function(t){s=n["/chip/project"]=t,r.current({action:"setProject",payload:s}),this.setChip(kn.CHIP_PROJECTS[s][0])},setChip:function(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null!==(e=n["/chip/project"])&&void 0!==e?e:kn.ChipProjects["01"];u=n["/chip/chip"]=t,r.current({action:"setChip",payload:u}),this.loadChip(i,u)},reset:function(){$.get().reset(),c.reset(),v.reset(),r.current({action:"setFiles",payload:{}}),r.current({action:"updateChip"})},updateFiles:function(t){var n=t.hdl,i=t.tst,a=t.cmp;r.current({action:"setFiles",payload:{hdl:n,tst:i,cmp:a}});try{this.compileChip(n),this.compileTest(i)}catch(s){e((0,C.j)(s))}},compileChip:function(t){c.remove();var n=F.parse(t);if((0,j.dZ)(n))return e("Failed to parse chip"),void r.current({action:"updateChip",payload:{invalid:!0}});var i=Xe((0,j.Ok)(n));if((0,j.dZ)(i))return e((0,C.j)((0,j.UG)(i))),void r.current({action:"updateChip",payload:{invalid:!0}});e(p.ag._("Compiled {0}",{0:c.name})),this.replaceChip((0,j.Ok)(i))},replaceChip:function(t){var e,n=c.ins,i=(0,w.Z)(n);try{for(i.s();!(e=i.n()).done;){var a=(0,d.Z)(e.value,2),s=a[0],u=a[1].busVoltage,o=t.ins.get(s);o&&(o.busVoltage=u)}}catch(l){i.e(l)}finally{i.f()}Mn.reset(),t.eval(),c=t,r.current({action:"updateChip"})},loadChip:function(e,i){var a=this;return(0,h.Z)((0,l.Z)().mark((function s(){var u,o,c,h,v,f;return(0,l.Z)().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return n["/chip/chip"]=i,u=function(t){return"/projects/".concat(e,"/").concat(i,"/").concat(i,".").concat(t)},s.next=4,Promise.all([t.readFile(u("hdl")).catch((function(){return Cn(i)})),t.readFile(u("tst")).catch((function(t){return console.log(t),"repeat 10 {\n  tick,\n  tock;\n}"})),t.readFile(u("cmp")).catch((function(){return"| in|out|"}))]);case 4:o=s.sent,c=(0,d.Z)(o,3),h=c[0],v=c[1],f=c[2],r.current({action:"setFiles",payload:{hdl:h,tst:v,cmp:f}}),a.compileChip(h),a.compileTest(v);case 12:case"end":return s.stop()}}),s)})))()},saveChip:function(n){var i=arguments;return(0,h.Z)((0,l.Z)().mark((function a(){var o,c,h;return(0,l.Z)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return o=i.length>1&&void 0!==i[1]?i[1]:s,c=i.length>2&&void 0!==i[2]?i[2]:u,r.current({action:"setFiles",payload:{hdl:n}}),h="/projects/".concat(o,"/").concat(c,"/").concat(c,".hdl"),a.next=6,t.writeFile(h,n);case 6:e("Saved ".concat(h));case 7:case"end":return a.stop()}}),a)})))()},toggle:function(t,e){void 0!==e?t.busVoltage=t.busVoltage^1<<e:1===t.width?t.toggle():t.busVoltage+=1,r.current({action:"updateChip",payload:{pending:!0}})},eval:function(){c.eval(),r.current({action:"updateChip"})},clock:function(){Mn.toggle(),Mn.isLow&&Mn.frame(),r.current({action:"updateChip"})},useBuiltin:function(){var t=qe(u);(0,j.dZ)(t)?e("Failed to load builtin ".concat(u,": ").concat((0,C.j)((0,j.UG)(t)))):this.replaceChip((0,j.Ok)(t))},reloadChip:function(){this.loadChip(s,u)},compileTest:function(n){r.current({action:"setFiles",payload:{tst:n}});var i=B.parse(n);return(0,j.dZ)(i)?(e(p.ag._("Failed to parse test")),!1):(e(p.ag._("Parsed tst")),(v=rn.from((0,j.Ok)(i)).with(c)).setFileSystem(t),r.current({action:"updateTestStep"}),!0)},runTest:function(e){var n=this;return(0,h.Z)((0,l.Z)().mark((function i(){return(0,l.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(n.compileTest(e)){i.next=2;break}return i.abrupt("return");case 2:return r.current({action:"testRunning"}),t.pushd("/samples"),i.next=6,v.run();case 6:t.popd(),r.current({action:"updateTestStep"});case 8:case"end":return i.stop()}}),i)})))()},tick:function(){return(0,h.Z)((0,l.Z)().mark((function t(){var e;return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v.step();case 2:return e=t.sent,r.current({action:"updateTestStep"}),t.abrupt("return",e);case 5:case"end":return t.stop()}}),t)})))()}};return{initialState:f,reducers:m,actions:g}}var Pn="\nCmp <: Base {\n  Root := line*\n  line = bar cell+ newline?\n  cell = cellvalue bar\n  cellvalue = (~(bar|newline) any)*\n}",Vn=S.Z.grammar(Pn,P),On=Vn.extendSemantics(V);On.addAttribute("cell",{cell:function(t,e){return t.sourceString}}),On.addAttribute("line",{line:function(t,e,n){return e.children.map((function(t){return t.cell}))}}),On.addAttribute("root",{Root:function(t){return t.children.map((function(t){return t.line}))}});var Dn={grammar:Pn,semantics:On,parser:Vn,parse:O(Vn,On)},Nn=function(t){var e=t.className,n=void 0===e?"":e,i=t.out,r=t.cmp,a=Dn.parse(i),s=Dn.parse(r);if((0,j.dZ)(a))return(0,g.jsxs)("details",{children:[(0,g.jsx)("summary",{children:(0,g.jsx)(v.cC,{id:"Failed to parse output"})}),(0,g.jsx)("pre",{children:(0,C.j)((0,j.UG)(a))}),(0,g.jsx)("code",{children:(0,g.jsx)("pre",{children:i})})]});if((0,j.dZ)(s))return(0,g.jsxs)("details",{children:[(0,g.jsx)("summary",{children:(0,g.jsx)(v.cC,{id:"Failed to parse compare"})}),(0,g.jsxs)("code",{children:[(0,g.jsx)("pre",{children:(0,C.j)((0,j.UG)(s))}),(0,g.jsx)("pre",{children:r})]})]});var u=(0,j.Ok)(s),o=(0,j.Ok)(a),c=0,l=(0,m.w)(0,Math.min(u.length,o.length)).map((function(t){var e,n,i=null!==(e=u[t])&&void 0!==e?e:[],r=null!==(n=o[t])&&void 0!==n?n:[];return(0,m.w)(0,Math.max(i.length,r.length)).map((function(t,e){var n,a;return[null!==(n=i[e])&&void 0!==n?n:"",null!==(a=r[e])&&void 0!==a?a:""]})).map((function(t){var e=(0,d.Z)(t,2),n=e[0],i=e[1],r={cmp:null!==n&&void 0!==n?n:'"',out:null!==i&&void 0!==i?i:'"',pass:null!==(null===n||void 0===n?void 0:n.trim().match(/^\*+$/))||(null===i||void 0===i?void 0:i.trim())===(null===n||void 0===n?void 0:n.trim())};return r.pass||(c+=1),r}))}));return(0,g.jsxs)("div",{className:"scroll-x "+n,children:[(0,g.jsx)("p",{children:c>0&&(0,g.jsx)(v.cC,{id:"{failures, plural, zero {} one {{failures} failure} other {{failures} failures}}",values:{failures:c}})}),(0,g.jsx)("table",{style:{fontFamily:"var(--font-family-monospace)",marginBottom:"none"},children:(0,g.jsx)("tbody",{children:l.map((function(t,e){return(0,g.jsx)("tr",{children:t.map((function(t,e){var n=t.cmp,i=t.out,r=t.pass;return(0,g.jsx)(Rn,{cmp:n,out:i,pass:r},e)}))},e)}))})})]})},Rn=function(t){var e=t.cmp,n=t.out;return t.pass?(0,g.jsx)(g.Fragment,{children:(0,g.jsx)("td",{children:e})}):(0,g.jsx)(g.Fragment,{children:(0,g.jsxs)("td",{children:[(0,g.jsx)("ins",{children:e}),(0,g.jsx)("br",{}),(0,g.jsx)("del",{children:n})]})})},Fn=n(9659),In=n(7536),Tn=function(t){var e,n,i=t.error;return null!==i&&void 0!==i&&i.failed()?(0,g.jsxs)("details",{className:"ErrorPanel",open:!0,children:[(0,g.jsx)("summary",{role:"button",className:"secondary",children:(0,g.jsx)(v.cC,{id:"Parse Error"})}),(0,g.jsx)("pre",{children:(0,g.jsx)("code",{children:null!==(e=null!==(n=null===i||void 0===i?void 0:i.message)&&void 0!==n?n:null===i||void 0===i?void 0:i.shortMessage)&&void 0!==e?e:A})})]}):(0,g.jsx)(g.Fragment,{})},En=function(t){var e=t.value,n=t.onChange,i=t.language,r=t.disabled,a=void 0!==r&&r,s=(0,f.useState)(e),u=(0,d.Z)(s,2),o=u[0],c=u[1];return(0,g.jsx)("textarea",{"data-testid":"editor-".concat(i),disabled:a,value:o,onChange:function(t){var e,i=null===(e=t.target)||void 0===e?void 0:e.value;c(i),n(i)}})},Ln=function(t){var e=t.value,n=t.onChange,i=t.language,r=t.error,a=t.disabled,s=void 0!==a&&a,u=t.highlight,o=(0,f.useContext)(bn.Il).theme,c=(0,In.Ik)(),l=(0,f.useRef)(),h=(0,f.useRef)([]),d=(0,f.useCallback)((function(){return("system"===o?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"===o)?"vs-dark":"vs"}),[o]),v=(0,f.useCallback)((function(t){var e;l.current=t,null===(e=l.current)||void 0===e||e.updateOptions({fontFamily:'"JetBrains Mono", source-code-pro, Menlo, Monaco,\n      Consolas, "Roboto Mono", "Ubuntu Monospace", "Noto Mono", "Oxygen Mono",\n      "Liberation Mono", monospace, "Apple Color Emoji", "Segoe UI Emoji",\n      "Segoe UI Symbol", "Noto Color Emoji"',fontSize:16,minimap:{enabled:!1},theme:d(),scrollBeyondLastLine:!1})}),[d]);return(0,f.useEffect)((function(){if(l.current){var t=l.current.getModel(),e=[];if(t&&u){var n=t.getPositionAt(u.start),i=t.getPositionAt(u.end),r=null===c||void 0===c?void 0:c.Range.fromPositions(n,i);r&&(e.push({range:r,options:{inlineClassName:"highlight"}}),l.current.revealRangeInCenter(r))}h.current=l.current.deltaDecorations(h.current,e)}}),[l,u,c]),(0,f.useEffect)((function(){void 0!==l.current&&l.current.updateOptions({theme:d()})}),[l,d]),(0,f.useEffect)((function(){void 0!==l.current&&l.current.updateOptions({readOnly:s})}),[l,s]),(0,f.useEffect)((function(){var t,e,n,a,s;if(void 0!==l.current&&null!==c){var u=l.current.getModel();if(null!==u)if(void 0===r||r.succeeded())c.editor.setModelMarkers(u,i,[]);else{var o=null!==(t=null===(e=(0,H.Z)(/Line (\d+), col (\d+): (.*)/,{line:1,column:2,message:3}).exec(null!==(n=r.shortMessage)&&void 0!==n?n:""))||void 0===e?void 0:e.groups)&&void 0!==t?t:{line:1,column:1,message:"could not parse error"},h=o.line,d=o.column,v=o.message,f=Number(h),p=f,m=Number(d),g=m+(null!==(a=null===(s=u.getLineContent(f).substring(m-1).match(/([^\s]+)/))||void 0===s?void 0:s[0].length)&&void 0!==a?a:1);g<=m&&(g=m+1),c.editor.setModelMarkers(u,i,[{message:v,startColumn:m,startLineNumber:f,endColumn:g,endLineNumber:p,severity:8}])}}}),[r,l,c,i]),(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(In.ZP,{value:e,onChange:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return n(t)},language:i,onMount:v}),s&&(0,g.jsx)("div",{className:"overlay"})]})},_n=function(t){var e=t.className,n=void 0===e?"":e,i=t.style,r=void 0===i?{}:i,a=t.disabled,s=void 0!==a&&a,u=t.value,o=t.onChange,c=t.grammar,l=t.language,h=t.highlight,v=(0,f.useState)(),p=(0,d.Z)(v,2),m=p[0],Z=p[1],b=(0,f.useContext)(bn.Il).monaco,k=(0,f.useCallback)((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=c.match(t);Z(e.failed()?e:void 0)}),[Z,c]);(0,f.useEffect)((function(){return k(u)}),[k,u]);var x=(0,f.useMemo)((function(){return(0,Fn.D)(k,500)}),[k]),y=(0,f.useCallback)((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";o(t),x(t)}),[x,o]);return(0,g.jsx)("div",{className:"Editor ".concat(n),style:r,children:b.canUse&&b.wants?(0,g.jsx)(Ln,{value:u,onChange:y,language:l,error:m,disabled:s,highlight:h}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(En,{value:u,onChange:y,language:l,disabled:s}),(0,g.jsx)(Tn,{error:m})]})})},Bn=function(t){var e;return(0,g.jsxs)("article",{className:["panel",null!==(e=t.className)&&void 0!==e?e:""].join(" "),children:[t.header&&(0,g.jsx)("header",{children:t.header}),(0,g.jsx)("main",{children:t.children}),t.footer&&(0,g.jsx)("footer",{children:t.footer})]})},Wn=function(t){var e;return(0,g.jsxs)("details",{className:null!==(e=t.className)&&void 0!==e?e:"",open:t.open,style:t.style,children:[(0,g.jsx)("summary",{children:(0,g.jsx)("div",{className:"flex row align-baseline",children:t.summary})}),t.children]})};var Un=n(4351),Hn=function(t){var e=function(t){var e=(0,f.useRef)((function(){})),n=(0,f.useMemo)((function(){return function(t,e){var n={running:t.running,speed:t.speed,steps:t.steps},i=t.finishFrame.bind(t);return t.finishFrame=function(){i(),e.current({action:"update"})},{initialState:n,reducers:{update:function(e){e.running=t.running,e.speed=t.speed,e.steps=t.steps},setSteps:function(e,n){e.steps=n,t.steps=n},setSpeed:function(e,n){e.speed=n,t.speed=n}},actions:{frame:function(){t.frame()},start:function(){t.start(),e.current({action:"update"})},stop:function(){t.stop(),e.current({action:"update"})},reset:function(){t.reset(),e.current({action:"update"})}}}}(t,e)}),[t,e]),i=n.initialState,r=n.reducers,a=n.actions,s=yn(r,i),u=(0,d.Z)(s,2),o=u[0],c=u[1];return e.current=c,{state:o,dispatch:e.current,actions:a}}(t.runner);return(0,g.jsxs)("fieldset",{role:"group",children:[(0,g.jsx)("button",{className:"flex-0",onClick:function(){return e.actions.frame()},"data-tooltip":p.ag._("Step"),"data-placement":"bottom",children:(0,g.jsx)(Un.J,{name:"play_arrow"})}),(0,g.jsx)("button",{className:"flex-0",onClick:function(){return e.state.running?e.actions.stop():e.actions.start()},"data-tooltip":e.state.running?p.ag._("Pause"):p.ag._("Play"),"data-placement":"bottom",children:(0,g.jsx)(Un.J,{name:e.state.running?"pause":"fast_forward"})}),(0,g.jsx)("button",{className:"flex-0",onClick:function(){return e.actions.reset()},"data-tooltip":p.ag._("Reset"),"data-placement":"bottom",children:(0,g.jsx)(Un.J,{name:"fast_rewind"})}),(0,g.jsx)("select",{className:"flex-1",name:"speed",value:e.state.speed,onChange:function(t){var n,i;e.dispatch({action:"setSpeed",payload:Number(null!==(n=null===(i=t.target)||void 0===i?void 0:i.value)&&void 0!==n?n:e.state.speed)})},disabled:e.state.running,children:[[16,p.ag._("60FPS")],[500,p.ag._("Fast")],[1e3,p.ag._("Normal")],[2e3,p.ag._("Slow")]].map((function(t){var e=(0,d.Z)(t,2),n=e[0],i=e[1];return(0,g.jsx)("option",{value:n,children:i},n)}))}),(0,g.jsx)("select",{className:"flex-1",name:"steps",value:e.state.steps,onChange:function(t){var n,i;e.dispatch({action:"setSteps",payload:Number(null!==(n=null===(i=t.target)||void 0===i?void 0:i.value)&&void 0!==n?n:e.state.steps)})},disabled:e.state.running,children:[[1,p.ag._("1 Step")],[500,"500"],[1e3,"1000"],[2e3,"2000"]].map((function(t){var e=(0,d.Z)(t,2),n=e[0],i=e[1];return(0,g.jsx)("option",{value:n,children:i},n)}))}),t.children]})},Jn=$.get(),Kn=new WeakMap,zn=new WeakMap,Gn=new WeakMap,qn=new WeakMap,$n=function(){function t(){var e=this;(0,r.Z)(this,t),(0,K.Z)(this,"steps",1),(0,K.Z)(this,"speed",1e3),(0,W.Z)(this,Kn,{writable:!0,value:!1}),(0,W.Z)(this,zn,{writable:!0,value:0}),(0,W.Z)(this,Gn,{writable:!0,value:0}),(0,W.Z)(this,qn,{writable:!0,value:function(){var t=(0,h.Z)((0,l.Z)().mark((function t(){var n,i,r,a;return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((0,U.Z)(e,Kn)){t.next=2;break}return t.abrupt("return");case 2:if(n=Date.now(),i=n-(0,U.Z)(e,Gn),(0,Ht.Z)(e,Gn,n),(0,Ht.Z)(e,zn,(0,U.Z)(e,zn)+i),!((0,U.Z)(e,zn)>e.speed)){t.next=19;break}r=!1,a=0;case 9:if(!(a<Math.min(e.steps,1e3))||r){t.next=16;break}return t.next=12,e.tick();case 12:r=t.sent;case 13:a++,t.next=9;break;case 16:e.finishFrame(),r&&e.stop(),(0,Ht.Z)(e,zn,(0,U.Z)(e,zn)-e.speed);case 19:requestAnimationFrame((0,U.Z)(e,qn));case 20:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()})}return(0,a.Z)(t,[{key:"frame",value:function(){this.tick(),this.finishFrame()}},{key:"finishFrame",value:function(){Jn.frame()}},{key:"running",get:function(){return(0,U.Z)(this,Kn)}},{key:"start",value:function(){(0,Ht.Z)(this,Kn,!0),(0,Ht.Z)(this,Gn,Date.now()-this.speed),(0,U.Z)(this,qn).call(this),this.toggle()}},{key:"stop",value:function(){(0,Ht.Z)(this,Kn,!1),this.toggle()}}]),t}();function Xn(){return(0,C.j)($.get())}var Qn=function(){var t=function(){var t=(0,f.useState)(Xn()),e=(0,d.Z)(t,2),n=e[0],i=e[1];return(0,f.useEffect)((function(){var t=$.get().$.subscribe((function(){i(Xn())}));return function(){return t.unsubscribe()}}),[]),n}();return(0,g.jsx)("span",{style:{whiteSpace:"nowrap"},children:t})},Yn=function(t){var e,n=t.A,i=t.op,r=t.D,a=t.out,s=t.flag;return(0,g.jsxs)("div",{children:[(0,g.jsx)("span",{children:"ALU"}),(0,g.jsxs)("dl",{children:[(0,g.jsx)("dt",{children:"A"})," ",(0,g.jsx)("dd",{children:(0,M.Ly)(n)}),(0,g.jsx)("dt",{children:"op"})," ",(0,g.jsx)("dd",{children:null!==(e=Tt.PH.op[i])&&void 0!==e?e:"(??)"}),(0,g.jsx)("dt",{children:"D"})," ",(0,g.jsx)("dd",{children:(0,M.Ly)(r)}),(0,g.jsx)("dt",{children:"="})," ",(0,g.jsx)("dd",{children:(0,M.Ly)(a)}),(0,g.jsx)("dd",{children:Tt.vU[s]})]})]})},ti=function(t){var e=t.name,n=t.bits;return(0,g.jsxs)("div",{children:[e,": ",(0,M.E_)(n)]})},ei={Enter:128,Backspace:129,ArrowLeft:130,ArrowUp:131,ArrowRight:132,ArrowDown:133,Home:134,End:135,PageUp:136,PageDown:137,Insert:138,Delete:139,Escape:140,F1:141,F2:142,F3:143,F4:144,F5:145,F6:146,F7:147,F8:148,F9:149,F10:150,F11:151,F12:152};var ni=function(t){var e=t.keyboard,n=(0,f.useState)(!1),i=(0,d.Z)(n,2),r=i[0],a=i[1],s=(0,f.useState)(e.out().busVoltage),u=(0,d.Z)(s,2),o=u[0],c=u[1],l=(0,f.useCallback)((function(t){var n=function(t){var e=ei[t.key];if(void 0!==e)return e;if(1===t.key.length){var n=t.key.charCodeAt(0);if(n>=32&&n<=126)return n}return 0}(t);0!==n&&(t.preventDefault(),e.setKey(n),c(e.out().busVoltage),a(!1))}),[e,a,c]),h=(0,f.useCallback)((function(){a(!0)}),[]);return(0,g.jsxs)("div",{className:"flex row align-baseline",children:[(0,g.jsx)("div",{className:"flex-1",children:(0,g.jsx)(ti,{name:"Keyboard",bits:o})}),(0,g.jsx)("div",{className:"flex-1",children:r?(0,g.jsx)("input",{ref:function(t){return null===t||void 0===t?void 0:t.focus()},type:"text",onKeyDown:l}):(0,g.jsx)("button",{onClick:h,children:(0,g.jsx)(Un.J,{name:"keyboard"})})})]})},ii=n(189),ri=n(8039),ai=n(8285),si=0,ui=1,oi=function(t){var e,n=(0,f.useState)(null!==(e=t.mode)&&void 0!==e?e:si),i=(0,d.Z)(n,2),r=i[0],a=i[1],s=wn(t.value),u=(0,d.Z)(s,2),o=u[0],c=u[1],l=function(){return(0,g.jsx)("span",{style:(0,ii.Z)({cursor:"text"},(0,ai.b)("full","inline")),onClick:function(){a(ui)},children:o})},h=(0,f.useCallback)((function(t){return null===t||void 0===t?void 0:t.select()}),[]),v=(0,f.useCallback)((function(e){var n,i;a(si),c(null!==(n=e.value)&&void 0!==n?n:""),t.onChange(null!==(i=e.value)&&void 0!==i?i:"")}),[t,a,c]),p=function(){var t=(0,g.jsx)("span",{style:{display:"block",position:"relative"},children:(0,g.jsx)("input",{ref:h,style:{zIndex:"10",position:"absolute",left:"0",marginTop:"-0.375rem"},onBlur:function(t){var e=t.target;return v(e)},onKeyPress:function(t){var e=t.key,n=t.target;"Enter"===e&&v(n)},type:"text",defaultValue:o})});return t};return function(){switch(r){case ui:return p();case si:return l();default:return(0,g.jsx)("span",{})}}()};function ci(t,e,n){var r=e.totalHeight,a=e.toleranceHeight,s=e.bufferedItems,u=e.settings,o=u.itemHeight,c=u.minIndex,l=u.maxIndex,h=c+Math.floor((t-a)/o),d=function(t,e,n,r,a){var s=Math.max(0,t,n),u=a(s,Math.min(e,n+r-1)-s);return(0,i.Z)(u)}(c,l,h,s,n),v=Math.max((h-c)*o,0);return{scrollTop:t,topPaddingHeight:v,bottomPaddingHeight:Math.max(r-(v+d.length*o),0),data:d}}var li=function(t){var e,n=(0,f.useRef)(null),i=(0,f.useMemo)((function(){var e,n=function(t){var e=t.minIndex,n=void 0===e?0:e,i=t.maxIndex,r=void 0===i?Number.MAX_SAFE_INTEGER:i,a=t.startIndex,s=void 0===a?0:a,u=t.itemHeight,o=void 0===u?20:u,c=t.count,l=void 0===c?r-n+1:c,h=t.tolerance;return{minIndex:n,maxIndex:r,startIndex:s,itemHeight:o,count:l,tolerance:void 0===h?l:h}}(null!==(e=t.settings)&&void 0!==e?e:{}),i=function(t,e){var n=t.minIndex,i=t.maxIndex,r=t.startIndex,a=t.itemHeight,s=t.count,u=t.tolerance,o=s+2*u,c=s*a,l=(i-n+1)*a,h=u*a,d=Math.max(0,r-u-n)*a,v={scrollTop:0,settings:t,viewportHeight:c,totalHeight:l,toleranceHeight:h,bufferedItems:o,topPaddingHeight:d,bottomPaddingHeight:l-(d+(c+2*h)),data:[]};return(0,ii.Z)((0,ii.Z)({},v),ci(d+h,v,e))}(n,t.get),r=function(t){return function(e,n){return(0,ii.Z)((0,ii.Z)({},e),ci(n,e,t))}}(t.get);return{settings:n,reducer:r,startState:i}}),[t.settings,t.get]),r=i.settings,a=i.startState,s=i.reducer,u=(0,f.useReducer)(s,a),o=(0,d.Z)(u,2),c=o[0],l=o[1];(0,f.useEffect)((function(){null!==n.current&&l(n.current.scrollTop)}),[r,t.row]);var h=(0,f.useCallback)((function(t){t&&(t.scrollTop=n.current?n.current.scrollTop:r.startIndex*r.itemHeight),n.current=t}),[n,r.startIndex,r.itemHeight]),v=c.data.map((function(e){return(0,g.jsx)("div",{style:{height:"".concat(r.itemHeight,"px")},children:t.row(e)},t.rowKey(e))}));return(0,g.jsxs)("div",{ref:h,style:{height:"".concat(c.viewportHeight,"px"),overflowY:"scroll",overflowAnchor:"none"},className:null!==(e=t.className)&&void 0!==e?e:"",onScroll:function(t){return l(t.target.scrollTop)},children:[(0,g.jsx)("div",{style:{height:"".concat(c.topPaddingHeight,"px")}}),v,(0,g.jsx)("div",{style:{height:"".concat(c.bottomPaddingHeight,"px")}})]})},hi=function(t){var e=t.memory,n=t.jmp,i=void 0===n?{value:0}:n,r=t.highlight,a=void 0===r?-1:r,s=t.editable,u=void 0!==s&&s,o=t.format,c=void 0===o?M.E_:o,l=t.onChange,h=void 0===l?function(){}:l,v=(0,f.useMemo)((function(){return{count:20,maxIndex:e.size,itemHeight:34,startIndex:i.value}}),[e.size,i]),p=(0,f.useCallback)((function(t,n){return e.range(t,t+n).map((function(e,n){return[n+t,e]}))}),[e]),m=(0,f.useCallback)((function(t){var e=(0,d.Z)(t,2),n=e[0],i=e[1];return(0,g.jsx)(di,{index:n,value:c(i),editable:u,highlight:n===a,onChange:h})}),[c,u,a,h]);return(0,g.jsx)(li,{settings:v,get:p,row:m,rowKey:function(t){return(0,d.Z)(t,1)[0]}})},di=function(t){var e=t.index,n=t.value,i=t.highlight,r=void 0!==i&&i,a=t.editable,s=void 0!==a&&a,u=t.onChange,o=void 0===u?function(){}:u;return(0,g.jsxs)("div",{style:{display:"flex",height:"100%"},children:[(0,g.jsx)("code",{style:(0,ii.Z)((0,ii.Z)({},(0,ri.eP)("none")),r?{background:"var(--code-kbd-background-color)"}:{}),children:(0,M.$v)(e)}),(0,g.jsx)("code",{style:(0,ii.Z)((0,ii.Z)({flex:"1",textAlign:"right"},(0,ri.eP)("none")),r?{background:"var(--code-kbd-background-color)"}:{}),children:s?(0,g.jsx)(oi,{value:n,onChange:function(t){return o(e,t,Number(n))}}):(0,g.jsx)("span",{children:n})})]})},vi=function(t){var e=t.name,n=void 0===e?"Memory":e,i=t.highlight,r=void 0===i?-1:i,a=t.editable,s=void 0===a||a,u=t.memory,o=t.format,c=void 0===o?"dec":o,v=(0,f.useState)(c),m=(0,d.Z)(v,2),Z=m[0],b=m[1],k=(0,f.useState)("0"),x=(0,d.Z)(k,2),y=x[0],w=x[1],j=(0,f.useState)({value:0}),C=(0,d.Z)(j,2),S=C[0],A=C[1],P=function(){A({value:Number(y)})},V=(0,f.useContext)(bn.Il),O=V.filePicker,D=V.fs,N=V.setStatus,R=(0,f.useCallback)((0,h.Z)((0,l.Z)().mark((function t(){var e;return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,O.select();case 3:return e=t.sent,t.next=6,u.load(D,e);case 6:t.next=12;break;case 8:t.prev=8,t.t0=t.catch(0),console.error(t.t0),N("Failed to load into memory");case 12:case"end":return t.stop()}}),t,null,[[0,8]])}))),[D,O,u,N]),F=(0,f.useCallback)((function(t,e){u.update(t,e,null!==Z&&void 0!==Z?Z:"dec")}),[u,Z]);return(0,g.jsxs)("article",{className:"panel",children:[(0,g.jsxs)("header",{children:[(0,g.jsx)("div",{children:n}),(0,g.jsxs)("fieldset",{role:"group",children:[(0,g.jsx)("button",{onClick:R,className:"flex-0",children:(0,g.jsx)(Un.J,{name:"upload_file"})}),(0,g.jsx)("input",{style:{width:"4em",height:"100%"},placeholder:p.ag._("Goto"),onKeyDown:function(t){return"Enter"===t.key&&P()},onChange:function(t){var e=t.target.value;return w(null!==e&&void 0!==e?e:"0")}}),(0,g.jsx)("button",{onClick:P,className:"flex-0",children:(0,g.jsx)(Un.J,{name:"move_down"})}),ie.map((function(t){return(0,g.jsxs)("label",{className:"flex-0",role:"button","aria-current":t===Z,children:[(0,g.jsx)("input",{type:"radio",name:n,value:t,checked:t===Z,onChange:function(){return b(t)}}),t]},t)}))]})]}),(0,g.jsx)(hi,{jmp:S,memory:u,highlight:r,editable:s,format:function(t){return function(t,e){switch(t){case"bin":return(0,M.Ly)(e);case"hex":return(0,M.$v)(e);case"asm":return(0,Jt.a)(e);default:return(0,M.E_)(e)}}(Z,t)},onChange:F})]})};var fi="white";function pi(t,e,n,i){var r=4*(512*n+e),a=i===fi?255:0;t[r]=a,t[r+1]=a,t[r+2]=a,t[r+3]=255}var mi=function(t){var e,n=t.memory,i=(0,f.useRef)();return e=(0,f.useCallback)((function(){var t,e,r=null!==(t=null===(e=i.current)||void 0===e?void 0:e.getContext("2d"))&&void 0!==t?t:void 0;r&&function(t,e){for(var n,i,r=(0,z.kP)(t.getImageData(0,0,512,256),"Failed to create Context2d"),a=0;a<512;a++)for(var s=0;s<256;s++){var u=(n=a,i=s,0===(e.get(32*i+(n/16|0))&1<<n%16)?fi:"black");pi(r.data,a,s,u)}t.putImageData(r,0,0)}(r,n)}),[n]),(0,f.useEffect)((function(){var t=$.get().frame$.subscribe((function(){e()}));return function(){return t.unsubscribe()}}),[e]),(0,g.jsx)(Bn,{header:(0,g.jsx)(v.cC,{id:"Screen"}),children:(0,g.jsx)("figure",{style:{width:"100%",maxWidth:"512px",boxSizing:"content-box",marginInline:"auto",margin:"0",borderTop:"2px solid gray",borderLeft:"2px solid gray",borderBottom:"2px solid lightgray",borderRight:"2px solid lightgray"},children:(0,g.jsx)("canvas",{ref:function(t){return i.current=null!==t&&void 0!==t?t:void 0},width:512,height:256})})})};function gi(t){if(t instanceof Lt)return(0,g.jsx)(Yn,{A:t.in("x").busVoltage,op:t.op(),D:t.in("y").busVoltage,out:t.out().busVoltage,flag:t.out("zr").voltage()===X?Tt.vU.Zero:t.out("ng").voltage()===X?Tt.vU.Negative:Tt.vU.Positive});var e;if(t instanceof Ke)return(0,g.jsx)(ti,{name:null!==(e=t.name)&&void 0!==e?e:"Chip ".concat(t.id),bits:t.bits});if(t instanceof ze)return(0,g.jsx)(ti,{name:"PC",bits:t.bits});if(t instanceof oe)return(0,g.jsx)(vi,{name:t.name,memory:t.memory,format:"dec",highlight:t.address});if(t instanceof le)return(0,g.jsxs)("span",{children:["RAM ",t.width]});if(t instanceof Te)return(0,g.jsx)(ni,{keyboard:t});if(t instanceof Ie)return(0,g.jsx)(mi,{memory:t.memory});if(t instanceof Re){var n=Me(t.in("instruction").busVoltage);return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(ti,{name:"A",bits:t.state.A}),(0,g.jsx)(ti,{name:"D",bits:t.state.D}),(0,g.jsx)(ti,{name:"PC",bits:t.state.PC}),(0,g.jsx)(Yn,{A:n.am?t.in("inM").busVoltage:t.state.A,D:t.state.D,out:t.state.ALU,op:n.op,flag:t.state.flag})]})}return(0,g.jsx)(g.Fragment,{children:(0,i.Z)(t.parts).map(gi)})}var Zi=function(){var t=(0,f.useContext)(bn.Il),e=t.filePicker,n=t.fs,p=t.setStatus,m=function(){var t=(0,f.useContext)(Zn),e=(0,f.useContext)(bn.Il).setStatus,n=(0,f.useMemo)((function(){return localStorage}),[]),i=(0,f.useRef)((function(){})),r=(0,f.useMemo)((function(){return An(t,e,n,i)}),[t,e,n,i]),a=r.initialState,s=r.reducers,u=r.actions,o=yn(s,a),c=(0,d.Z)(o,2),l=c[0],h=c[1];return i.current=h,{state:l,dispatch:i,actions:u}}(),Z=m.state,b=m.actions,x=m.dispatch,y=wn(Z.files.hdl),w=(0,d.Z)(y,2),j=w[0],C=w[1],S=wn(Z.files.tst),M=(0,d.Z)(S,2),A=M[0],P=M[1],V=wn(Z.files.cmp),O=(0,d.Z)(V,2),D=O[0],N=O[1],R=wn(Z.files.out),I=(0,d.Z)(R,1)[0],T=(0,f.useRef)((function(){}));T.current=(0,h.Z)((0,l.Z)().mark((function t(){var e,n,i,r,a=arguments;return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=a.length>0&&void 0!==a[0]?a[0]:{},t.next=3,b.updateFiles({hdl:null!==(e=r.hdl)&&void 0!==e?e:j,tst:null!==(n=r.tst)&&void 0!==n?n:A,cmp:null!==(i=r.cmp)&&void 0!==i?i:D});case 3:case"end":return t.stop()}}),t)})));var E=(0,f.useCallback)((0,h.Z)((0,l.Z)().mark((function t(){var i,r;return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.select();case 3:return i=t.sent,t.next=6,n.readFile(i);case 6:return r=t.sent,t.next=9,T.current({tst:r});case 9:t.next=15;break;case 11:t.prev=11,t.t0=t.catch(0),console.error(t.t0),p("Failed to load into memory");case 15:case"end":return t.stop()}}),t,null,[[0,11]])}))),[e,p,n,T]),L=(0,f.useRef)();(0,f.useEffect)((function(){return L.current=new(function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),e.apply(this,arguments)}return(0,a.Z)(n,[{key:"reset",value:function(){var t=(0,h.Z)((0,l.Z)().mark((function t(){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,T.current();case 2:return t.next=4,b.reset();case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"finishFrame",value:function(){(0,s.Z)((0,u.Z)(n.prototype),"finishFrame",this).call(this),x.current({action:"updateTestStep"})}},{key:"tick",value:function(){var t=(0,h.Z)((0,l.Z)().mark((function t(){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",b.tick());case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"toggle",value:function(){x.current({action:"updateTestStep"})}}]),n}($n)),function(){var t;null===(t=L.current)||void 0===t||t.stop()}}),[T,b,x]);var _=(0,f.useMemo)((function(){return{toggle:function(){b.clock()},reset:function(){b.reset()}}}),[b]),W=(0,f.useState)(!1),U=(0,d.Z)(W,2),H=U[0],J=U[1],K=function(){var t=(0,h.Z)((0,l.Z)().mark((function t(){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:H?(T.current(),J(!1)):(b.useBuiltin(),J(!0));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),z=(0,g.jsx)(g.Fragment,{children:(0,g.jsxs)("fieldset",{role:"group",children:[(0,g.jsx)("select",{value:Z.controls.project,onChange:function(t){var e=t.target.value;b.setProject(e)},"data-testid":"project-picker",children:jn.map((function(t){var e=(0,d.Z)(t,2),n=e[0],i=e[1];return(0,g.jsx)("option",{value:n,children:i},n)}))}),(0,g.jsx)("select",{value:Z.controls.chipName,onChange:function(t){var e=t.target.value;b.setChip(e)},"data-testid":"chip-picker",children:Z.controls.chips.map((function(t){return(0,g.jsx)("option",{value:t,children:t},t)}))}),(0,g.jsx)("button",{className:"flex-0",onClick:function(){b.saveChip(j)},disabled:H,children:(0,g.jsx)(v.cC,{id:"Save"})})]})}),G=(0,g.jsx)(Bn,{className:"_hdl_panel",header:(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{tabIndex:0,children:"HDL"}),(0,g.jsx)("fieldset",{children:Z.controls.hasBuiltin&&(0,g.jsxs)("label",{children:[(0,g.jsx)("input",{type:"checkbox",role:"switch",checked:H,onChange:K}),(0,g.jsx)(v.cC,{id:"Builtin"})]})}),z]}),children:(0,g.jsx)(_n,{className:"flex-1",value:j,onChange:function(t){C(t),T.current({hdl:t})},grammar:F.parser,language:"hdl",disabled:H})}),q=(0,g.jsxs)("fieldset",{role:"group",children:[(0,g.jsx)("button",{onClick:b.eval,onKeyDown:b.eval,disabled:!Z.sim.pending,children:(0,g.jsx)(v.cC,{id:"Eval"})}),(0,g.jsxs)("button",{onClick:_.toggle,style:{maxWidth:"initial"},disabled:!Z.sim.clocked,children:[(0,g.jsx)(v.cC,{id:"Clock"}),":","\xa0",(0,g.jsx)(Qn,{})]}),(0,g.jsx)("button",{onClick:_.reset,style:{maxWidth:"initial"},disabled:!Z.sim.clocked,children:(0,g.jsx)(v.cC,{id:"Reset"})})]}),$=function(t){return(0,i.Z)(t.parts).map((function(t,e){return["".concat(t.id,"_").concat(e),gi(t)]}))}({parts:(0,i.Z)(Z.sim.parts)}),X=(0,g.jsx)(Bn,{className:"_parts_panel",header:(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{children:(0,g.jsx)(v.cC,{id:"Chip"})}),q]}),children:Z.sim.invalid?(0,g.jsx)(v.cC,{id:"Invalid Chip"}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(k,{sim:Z.sim,toggle:b.toggle}),$.length>0&&(0,g.jsx)(Wn,{summary:(0,g.jsx)(v.cC,{id:"Visualizations"}),open:!0,children:(0,g.jsx)("main",{children:$.map((function(t){var e=(0,d.Z)(t,2),n=e[0],i=e[1];return(0,g.jsx)("div",{children:i},n)}))})})]})}),Q=(0,f.useState)("tst"),Y=(0,d.Z)(Q,2),tt=Y[0],et=Y[1],nt=(0,g.jsx)(Bn,{className:"_test_panel",header:(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{className:"flex-1",children:(0,g.jsx)(v.cC,{id:"Test"})}),(0,g.jsx)("div",{className:"flex-2",children:L.current&&(0,g.jsx)(Hn,{runner:L.current})}),(0,g.jsx)("div",{children:(0,g.jsxs)("button",{onClick:E,children:[(0,g.jsx)(Un.J,{name:"upload_file"})," "]})})]}),children:(0,g.jsxs)("div",{role:"tablist",style:{"--tab-count":"3"},children:[(0,g.jsx)("div",{role:"tab",id:"test-tab-tst","aria-controls":"test-tabpanel-tst","aria-selected":"tst"===tt,children:(0,g.jsxs)("label",{children:[(0,g.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-tst",value:"tst",checked:"tst"===tt,onChange:function(){return et("tst")}}),"Test Script"]})}),(0,g.jsx)("div",{role:"tabpanel","aria-labelledby":"test-tab-tst",id:"test-tabpanel-tst",children:(0,g.jsx)(_n,{value:A,onChange:P,grammar:B.parser,language:"tst",highlight:Z.controls.span})}),(0,g.jsx)("div",{role:"tab",id:"test-tab-cmp","aria-controls":"test-tablpanel-cmp","aria-selected":"cmp"===tt,children:(0,g.jsxs)("label",{children:[(0,g.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-cmp",value:"cmp",checked:"cmp"===tt,onChange:function(){return et("cmp")}}),"Compare File"]})}),(0,g.jsx)("div",{role:"tabpanel","aria-labelledby":"test-tab-cmp",id:"test-tabpanel-cmp",style:{position:"relative"},children:(0,g.jsx)(_n,{value:D,onChange:N,grammar:Dn.parser,language:"cmp"})}),(0,g.jsx)("div",{role:"tab",id:"test-tab-out","aria-controls":"test-tabpanel-out","aria-selected":"out"===tt,children:(0,g.jsxs)("label",{children:[(0,g.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-out",value:"out",checked:"out"===tt,onChange:function(){return et("out")}}),"Output File"]})}),(0,g.jsx)("div",{role:"tabpanel",id:"test-tabpanel-out","aria-labelledby":"test-tab-out",children:(0,g.jsx)(Nn,{cmp:D,out:I})})]})});return(0,g.jsxs)("div",{className:"ChipPage grid",children:[G,X,nt]})},bi=Zi},6693:function(t,e,n){n.d(e,{Bb:function(){return u},PH:function(){return i},Uc:function(){return r},lK:function(){return a},vU:function(){return s}});var i={asm:{0:42,1:63,"-1":58,D:12,A:48,M:48,"!D":13,"!A":49,"-D":15,"-A":51,"D+1":31,"A+1":55,"D-1":14,"A-1":50,"D+A":2,"D-A":19,"D-M":19,"A-D":7,"D&A":0,"D&M":0,"D|A":21,"D|M":21},op:{42:"0",63:"1",58:"-1",12:"D",48:"A",13:"!D",49:"!A",15:"-D",51:"-A",31:"D+1",55:"A+1",14:"D-1",50:"A-1",2:"D+A",19:"D-A",7:"A-D",0:"D&A",21:"D|A"}},r={asm:{"":0,M:1,D:2,MD:3,A:4,AM:5,AD:6,AMD:7},op:{0:"",1:"M",2:"D",3:"MD",4:"A",5:"AM",6:"AD",7:"AMD"}},a={asm:{"":0,JGT:1,JEQ:2,JGE:3,JLT:4,JNE:5,JLE:6,JMP:7},op:{0:"",1:"JGT",2:"JEQ",3:"JGE",4:"JLT",5:"JNE",6:"JLE",7:"JMP"}},s={1:"Positive",0:"Zero",15:"Negative",Positive:1,Zero:0,Negative:15};function u(t,e,n){var i=0;switch(t){case 42:i=0;break;case 63:i=1;break;case 58:i=-1;break;case 12:i=e;break;case 48:i=n;break;case 13:i=~e;break;case 49:i=~n;break;case 15:i=-e;break;case 51:i=-n;break;case 31:i=e+1;break;case 55:i=n+1;break;case 14:i=e-1;break;case 50:i=n-1;break;case 2:i=e+n;break;case 19:i=e-n;break;case 7:i=n-e;break;case 0:i=e&n;break;case 21:i=e|n}return[i&=65535,0===i?s.Zero:32768&i?s.Negative:s.Positive]}},7693:function(t,e,n){n.d(e,{a:function(){return a},op:function(){return s},p:function(){return u}});var i=n(9422),r=n(6693);function a(t){return 32768&t?function(t){var e=(4096&(t&=65535))>>12,n=(4032&t)>>6,i=(56&t)>>3,a=7&t;if(void 0===r.PH.op[n])return"#ERR";var s=r.PH.op[n];e&&(s=s.replace(/A/g,"M"));var u=r.Uc.op[i],o=r.lK.op[a],c=s;u&&(c="".concat(u,"=").concat(c));o&&(c="".concat(c,";").concat(o));return c}(t):function(t){return"@"+(32767&t).toString(10)}(t)}function s(t){return"@"===t[0]?function(t){return parseInt(t.substring(1),10)}(t):function(t){var e,n=t.match((0,i.Z)(/(?:([AMD]{1,3})=)?([-!01ADM&|]{1,3})(?:;(JGT|JLT|JGE|JLE|JEQ|JMP))?/,{assign:1,operation:2,jump:3})),a=null!==(e=null===n||void 0===n?void 0:n.groups)&&void 0!==e?e:{},s=a.assign,o=a.operation,c=a.jump,l=o.includes("M")||s.includes("M"),h=r.Uc.asm[null!==s&&void 0!==s?s:""],d=r.lK.asm[null!==c&&void 0!==c?c:""],v=r.PH.asm[null!==o&&void 0!==o?o:""];return u(l,v,h,d)}(t)}function u(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=57344,a=t?4096:0,s=e<<6,u=(null!==n&&void 0!==n?n:0)<<3,o=null!==i&&void 0!==i?i:0;return r+a+s+u+o}},326:function(t,e,n){n.d(e,{$v:function(){return l},Af:function(){return u},C$:function(){return c},C2:function(){return f},E_:function(){return d},Ly:function(){return h},nN:function(){return v},o5:function(){return o}});var i=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];function r(t){var e;return null!==(e=i[t])&&void 0!==e?e:"X"}function a(t){switch(t){case 0:return"0000";case 1:return"0001";case 2:return"0010";case 3:return"0011";case 4:return"0100";case 5:return"0101";case 6:return"0110";case 7:return"0111";case 8:return"1000";case 9:return"1001";case 10:return"1010";case 11:return"1011";case 12:return"1100";case 13:return"1101";case 14:return"1110";case 15:return"1111";default:return"erro"}}function s(t,e){return 65535&parseInt(t.replace(/[^\d+-.xa-fA-F]/g,""),e)}function u(t){return s(t,16)}function o(t){return s(t,10)}function c(t){return s(t,2)}function l(t){var e=r((61440&t)>>12),n=r((3840&t)>>8),i=r((240&t)>>4),a=r(15&t);return"0x".concat(e).concat(n).concat(i).concat(a)}function h(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=a((61440&t)>>12),i=a((3840&t)>>8),r=a((240&t)>>4),s=a(15&t);return"".concat(n).concat(i).concat(r).concat(s).substring(16-e)}function d(t){return 32768===(t&=65535)?"-32768":32768&t?"-".concat(t=1+~t&32767):"".concat(t)}function v(t){return"".concat(t&=65535)}function f(t,e){var n=~((t&=65535)&(e&=65535));return n&=65535}}}]);
//# sourceMappingURL=498.dab041a0.chunk.js.map