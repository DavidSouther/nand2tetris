{"version":3,"file":"static/js/881.62b33dca.chunk.js","mappings":"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","sources":["simulator/chip/chip.tsx","simulator/chip/clock.ts","components/clockface.tsx","components/pinout.tsx","languages/base.ts","languages/hdl.ts","languages/tst.ts","simulator/chip/builtins/logic/and.ts","simulator/chip/builtins/logic/dmux.ts","simulator/chip/builtins/logic/mux.ts","simulator/chip/builtins/logic/nand.ts","simulator/chip/builtins/logic/not.ts","simulator/chip/builtins/logic/or.ts","simulator/chip/builtins/logic/xor.ts","simulator/chip/builtins/arithmetic/add_16.ts","components/chips/alu.tsx","simulator/chip/builtins/arithmetic/alu.tsx","simulator/chip/builtins/arithmetic/half_adder.ts","simulator/chip/builtins/arithmetic/full_adder.ts","simulator/chip/builtins/arithmetic/inc16.ts","components/chips/register.tsx","simulator/chip/builtins/sequential/bit.tsx","simulator/chip/builtins/sequential/dff.ts","languages/asm.ts","simulator/fs.ts","simulator/cpu/memory.ts","util/react.ts","components/pico/inline_edit.tsx","components/pico/virtual_scroll.tsx","components/chips/memory.tsx","simulator/chip/builtins/sequential/ram.tsx","components/shell/panel.tsx","components/chips/screen.tsx","components/chips/keyboard.tsx","simulator/cpu/cpu.ts","simulator/chip/builtins/computer/computer.tsx","simulator/chip/builtins/index.ts","simulator/chip/builder.ts","simulator/output.ts","simulator/tst.ts","util/storage.ts","pages/chip.store.ts","languages/cmp.ts","components/difftable.tsx","components/editor.tsx","components/chips/visualizations.tsx","simulator/timer.ts","components/runbar.tsx","pages/chip.tsx","simulator/cpu/alu.ts","util/asm.ts","util/twos.ts"],"sourcesContent":["import { assert, assertExists } from \"@davidsouther/jiffies/lib/esm/assert\";\nimport { FileSystem } from \"@davidsouther/jiffies/lib/esm/fs\";\nimport { range } from \"@davidsouther/jiffies/lib/esm/range\";\nimport { ReactNode } from \"react\";\nimport { bin } from \"../../util/twos\";\nimport { Clock } from \"./clock\";\n\nexport const HIGH = 1;\nexport const LOW = 0;\nexport type Voltage = typeof HIGH | typeof LOW;\n\nexport interface Pin {\n  readonly name: string;\n  readonly width: number;\n  busVoltage: number;\n  pull(voltage: Voltage, bit?: number): void;\n  toggle(bit?: number): void;\n  voltage(bit?: number): Voltage;\n  connect(pin: Pin): void;\n}\n\nexport class Bus implements Pin {\n  state: Voltage[];\n  next: Pin[] = [];\n\n  constructor(readonly name: string, readonly width = 1) {\n    this.state = range(0, this.width).map(() => LOW);\n  }\n\n  ensureWidth(newWidth: number) {\n    assert(newWidth <= 16, `Cannot widen past 16 to ${newWidth} bits`);\n    if (this.width < newWidth) {\n      (this as { width: number }).width = newWidth;\n      this.state = [\n        ...this.state,\n        ...range(this.width, newWidth).map(() => LOW as Voltage),\n      ];\n    }\n  }\n\n  connect(next: Pin) {\n    this.next.push(next);\n    next.busVoltage = this.busVoltage;\n  }\n\n  pull(voltage: Voltage, bit = 0) {\n    assert(\n      bit >= 0 && bit < this.width,\n      `Bit out of bounds: ${this.name}@${bit}`\n    );\n    this.state[bit] = voltage;\n    this.next.forEach((n) => n.pull(voltage, bit));\n  }\n\n  voltage(bit = 0): Voltage {\n    assert(bit >= 0 && bit < this.width);\n    return this.state[bit];\n  }\n\n  set busVoltage(voltage: number) {\n    for (const i of range(0, this.width)) {\n      this.state[i] = ((voltage & (1 << i)) >> i) as Voltage;\n    }\n    this.next.forEach((n) => (n.busVoltage = this.busVoltage));\n  }\n\n  get busVoltage(): number {\n    return range(0, this.width).reduce((b, i) => b | (this.state[i] << i), 0);\n  }\n\n  toggle(bit = 0) {\n    const nextVoltage = this.voltage(bit) === LOW ? HIGH : LOW;\n    this.pull(nextVoltage, bit);\n  }\n}\n\nexport class InSubBus extends Bus {\n  constructor(\n    private bus: Pin,\n    private start: number,\n    override readonly width = 1\n  ) {\n    super(bus.name);\n    assert(\n      start >= 0 && start + width <= bus.width,\n      `Mismatched InSubBus dimensions on ${bus.name} (${width} + ${start} > ${bus.width})`\n    );\n    this.connect(bus);\n  }\n\n  override pull(voltage: Voltage, bit = 0) {\n    assert(bit >= 0 && bit < this.width);\n    this.bus.pull(voltage, this.start + bit);\n  }\n\n  override voltage(bit = 0): Voltage {\n    assert(bit >= 0 && bit < this.width);\n    return this.bus.voltage(this.start + bit);\n  }\n\n  override set busVoltage(voltage: number) {\n    const high = this.bus.busVoltage & ~mask(this.width + this.start);\n    const low = this.bus.busVoltage & mask(this.start);\n    const mid = (voltage & mask(this.width)) << this.start;\n    this.bus.busVoltage = high | mid | low;\n  }\n\n  override get busVoltage(): number {\n    return (this.bus.busVoltage >> this.start) & mask(this.width);\n  }\n\n  override connect(bus: Pin): void {\n    assert(\n      this.start + this.width <= bus.width,\n      `Mismatched InSubBus connection dimensions (From ${bus.name} to ${this.name})`\n    );\n    this.bus = bus;\n  }\n}\n\nexport class OutSubBus extends Bus {\n  constructor(\n    private bus: Pin,\n    private start: number,\n    override readonly width = 1\n  ) {\n    super(bus.name);\n    assert(start >= 0 && width <= bus.width, `Mismatched OutSubBus dimensions`);\n    this.connect(bus);\n  }\n\n  override set busVoltage(voltage: number) {\n    this.bus.busVoltage =\n      (voltage & mask(this.width + this.start)) >> this.start;\n  }\n\n  override get busVoltage(): number {\n    return this.bus.busVoltage & mask(this.width);\n  }\n\n  override connect(bus: Pin): void {\n    assert(\n      this.width <= bus.width,\n      `Mismatched OutSubBus connection dimensions`\n    );\n    this.bus = bus;\n  }\n}\n\nexport class ConstantBus extends Bus {\n  constructor(name: string, private readonly value: number) {\n    super(name, 16 /* TODO: get high bit index */);\n  }\n\n  pullHigh(_ = 0) {}\n  pullLow(_ = 0) {}\n  override voltage(_ = 0): Voltage {\n    return (this.busVoltage & 0x1) as Voltage;\n  }\n\n  override set busVoltage(voltage: number) {\n    // Noop\n  }\n  override get busVoltage(): number {\n    return this.value;\n  }\n}\n\nexport const TRUE_BUS = new ConstantBus(\"true\", 0xffff);\nexport const FALSE_BUS = new ConstantBus(\"false\", 0);\n\nexport function parsePinDecl(toPin: string): {\n  pin: string;\n  width: number;\n} {\n  const { pin, w } = toPin.match(/(?<pin>[a-zA-Z]+)(\\[(?<w>\\d+)\\])?/)\n    ?.groups as {\n    pin: string;\n    w?: string;\n  };\n  return {\n    pin,\n    width: w ? Number(w) : 1,\n  };\n}\n\nexport function parseToPin(toPin: string): {\n  pin: string;\n  start?: number;\n  end?: number;\n} {\n  const { pin, i, j } = toPin.match(\n    /(?<pin>[a-z]+)(\\[(?<i>\\d+)(\\.\\.(?<j>\\d+))?\\])?/\n  )?.groups as { pin: string; i?: string; j?: string };\n  return {\n    pin,\n    start: i ? Number(i) : undefined,\n    end: j ? Number(j) : undefined,\n  };\n}\n\nexport class Pins {\n  private readonly map = new Map<string, Pin>();\n\n  insert(pin: Pin) {\n    let { name } = pin;\n    assert(!this.map.has(name), `Pins already has ${name}!`);\n    this.map.set(name, pin);\n  }\n\n  emplace(name: string, minWidth?: number) {\n    if (this.has(name)) {\n      return this.get(name)!;\n    } else {\n      const pin = new Bus(name, minWidth);\n      this.insert(pin);\n      return pin;\n    }\n  }\n\n  has(pin: string): boolean {\n    return this.map.has(pin);\n  }\n\n  get(pin: string): Pin | undefined {\n    return this.map.get(pin);\n  }\n\n  entries(): Iterable<Pin> {\n    return this.map.values();\n  }\n\n  [Symbol.iterator]() {\n    return this.map[Symbol.iterator]();\n  }\n}\n\nlet id = 0;\nexport class Chip {\n  readonly id = id++;\n  ins = new Pins();\n  outs = new Pins();\n  pins = new Pins();\n  parts = new Set<Chip>();\n  clockedPins: Set<string>;\n\n  get clocked() {\n    if (this.clockedPins.size > 0) {\n      return true;\n    }\n    for (const part of this.parts) {\n      if (part.clocked) return true;\n    }\n    return false;\n  }\n\n  constructor(\n    ins: (string | { pin: string; width: number })[],\n    outs: (string | { pin: string; width: number })[],\n    public name?: string,\n    internals: (string | { pin: string; width: number })[] = [],\n    clocked: string[] = []\n  ) {\n    for (const inn of ins) {\n      const { pin, width = 1 } =\n        (inn as { pin: string }).pin !== undefined\n          ? (inn as { pin: string; width: number })\n          : parsePinDecl(inn as string);\n      this.ins.insert(new Bus(pin, width));\n    }\n\n    for (const out of outs) {\n      const { pin, width = 1 } =\n        (out as { pin: string }).pin !== undefined\n          ? (out as { pin: string; width: number })\n          : parsePinDecl(out as string);\n      this.outs.insert(new Bus(pin, width));\n    }\n\n    for (const internal of internals) {\n      const { pin, width = 1 } =\n        (internal as { pin: string }).pin !== undefined\n          ? (internal as { pin: string; width: number })\n          : parsePinDecl(internal as string);\n      this.pins.insert(new Bus(pin, width));\n    }\n\n    this.clockedPins = new Set(clocked);\n\n    Clock.get().$.subscribe(() => this.eval());\n  }\n\n  reset() {\n    for (const [_, pin] of this.ins) {\n      pin.busVoltage = 0;\n    }\n    this.eval();\n  }\n\n  in(pin = \"in\"): Pin {\n    assert(this.ins.has(pin), `No pin ${pin}`);\n    return this.ins.get(pin)!;\n  }\n\n  out(pin = \"out\"): Pin {\n    assert(this.outs.has(pin));\n    return this.outs.get(pin)!;\n  }\n\n  pin(name: string): Pin {\n    assert(this.pins.has(name));\n    return this.pins.get(name)!;\n  }\n\n  get(name: string, offset?: number): Pin | undefined {\n    if (this.ins.has(name)) {\n      return this.ins.get(name)!;\n    }\n    if (this.outs.has(name)) {\n      return this.outs.get(name)!;\n    }\n    if (this.pins.has(name)) {\n      return this.pins.get(name)!;\n    }\n    return this.getBuiltin(name, offset);\n  }\n\n  private getBuiltin(name: string, offset = 0): Pin | undefined {\n    if (BUILTIN_NAMES.includes(name)) {\n      for (const part of this.parts) {\n        const pin = part.get(name, offset);\n        if (pin) {\n          return pin;\n        }\n      }\n    }\n    return undefined;\n  }\n\n  isOutPin(pin: string): boolean {\n    return this.outs.has(pin);\n  }\n\n  wire(part: Chip, connections: Connection[]) {\n    this.parts.add(part);\n    for (const { to, from } of connections) {\n      if (part.isOutPin(to.name)) {\n        this.wireOutPin(part, to, from);\n      } else {\n        this.wireInPin(part, to, from);\n      }\n    }\n  }\n\n  render(): ReactNode[] {\n    return [...this.parts]\n      .map((part) => part.render())\n      .filter((v) => v !== undefined);\n  }\n\n  private findPin(from: string, minWidth?: number): Pin {\n    if (from.toLowerCase() === \"true\" || from === \"1\") {\n      return TRUE_BUS;\n    }\n    if (from.toLowerCase() === \"false\" || from === \"0\") {\n      return FALSE_BUS;\n    }\n    if (this.ins.has(from)) {\n      return this.ins.get(from)!;\n    }\n    if (this.outs.has(from)) {\n      return this.outs.get(from)!;\n    }\n    return this.pins.emplace(from, minWidth);\n  }\n\n  private wireOutPin(part: Chip, to: PinSide, from: PinSide) {\n    let partPin = assertExists(\n      part.outs.get(to.name),\n      () => `Cannot wire to missing pin ${to.name}`\n    );\n    to.width ??= partPin.width;\n\n    let chipPin = this.findPin(from.name, from.width ?? to.width);\n    const isInternal = this.pins.has(chipPin.name);\n\n    from.width ??= chipPin.width;\n\n    if (chipPin instanceof ConstantBus) {\n      throw new Error(`Cannot wire to constant bus`);\n    }\n\n    // Widen internal pins\n    if (isInternal && chipPin instanceof Bus) {\n      chipPin.ensureWidth(from.start + from.width);\n    }\n\n    // Wrap the chipPin in an InBus when the chip side is dimensioned\n    if (from.start > 0 || from.width !== chipPin.width) {\n      chipPin = new InSubBus(chipPin, from.start, from.width);\n    }\n\n    // Wrap the chipPin in an OutBus when the part side is dimensioned\n    if (to.start > 0 || to.width !== chipPin.width) {\n      chipPin = new OutSubBus(chipPin, to.start, to.width);\n    }\n\n    partPin.connect(chipPin);\n  }\n\n  private wireInPin(part: Chip, to: PinSide, from: PinSide) {\n    let partPin = assertExists(\n      part.ins.get(to.name),\n      () => `Cannot wire to missing pin ${to.name}`\n    );\n    to.width ??= partPin.width;\n\n    const chipPin = this.findPin(from.name, from.width ?? to.width);\n\n    from.width ??= chipPin.width;\n\n    // Wrap the partPin in an InBus when the part side is dimensioned\n    if (to.start > 0 || to.width !== chipPin.width) {\n      partPin = new InSubBus(partPin, to.start, to.width);\n    }\n\n    // Wrap the partPin in an OutBus when the chip side is dimensioned\n    if (![\"true\", \"false\"].includes(chipPin.name)) {\n      if (from.start > 0 || from.width !== chipPin.width) {\n        partPin = new OutSubBus(partPin, from.start, from.width);\n      }\n    }\n    chipPin.connect(partPin);\n  }\n\n  eval() {\n    for (const chip of this.parts) {\n      // TODO topological sort\n      // eval chip input busses\n      chip.eval();\n      // eval output busses\n    }\n  }\n\n  tick() {\n    this.eval();\n  }\n\n  tock() {\n    this.eval();\n  }\n\n  remove() {\n    for (const part of this.parts) {\n      part.remove();\n    }\n  }\n\n  // For the ROM32K builtin to load from a file system\n  async load(fs: FileSystem, path: string) {\n    for (const part of this.parts) {\n      if (part.name === \"ROM32K\") {\n        await part.load(fs, path);\n      }\n    }\n  }\n}\n\nexport class Low extends Chip {\n  constructor() {\n    super([], []);\n    this.outs.insert(FALSE_BUS);\n  }\n}\n\nexport class High extends Chip {\n  constructor() {\n    super([], []);\n    this.outs.insert(TRUE_BUS);\n  }\n}\n\nexport class ClockedChip extends Chip {\n  override get clocked(): boolean {\n    return true;\n  }\n\n  #subscription = Clock.get().$.subscribe(({ level }) => {\n    if (level === LOW) {\n      this.tock();\n    } else {\n      this.tick();\n    }\n  });\n\n  override remove() {\n    this.#subscription.unsubscribe();\n    super.remove();\n  }\n}\n\nexport interface PinSide {\n  name: string;\n  start: number;\n  width?: number;\n}\n\nexport interface Connection {\n  // To is the part side\n  to: PinSide;\n  // From is the chip side\n  from: PinSide;\n}\n\nexport type Pinout = Record<string, string>;\nexport interface SerializedChip {\n  id: number;\n  name: string;\n  ins: Pinout;\n  outs: Pinout;\n  pins: Pinout;\n  children: SerializedChip[];\n}\n\nfunction mask(width: number) {\n  return Math.pow(2, width) - 1;\n}\n\nfunction setBus(busses: Pinout, pin: Pin) {\n  busses[pin.name] = bin(\n    (pin.busVoltage & mask(pin.width)) <<\n      (pin as unknown as { start: number }).start ?? 0\n  );\n  return busses;\n}\n\nexport function printChip(chip: Chip): SerializedChip {\n  return {\n    id: chip.id,\n    name: chip.name ?? chip.constructor.name,\n    ins: [...chip.ins.entries()].reduce(setBus, {} as Pinout),\n    outs: [...chip.outs.entries()].reduce(setBus, {} as Pinout),\n    pins: [...chip.pins.entries()].reduce(setBus, {} as Pinout),\n    children: [...chip.parts.values()].map(printChip),\n  };\n}\n\nexport const BUILTIN_NAMES = [\n  \"Register\",\n  \"ARegister\",\n  \"DRegister\",\n  \"PC\",\n  \"RAM8\",\n  \"RAM64\",\n  \"RAM512\",\n  \"RAM4K\",\n  \"RAM16K\",\n  \"ROM32K\",\n  \"Screen\",\n  \"Keyboard\",\n  \"Memory\",\n];\n","import { BehaviorSubject, Observable, Subject } from \"rxjs\";\nimport { assert } from \"@davidsouther/jiffies/lib/esm/assert\";\nimport { HIGH, LOW, Voltage } from \"./chip\";\nimport { useEffect, useMemo, useState } from \"react\";\nimport { display } from \"@davidsouther/jiffies/lib/esm/display\";\n\ninterface Tick {\n  readonly level: Voltage;\n  readonly ticks: number;\n}\n\nlet clock: Clock;\nexport class Clock {\n  private level: Voltage = LOW;\n  private ticks = 0;\n\n  static get() {\n    if (clock === undefined) {\n      clock = new Clock();\n    }\n    return clock;\n  }\n\n  private subject = new BehaviorSubject<Tick>({\n    level: this.level,\n    ticks: this.ticks,\n  });\n  readonly $: Observable<Tick> = this.subject;\n\n  readonly update = new Subject<void>();\n\n  private next() {\n    this.subject.next({\n      level: this.level,\n      ticks: this.ticks,\n    });\n    this.update.next();\n  }\n\n  private constructor() {}\n\n  reset() {\n    this.level = LOW;\n    this.ticks = 0;\n    this.next();\n  }\n\n  tick() {\n    assert(this.level === LOW, \"Can only tick up from LOW\");\n    this.level = HIGH;\n    this.next();\n  }\n\n  tock() {\n    assert(this.level === HIGH, \"Can only tock down from HIGH\");\n    this.level = LOW;\n    this.ticks += 1;\n    this.next();\n  }\n\n  toggle() {\n    this.level === HIGH ? this.tock() : this.tick();\n  }\n\n  eval() {\n    this.tick();\n    this.tock();\n  }\n\n  toString() {\n    return `${this.ticks}${this.level === HIGH ? \"+\" : \"\"}`;\n  }\n}\n\nexport function useClock(actions: {\n  tick?: () => void;\n  toggle?: () => void;\n  reset?: () => void;\n}) {\n  const clock = useMemo(() => Clock.get(), []);\n\n  useEffect(() => {\n    const subscription = clock.$.subscribe(() => {\n      actions.tick?.();\n    });\n    return () => subscription.unsubscribe();\n  }, [actions, clock.$]);\n\n  return {\n    toggle() {\n      clock.tick();\n      actions.toggle?.();\n    },\n    reset() {\n      clock.reset();\n      actions.reset?.();\n    },\n  };\n}\n\nexport function useClockface() {\n  const [clockface, setClockface] = useState(display(clock));\n\n  useEffect(() => {\n    const subscription = clock.$.subscribe(() => {\n      setClockface(display(clock));\n    });\n    return () => subscription.unsubscribe();\n  }, []);\n\n  return clockface;\n}\n","import { useClockface } from \"../simulator/chip/clock\";\n\nexport const Clockface = () => {\n  const clockface = useClockface();\n  return <span style={{ whiteSpace: \"nowrap\" }}>{clockface}</span>;\n};\n","import { plural, Trans } from \"@lingui/macro\";\nimport { Pin as ChipPin, Pins, Voltage } from \"../simulator/chip/chip\";\nimport { range } from \"@davidsouther/jiffies/lib/esm/range\";\n\nimport \"./pinout.scss\";\nimport { ChipSim } from \"../pages/chip.store\";\nimport { Clockface } from \"./clockface\";\n\nexport interface ImmPin {\n  bits: [number, Voltage][];\n  pin: ChipPin;\n}\n\nexport function reducePin(pin: ChipPin) {\n  return {\n    pin,\n    bits: range(0, pin.width)\n      .map((i) => [i, pin.voltage(i)] as [number, Voltage])\n      .reverse(),\n  };\n}\n\nexport function reducePins(pins: Pins): ImmPin[] {\n  return [...pins.entries()].map(reducePin);\n}\n\nexport interface PinoutPins {\n  pins: ImmPin[];\n  toggle?: (pin: ChipPin, bit?: number) => void;\n}\n\nexport const FullPinout = (props: {\n  sim: ChipSim;\n  toggle: (pin: ChipPin, i: number | undefined) => void;\n  clockActions: { toggle(): void; reset(): void };\n}) => {\n  const { inPins, outPins, internalPins } = props.sim;\n  return (\n    <table className=\"pinout\">\n      <tbody>\n        {props.sim.clocked && (\n          <ClockPinoutBlock clockActions={props.clockActions} />\n        )}\n        <PinoutBlock\n          pins={inPins}\n          header={plural(inPins.length, {\n            one: \"Input pin\",\n            other: \"Input pins\",\n          })}\n          toggle={props.toggle}\n        />\n        <PinoutBlock\n          pins={outPins}\n          header={plural(outPins.length, {\n            one: \"Output pin\",\n            other: \"Output pins\",\n          })}\n          disabled={props.sim.pending}\n        />\n        <PinoutBlock\n          pins={internalPins}\n          header={plural(internalPins.length, {\n            one: \"Internal pin\",\n            other: \"Internal pins\",\n          })}\n          disabled={props.sim.pending}\n        />\n      </tbody>\n    </table>\n  );\n};\n\nexport const PinoutBlock = (\n  props: PinoutPins & { header: string; disabled?: boolean }\n) => (\n  <>\n    {props.pins.length > 0 && (\n      <tr>\n        <th colSpan={2}>{props.header}</th>\n      </tr>\n    )}\n    {[...props.pins].map((immPin) => (\n      <tr key={immPin.pin.name}>\n        <td>{immPin.pin.name}</td>\n        <td>\n          <Pin pin={immPin} toggle={props.toggle} disabled={props.disabled} />\n        </td>\n      </tr>\n    ))}\n  </>\n);\n\nexport const ClockPinoutBlock = ({\n  clockActions,\n}: {\n  clockActions: { toggle(): void; reset(): void };\n}) => (\n  <>\n    <tr>\n      <th colSpan={2}>\n        <Trans>Clock Pin</Trans>\n      </th>\n    </tr>\n    <tr>\n      <td>\n        <Trans>Clock</Trans>\n      </td>\n      <td className=\"flex row justify-between\">\n        <fieldset role=\"group\">\n          <button onClick={clockActions.toggle} style={{ maxWidth: \"initial\" }}>\n            <Clockface />\n          </button>\n        </fieldset>\n        <fieldset role=\"group\">\n          <button onClick={clockActions.reset} style={{ maxWidth: \"initial\" }}>\n            <Trans>Reset</Trans>\n          </button>\n        </fieldset>\n      </td>\n    </tr>\n  </>\n);\n\nexport const Pinout = ({\n  pins,\n  toggle,\n}: {\n  pins: ImmPin[];\n  toggle?: (pin: ChipPin, bit?: number) => void;\n}) => {\n  if (pins.length === 0) {\n    return <Trans>None</Trans>;\n  }\n  return (\n    <table className=\"pinout\">\n      <thead>\n        <tr>\n          <th>\n            <Trans>Name</Trans>\n          </th>\n          <th>\n            <Trans>Value</Trans>\n          </th>\n        </tr>\n      </thead>\n      <tbody>\n        {[...pins].map((immPin) => (\n          <tr key={immPin.pin.name}>\n            <td>{immPin.pin.name}</td>\n            <td>\n              <Pin pin={immPin} toggle={toggle} />\n            </td>\n          </tr>\n        ))}\n      </tbody>\n    </table>\n  );\n};\n\nconst Pin = ({\n  pin,\n  toggle,\n  disabled = false,\n}: {\n  pin: ImmPin;\n  toggle: ((pin: ChipPin, bit?: number) => void) | undefined;\n  disabled?: boolean;\n}) => {\n  return (\n    <fieldset role=\"group\" style={{ width: `${pin.bits.length}rem` }}>\n      {pin.bits.map(([i, v]) => (\n        <button\n          key={i}\n          onClick={() => toggle?.(pin.pin, i)}\n          disabled={disabled}\n          data-testid={`pin-${i}`}\n        >\n          {v}\n        </button>\n      ))}\n    </fieldset>\n  );\n};\n","import raw from \"raw.macro\";\nimport ohm from \"ohm-js\";\nimport { int10, int16, int2 } from \"../util/twos\";\nimport { t } from \"@lingui/macro\";\nimport { Err, Ok, Result } from \"@davidsouther/jiffies/lib/esm/result\";\n\nexport const UNKNOWN_PARSE_ERROR = t`Unknown parse error`;\n\n// Reload .....\n\nconst baseGrammar = raw(\"./grammars/base.ohm\");\nexport const grammars = {\n  Base: ohm.grammar(baseGrammar),\n};\n\nexport const baseSemantics = grammars.Base.createSemantics();\n\nbaseSemantics.extendOperation(\"asIteration\", {\n  List(list, _) {\n    return list.asIteration();\n  },\n});\n\nbaseSemantics.addAttribute(\"value\", {\n  decNumber(_, digits): number {\n    return int10(digits.sourceString);\n  },\n  wholeDec(_, digits): number {\n    return int10(digits.sourceString);\n  },\n  binNumber(_, digits) {\n    return int2(digits.sourceString);\n  },\n  hexNumber(_, digits) {\n    return int16(digits.sourceString);\n  },\n  Number: (num) => {\n    return num.value;\n  },\n});\n\nbaseSemantics.addAttribute(\"name\", {\n  identifier(_, __): string {\n    return this.sourceString;\n  },\n  Name(_): string {\n    return this.child(0)?.name;\n  },\n});\n\nbaseSemantics.addAttribute(\"String\", {\n  String(_a, str, _b) {\n    return str.sourceString;\n  },\n});\n\nexport type ParseError = Error | { message: string; shortMessage: string };\n\nexport function makeParser<ResultType>(\n  grammar: ohm.Grammar,\n  semantics: ohm.Semantics,\n  property: (obj: ohm.Dict) => ResultType = ({ root }) => root\n): (source: string) => Result<ResultType, ParseError> {\n  return function parse(source) {\n    try {\n      const match = grammar.match(source);\n      if (match.succeeded()) {\n        const parsed = semantics(match);\n        const parse = property(parsed);\n        return Ok(parse);\n      } else {\n        return Err({\n          message: match.message ?? UNKNOWN_PARSE_ERROR,\n          shortMessage: match.shortMessage ?? UNKNOWN_PARSE_ERROR,\n        });\n      }\n    } catch (e) {\n      return Err(e as Error);\n    }\n  };\n}\n\nexport interface Span {\n  start: number;\n  end: number;\n}\n","/** Reads and parses HDL chip descriptions. */\nimport raw from \"raw.macro\";\nimport ohm from \"ohm-js\";\nimport { grammars, baseSemantics } from \"./base\";\nimport { makeParser } from \"./base\";\n\nexport interface PinIndex {\n  start?: number | undefined;\n  end?: number | undefined;\n}\n\nexport interface PinParts extends PinIndex {\n  pin: string;\n}\n\nexport interface PinDeclaration {\n  pin: string | string;\n  width: number;\n}\n\nexport interface Wire {\n  lhs: PinParts;\n  rhs: PinParts;\n}\n\nexport interface Part {\n  name: string;\n  wires: Wire[];\n}\n\nexport interface HdlParse {\n  name: string;\n  ins: PinDeclaration[];\n  outs: PinDeclaration[];\n  clocked: string[];\n  parts: \"BUILTIN\" | Part[];\n}\n\nconst hdlGrammar = raw(\"./grammars/hdl.ohm\");\nexport const grammar = ohm.grammar(hdlGrammar, grammars);\n\nexport const hdlSemantics = grammar.extendSemantics(baseSemantics);\n\nhdlSemantics.addAttribute<PinIndex>(\"SubBus\", {\n  SubBus(_a, startNode, endNode, _b) {\n    const start = startNode.value;\n    const end = endNode.child(0)?.child(1)?.value ?? start;\n    return { start, end };\n  },\n});\n\nhdlSemantics.addAttribute<PinParts>(\"WireSide\", {\n  WireSide({ name }, index) {\n    const { start, end } = (index.child(0)?.SubBus as PinIndex) ?? {\n      start: undefined,\n      end: undefined,\n    };\n    return { pin: name, start, end };\n  },\n});\n\nhdlSemantics.addAttribute<Wire>(\"Wire\", {\n  Wire(left, _, right) {\n    let rhs: PinParts = right.isTerminal()\n      ? { pin: right.sourceString }\n      : right.WireSide;\n    return { lhs: left.WireSide as PinParts, rhs };\n  },\n});\n\nhdlSemantics.addAttribute<Wire[]>(\"Wires\", {\n  Wires(list) {\n    return list.asIteration().children.map(({ Wire }: { Wire: Wire }) => Wire);\n  },\n});\n\nhdlSemantics.addAttribute<Part>(\"Part\", {\n  Part({ name }, _a, { Wires }, _b, _c) {\n    return { name: name as string, wires: Wires as Wire[] };\n  },\n});\n\nhdlSemantics.addAttribute<Part[] | \"BUILTIN\">(\"Parts\", {\n  Parts(_, parts) {\n    return parts.children.map((c) => c.Part);\n  },\n  BuiltinPart(_a, _b) {\n    return \"BUILTIN\";\n  },\n});\n\nhdlSemantics.addAttribute<\"BUILTIN\" | Part[]>(\"PartList\", {\n  PartList(list) {\n    return list.Parts;\n  },\n});\n\nhdlSemantics.addAttribute<string[]>(\"Clocked\", {\n  ClockedList(_a, clocked, _b) {\n    return (\n      clocked\n        .asIteration()\n        .children.map(\n          ({ sourceString }: { sourceString: string }) => sourceString\n        ) ?? []\n    );\n  },\n});\n\nhdlSemantics.addAttribute<PinDeclaration>(\"PinDecl\", {\n  PinDecl({ name }, width) {\n    return {\n      pin: name,\n      width: width.child(0)?.child(1)?.value ?? 1,\n    };\n  },\n});\n\nhdlSemantics.addAttribute<PinDeclaration[]>(\"PinList\", {\n  PinList(list) {\n    return list\n      .asIteration()\n      .children.map(({ PinDecl }: { PinDecl: PinDeclaration }) => PinDecl);\n  },\n});\n\nhdlSemantics.addAttribute<HdlParse>(\"Chip\", {\n  Chip(_a, { name }, _b, body, _c) {\n    return {\n      name,\n      ins: body.child(0).child(0)?.child(1)?.PinList ?? [],\n      outs: body.child(1).child(0)?.child(1)?.PinList ?? [],\n      parts: body.child(2).PartList ?? [],\n      clocked: body.child(3).child(0)?.Clocked,\n    };\n  },\n});\n\nhdlSemantics.addAttribute<HdlParse>(\"Root\", {\n  Root(root) {\n    return root.child(0)?.Chip;\n  },\n});\n\nexport const HDL = {\n  parser: grammar,\n  grammar: hdlGrammar,\n  semantics: hdlSemantics,\n  parse: makeParser<HdlParse>(grammar, hdlSemantics, (n) => n.Chip),\n};\n","/** Reads tst files to apply and perform test runs. */\n\nimport ohm from \"ohm-js\";\nimport raw from \"raw.macro\";\nimport { baseSemantics, grammars, makeParser, Span } from \"./base\";\n\nexport interface TstEchoOperation {\n  op: \"echo\";\n  message: string;\n}\n\nexport interface TstClearEchoOperation {\n  op: \"clear-echo\";\n}\n\nexport interface TstSetOperation {\n  op: \"set\";\n  id: string;\n  index?: number;\n  value: number;\n}\n\nexport interface TstEvalOperation {\n  op: \"eval\" | \"tick\" | \"tock\";\n}\n\nexport interface TstOutputOperation {\n  op: \"output\";\n}\n\nexport interface TstOutputSpec {\n  id: string;\n  builtin: boolean;\n  address: number;\n  style: \"D\" | \"X\" | \"B\" | \"S\";\n  width: number;\n  lpad: number;\n  rpad: number;\n}\n\nexport interface TstOutputListOperation {\n  op: \"output-list\";\n  spec: TstOutputSpec[];\n}\n\nexport interface TstLoadROMOperation {\n  op: \"load\";\n  file: string;\n}\n\nexport type TstOperation =\n  | TstEvalOperation\n  | TstEchoOperation\n  | TstClearEchoOperation\n  | TstOutputOperation\n  | TstSetOperation\n  | TstOutputListOperation\n  | TstLoadROMOperation;\n\nexport interface TstLineStatement {\n  ops: TstOperation[];\n  break?: true;\n  span: Span;\n}\n\nexport interface TstRepeat {\n  statements: TstLineStatement[];\n  count: number;\n}\n\nexport type TstStatement = TstLineStatement | TstRepeat;\n\nexport interface Tst {\n  lines: TstStatement[];\n}\n\nexport const tstGrammar = raw(\"./grammars/tst.ohm\");\nexport const grammar = ohm.grammar(tstGrammar, grammars);\nexport const tstSemantics = grammar.extendSemantics(baseSemantics);\n\ntstSemantics.extendAttribute<number>(\"value\", {\n  Index(_a, idx, _b) {\n    return idx?.child(0)?.value ?? -1;\n  },\n});\n\ntstSemantics.extendAttribute<string>(\"name\", {\n  FileName(name, _dot, ext) {\n    return `${name.name}.${ext.name}`;\n  },\n});\n\ntstSemantics.addAttribute<number>(\"index\", {\n  Index(_open, dec, _close) {\n    return dec.child(0)?.value ?? 0;\n  },\n});\n\ntstSemantics.addAttribute<TstOutputSpec>(\"format\", {\n  OutputFormat(\n    { name: id },\n    index,\n    _a,\n    { sourceString: style },\n    { value: lpad },\n    _b,\n    { value: width },\n    _c,\n    { value: rpad }\n  ) {\n    return {\n      id,\n      builtin: index?.child(0) !== undefined,\n      address: index?.child(0)?.value ?? -1,\n      style: style as TstOutputSpec[\"style\"],\n      width,\n      lpad,\n      rpad,\n    };\n  },\n});\n\ntstSemantics.addAttribute<TstOperation>(\"operation\", {\n  TstEvalOperation(op) {\n    return { op: op.sourceString as TstEvalOperation[\"op\"] };\n  },\n  TstOutputOperation(_) {\n    return { op: \"output\" };\n  },\n  TstOutputListOperation(_, formats) {\n    return {\n      op: \"output-list\",\n      spec: formats.children.map((n) => n.format),\n    };\n  },\n  TstSetOperation(op, { name }, index, { value }) {\n    const setOp: TstSetOperation = {\n      op: \"set\",\n      id: name,\n      value,\n    };\n    const child = index.child(0)?.child(1)?.child(0);\n    if (child) {\n      setOp.index = child.value;\n    }\n    return setOp;\n  },\n  TstEchoOperation(op, str) {\n    return {\n      op: \"echo\",\n      message: str.String as string,\n    };\n  },\n  TstClearEchoOperation(op) {\n    return {\n      op: \"clear-echo\",\n    };\n  },\n  TstLoadROMOperation(_r, _l, { name }) {\n    return {\n      op: \"load\",\n      file: name,\n    };\n  },\n});\n\ntstSemantics.addAttribute<TstStatement>(\"statement\", {\n  TstRepeat(op, { value: count }, _o, statements, _c) {\n    return {\n      statements: statements.children.map(({ statement }) => statement),\n      count,\n    };\n  },\n  TstStatement(list, end) {\n    const stmt: TstStatement = {\n      ops: list\n        .asIteration()\n        .children.map(\n          ({ operation }: { operation: TstOperation }) => operation\n        ),\n      span: {\n        start: this.source.startIdx,\n        end: this.source.endIdx,\n      },\n    };\n    if (end.sourceString === \"!\") {\n      stmt.break = true;\n    }\n    return stmt;\n  },\n});\n\ntstSemantics.addAttribute<Tst>(\"tst\", {\n  Tst(lines) {\n    return {\n      lines: lines.children.map((n) => n.statement),\n    };\n  },\n});\n\ntstSemantics.addAttribute<Tst>(\"root\", {\n  Root({ tst }) {\n    return tst;\n  },\n});\n\nexport const TST = {\n  grammar: tstGrammar,\n  semantics: tstSemantics,\n  parser: grammar,\n  parse: makeParser<Tst>(grammar, tstSemantics),\n};\n","import { Chip, HIGH, LOW, Voltage } from \"../../chip\";\n\nexport function and(a: Voltage, b: Voltage): [Voltage] {\n  return [a === 1 && b === 1 ? HIGH : LOW];\n}\n\nexport function and16(a: number, b: number): [number] {\n  return [a & b & 0xffff];\n}\n\nexport class And extends Chip {\n  constructor() {\n    super([\"a\", \"b\"], [\"out\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"a\").voltage();\n    const b = this.in(\"b\").voltage();\n    const [n] = and(a, b);\n    this.out().pull(n);\n  }\n}\n\nexport class And16 extends Chip {\n  constructor() {\n    super([\"a[16]\", \"b[16]\"], [\"out[16]\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"a\").busVoltage;\n    const b = this.in(\"b\").busVoltage;\n    const [n] = and16(a, b);\n    this.out().busVoltage = n;\n  }\n}\n","import { Chip, HIGH, LOW, Voltage } from \"../../chip\";\n\nexport function dmux(inn: Voltage, sel: Voltage): [Voltage, Voltage] {\n  const a = sel === LOW && inn === HIGH ? HIGH : LOW;\n  const b = sel === HIGH && inn === HIGH ? HIGH : LOW;\n  return [a, b];\n}\n\nexport function dmux4way(\n  inn: Voltage,\n  sel: number\n): [Voltage, Voltage, Voltage, Voltage] {\n  const a = sel === 0b00 && inn === HIGH ? HIGH : LOW;\n  const b = sel === 0b01 && inn === HIGH ? HIGH : LOW;\n  const c = sel === 0b10 && inn === HIGH ? HIGH : LOW;\n  const d = sel === 0b11 && inn === HIGH ? HIGH : LOW;\n  return [a, b, c, d];\n}\n\nexport function dmux8way(\n  inn: Voltage,\n  sel: number\n): [Voltage, Voltage, Voltage, Voltage, Voltage, Voltage, Voltage, Voltage] {\n  const a = sel === 0b000 && inn === HIGH ? HIGH : LOW;\n  const b = sel === 0b001 && inn === HIGH ? HIGH : LOW;\n  const c = sel === 0b010 && inn === HIGH ? HIGH : LOW;\n  const d = sel === 0b011 && inn === HIGH ? HIGH : LOW;\n  const e = sel === 0b100 && inn === HIGH ? HIGH : LOW;\n  const f = sel === 0b101 && inn === HIGH ? HIGH : LOW;\n  const g = sel === 0b110 && inn === HIGH ? HIGH : LOW;\n  const h = sel === 0b111 && inn === HIGH ? HIGH : LOW;\n  return [a, b, c, d, e, f, g, h];\n}\n\nexport class DMux extends Chip {\n  constructor() {\n    super([\"in\", \"sel\"], [\"a\", \"b\"]);\n  }\n\n  override eval() {\n    const inn = this.in(\"in\").voltage();\n    const sel = this.in(\"sel\").voltage();\n\n    const [a, b] = dmux(inn, sel);\n    this.out(\"a\").pull(a);\n    this.out(\"b\").pull(b);\n  }\n}\n\nexport class DMux4Way extends Chip {\n  constructor() {\n    super([\"in\", \"sel[2]\"], [\"a\", \"b\", \"c\", \"d\"]);\n  }\n\n  override eval() {\n    const inn = this.in(\"in\").voltage();\n    const sel = this.in(\"sel\").busVoltage;\n\n    const [a, b, c, d] = dmux4way(inn, sel);\n    this.out(\"a\").pull(a);\n    this.out(\"b\").pull(b);\n    this.out(\"c\").pull(c);\n    this.out(\"d\").pull(d);\n  }\n}\n\nexport class DMux8Way extends Chip {\n  constructor() {\n    super([\"in\", \"sel[3]\"], [\"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\"]);\n  }\n\n  override eval() {\n    const inn = this.in(\"in\").voltage();\n    const sel = this.in(\"sel\").busVoltage;\n\n    const [a, b, c, d, e, f, g, h] = dmux8way(inn, sel);\n    this.out(\"a\").pull(a);\n    this.out(\"b\").pull(b);\n    this.out(\"c\").pull(c);\n    this.out(\"d\").pull(d);\n    this.out(\"e\").pull(e);\n    this.out(\"f\").pull(f);\n    this.out(\"g\").pull(g);\n    this.out(\"h\").pull(h);\n  }\n}\n","import { Chip, LOW, Voltage } from \"../../chip\";\n\nexport function mux(a: Voltage, b: Voltage, sel: Voltage): [Voltage] {\n  return [sel === LOW ? a : b];\n}\n\nexport function mux16(a: number, b: number, sel: Voltage): [number] {\n  return [sel === LOW ? a : b];\n}\n\nexport function mux16_4(\n  a: number,\n  b: number,\n  c: number,\n  d: number,\n  sel: number\n): [number] {\n  const s2 = (sel & 0b01) as Voltage;\n  return (sel & 0b10) === 0b00 ? mux16(a, b, s2) : mux16(c, d, s2);\n}\n\nexport function mux16_8(\n  a: number,\n  b: number,\n  c: number,\n  d: number,\n  e: number,\n  f: number,\n  g: number,\n  h: number,\n  sel: number\n): [number] {\n  const s2 = (sel & 0b11) as Voltage;\n  return (sel & 0b100) === 0b000\n    ? mux16_4(a, b, c, d, s2)\n    : mux16_4(e, f, g, h, s2);\n}\n\nexport class Mux extends Chip {\n  constructor() {\n    super([\"a\", \"b\", \"sel\"], [\"out\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"a\").voltage();\n    const b = this.in(\"b\").voltage();\n    const sel = this.in(\"sel\").voltage();\n\n    const [set] = mux(a, b, sel);\n    this.out().pull(set);\n  }\n}\n\nexport class Mux16 extends Chip {\n  constructor() {\n    super([\"a[16]\", \"b[16]\", \"sel\"], [\"out[16]\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"a\").busVoltage;\n    const b = this.in(\"b\").busVoltage;\n    const sel = this.in(\"sel\").voltage();\n    const [out] = mux16(a, b, sel);\n    this.out().busVoltage = out;\n  }\n}\n\nexport class Mux4Way16 extends Chip {\n  constructor() {\n    super([\"a[16]\", \"b[16]\", \"c[16]\", \"d[16]\", \"sel[2]\"], [\"out[16]\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"a\").busVoltage;\n    const b = this.in(\"b\").busVoltage;\n    const c = this.in(\"c\").busVoltage;\n    const d = this.in(\"d\").busVoltage;\n    const sel = this.in(\"sel\").busVoltage;\n    const [out] = mux16_4(a, b, c, d, sel);\n\n    this.out().busVoltage = out;\n  }\n}\n\nexport class Mux8Way16 extends Chip {\n  constructor() {\n    super(\n      [\n        \"a[16]\",\n        \"b[16]\",\n        \"c[16]\",\n        \"d[16]\",\n        \"e[16]\",\n        \"f[16]\",\n        \"g[16]\",\n        \"h[16]\",\n        \"sel[3]\",\n      ],\n      [\"out[16]\"]\n    );\n  }\n\n  override eval() {\n    const a = this.in(\"a\").busVoltage;\n    const b = this.in(\"b\").busVoltage;\n    const c = this.in(\"c\").busVoltage;\n    const d = this.in(\"d\").busVoltage;\n    const e = this.in(\"e\").busVoltage;\n    const f = this.in(\"f\").busVoltage;\n    const g = this.in(\"g\").busVoltage;\n    const h = this.in(\"h\").busVoltage;\n    const sel = this.in(\"sel\").busVoltage;\n    const [out] = mux16_8(a, b, c, d, e, f, g, h, sel);\n\n    this.out().busVoltage = out;\n  }\n}\n","import { nand16 } from \"../../../../util/twos\";\nimport { HIGH, LOW, Chip, Voltage } from \"../../chip\";\n\nexport function nand(a: Voltage, b: Voltage): [Voltage] {\n  return [a === 1 && b === 1 ? LOW : HIGH];\n}\n\nexport class Nand extends Chip {\n  constructor() {\n    super([\"a\", \"b\"], [\"out\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"a\").voltage();\n    const b = this.in(\"b\").voltage();\n    const [out] = nand(a, b);\n    this.out().pull(out);\n  }\n}\n\nexport class Nand16 extends Chip {\n  constructor() {\n    super([\"a[16]\", \"b[16]\"], [\"out[16]\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"a\").busVoltage;\n    const b = this.in(\"b\").busVoltage;\n    this.out().busVoltage = nand16(a, b);\n  }\n}\n","import { Chip, HIGH, LOW, Voltage } from \"../../chip\";\n\nexport function not(inn: Voltage): [Voltage] {\n  return [inn === LOW ? HIGH : LOW];\n}\n\nexport function not16(inn: number): [number] {\n  return [~inn & 0xffff];\n}\n\nexport class Not extends Chip {\n  constructor() {\n    super([\"in\"], [\"out\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"in\").voltage();\n    const [out] = not(a);\n    this.out().pull(out);\n  }\n}\n\nexport class Not16 extends Chip {\n  constructor() {\n    super([\"in[16]\"], [\"out[16]\"]);\n  }\n\n  override eval() {\n    const [n] = not16(this.in().busVoltage);\n    this.out().busVoltage = n;\n  }\n}\n","import { Chip, HIGH, LOW, Voltage } from \"../../chip\";\n\nexport function or(a: Voltage, b: Voltage): [Voltage] {\n  return [a === 1 || b === 1 ? HIGH : LOW];\n}\n\nexport function or16(a: number, b: number): [number] {\n  return [(a | b) & 0xffff];\n}\n\nexport function or8way(a: number): [Voltage] {\n  return [(a & 0xff) === 0 ? LOW : HIGH];\n}\n\nexport class Or extends Chip {\n  constructor() {\n    super([\"a\", \"b\"], [\"out\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"a\").voltage();\n    const b = this.in(\"b\").voltage();\n    const [out] = or(a, b);\n    this.out().pull(out);\n  }\n}\n\nexport class Or16 extends Chip {\n  constructor() {\n    super([\"a[16]\", \"b[16]\"], [\"out[16]\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"a\").busVoltage;\n    const b = this.in(\"b\").busVoltage;\n    const [out] = or16(a, b);\n    this.out().busVoltage = out;\n  }\n}\n\nexport class Or8way extends Chip {\n  constructor() {\n    super([\"in[8]\"], [\"out\"], \"Or8way\");\n  }\n\n  override eval() {\n    const inn = this.in().busVoltage;\n    const [out] = or8way(inn);\n    this.out().pull(out);\n  }\n}\n","import { Chip, HIGH, LOW, Voltage } from \"../../chip\";\n\nexport function xor(a: Voltage, b: Voltage): [Voltage] {\n  return [(a === HIGH && b === LOW) || (a === LOW && b === HIGH) ? HIGH : LOW];\n}\n\nexport function xor16(a: number, b: number): [number] {\n  return [(a ^ b) & 0xffff];\n}\n\nexport class Xor extends Chip {\n  constructor() {\n    super([\"a\", \"b\"], [\"out\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"a\").voltage();\n    const b = this.in(\"b\").voltage();\n    const [out] = xor(a, b);\n    this.out().pull(out);\n  }\n}\n\nexport class Xor16 extends Chip {\n  constructor() {\n    super([\"a[16]\", \"b[16]\"], [\"out[16]\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"a\").busVoltage;\n    const b = this.in(\"b\").busVoltage;\n    const [out] = xor16(a, b);\n    this.out().busVoltage = out;\n  }\n}\n","import { Chip } from \"../../chip\";\n\nexport function add16(a: number, b: number): [number] {\n  return [(a + b) & 0xffff];\n}\n\nexport class Add16 extends Chip {\n  constructor() {\n    super([\"a[16]\", \"b[16]\"], [\"out[16]\"], \"Add16\");\n  }\n\n  override eval() {\n    const a = this.in(\"a\").busVoltage;\n    const b = this.in(\"b\").busVoltage;\n    const [out] = add16(a, b);\n    this.out().busVoltage = out;\n  }\n}\n","import { COMMANDS, COMMANDS_OP, Flags } from \"../../simulator/cpu/alu\";\nimport { bin } from \"../../util/twos\";\n\nexport const ALUComponent = ({\n  A,\n  op,\n  D,\n  out,\n  flag,\n}: {\n  A: number;\n  op: COMMANDS_OP;\n  D: number;\n  out: number;\n  flag: keyof typeof Flags;\n}) => (\n  <div>\n    <span>ALU</span>\n    <dl>\n      <dt>A</dt> <dd>{bin(A)}</dd>\n      <dt>op</dt> <dd>{COMMANDS.op[op] ?? \"(??)\"}</dd>\n      <dt>D</dt> <dd>{bin(D)}</dd>\n      <dt>=</dt> <dd>{bin(out)}</dd>\n      <dd>{Flags[flag as keyof typeof Flags]}</dd>\n    </dl>\n  </div>\n);\n","import { ALUComponent } from \"../../../../components/chips/alu\";\nimport { alu, COMMANDS_OP, Flags } from \"../../../cpu/alu\";\nimport { Chip, HIGH, LOW } from \"../../chip\";\n\nexport class ALUNoStat extends Chip {\n  constructor() {\n    super(\n      [\n        \"x[16]\",\n        \"y[16]\", // 16-bit inputs\n        \"zx\", // zero the x input?\n        \"nx\", // negate the x input?\n        \"zy\", // zero the y input?\n        \"ny\", // negate the y input?\n        \"f\", // compute out = x + y (if 1) or x & y (if 0)\n        \"no\", // negate the out output?\n      ],\n      [\n        \"out[16]\", // 16-bit output\n      ],\n      \"ALU\"\n    );\n  }\n\n  override eval() {\n    const x = this.in(\"x\").busVoltage;\n    const y = this.in(\"y\").busVoltage;\n    const zx = this.in(\"zx\").busVoltage << 5;\n    const nx = this.in(\"nx\").busVoltage << 4;\n    const zy = this.in(\"zy\").busVoltage << 3;\n    const ny = this.in(\"ny\").busVoltage << 2;\n    const f = this.in(\"f\").busVoltage << 1;\n    const no = this.in(\"no\").busVoltage << 0;\n    const op = zx + nx + zy + ny + f + no;\n    const [out] = alu(op, x, y);\n    this.out().busVoltage = out;\n  }\n}\n\nexport class ALU extends Chip {\n  constructor() {\n    super(\n      [\n        \"x[16]\",\n        \"y[16]\", // 16-bit inputs\n        \"zx\", // zero the x input?\n        \"nx\", // negate the x input?\n        \"zy\", // zero the y input?\n        \"ny\", // negate the y input?\n        \"f\", // compute out = x + y (if 1) or x & y (if 0)\n        \"no\", // negate the out output?\n      ],\n      [\n        \"out[16]\", // 16-bit output\n        \"zr\", // 1 if (out === 0), 0 otherwise\n        \"ng\", // 1 if (out < 0),  0 otherwise\n      ],\n      \"ALU\"\n    );\n  }\n\n  override render() {\n    return [\n      <ALUComponent\n        A={this.in(\"x\").busVoltage}\n        op={this.op()}\n        D={this.in(\"y\").busVoltage}\n        out={this.out().busVoltage}\n        flag={\n          (this.out(\"zr\").voltage() === HIGH\n            ? Flags.Zero\n            : this.out(\"ng\").voltage() === HIGH\n            ? Flags.Negative\n            : Flags.Positive) as keyof typeof Flags\n        }\n      />,\n    ];\n  }\n\n  override eval() {\n    const x = this.in(\"x\").busVoltage;\n    const y = this.in(\"y\").busVoltage;\n    const zx = this.in(\"zx\").busVoltage << 5;\n    const nx = this.in(\"nx\").busVoltage << 4;\n    const zy = this.in(\"zy\").busVoltage << 3;\n    const ny = this.in(\"ny\").busVoltage << 2;\n    const f = this.in(\"f\").busVoltage << 1;\n    const no = this.in(\"no\").busVoltage << 0;\n    const op = zx + nx + zy + ny + f + no;\n    const [out, flags] = alu(op, x, y);\n    const ng = flags === Flags.Negative ? HIGH : LOW;\n    const zr = flags === Flags.Zero ? HIGH : LOW;\n    this.out(\"out\").busVoltage = out;\n    this.out(\"ng\").pull(ng);\n    this.out(\"zr\").pull(zr);\n  }\n\n  op(): COMMANDS_OP {\n    const zx = this.in(\"zx\").busVoltage << 5;\n    const nx = this.in(\"nx\").busVoltage << 4;\n    const zy = this.in(\"zy\").busVoltage << 3;\n    const ny = this.in(\"ny\").busVoltage << 2;\n    const f = this.in(\"f\").busVoltage << 1;\n    const no = this.in(\"no\").busVoltage << 0;\n    const op = zx + nx + zy + ny + f + no;\n    return op as COMMANDS_OP;\n  }\n}\n","import { Chip, HIGH, LOW, Voltage } from \"../../chip\";\n\nexport function halfAdder(a: Voltage, b: Voltage): [Voltage, Voltage] {\n  const sum = (a === 1 && b === 0) || (a === 0 && b === 1) ? HIGH : LOW;\n  const car = a === 1 && b === 1 ? HIGH : LOW;\n\n  return [sum, car];\n}\n\nexport class HalfAdder extends Chip {\n  constructor() {\n    super([\"a\", \"b\"], [\"sum\", \"carry\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"a\").voltage();\n    const b = this.in(\"b\").voltage();\n    const [sum, carry] = halfAdder(a, b);\n    this.out(\"sum\").pull(sum);\n    this.out(\"carry\").pull(carry);\n  }\n}\n","import { Chip, Voltage } from \"../../chip\";\nimport { or } from \"../logic/or\";\nimport { halfAdder } from \"./half_adder\";\n\nexport function fullAdder(\n  a: Voltage,\n  b: Voltage,\n  c: Voltage\n): [Voltage, Voltage] {\n  const [s, ca] = halfAdder(a, b);\n  const [sum, cb] = halfAdder(s, c);\n  const [carry] = or(ca, cb);\n\n  return [sum, carry];\n}\n\nexport class FullAdder extends Chip {\n  constructor() {\n    super([\"a\", \"b\", \"c\"], [\"sum\", \"carry\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"a\").voltage();\n    const b = this.in(\"b\").voltage();\n    const c = this.in(\"c\").voltage();\n    const [sum, carry] = fullAdder(a, b, c);\n    this.out(\"sum\").pull(sum);\n    this.out(\"carry\").pull(carry);\n  }\n}\n","import { Chip } from \"../../chip\";\nimport { add16 } from \"./add_16\";\n\nexport function inc16(n: number): [number] {\n  return add16(n, 1);\n}\n\nexport class Inc16 extends Chip {\n  constructor() {\n    super([\"in[16]\"], [\"out[16]\"], \"Inc16\");\n  }\n\n  override eval() {\n    const a = this.in().busVoltage;\n    const [out] = inc16(a);\n    this.out().busVoltage = out;\n  }\n}\n","import { dec } from \"../../util/twos\";\n\nexport const RegisterComponent = ({\n  name,\n  bits,\n}: {\n  name: string;\n  bits: number;\n}) => (\n  <div>\n    {name}: {dec(bits)}\n  </div>\n);\n","import { RegisterComponent } from \"../../../../components/chips/register\";\nimport { ClockedChip, HIGH, LOW, Pin, Voltage } from \"../../chip\";\n\nexport class Bit extends ClockedChip {\n  bit: Voltage = LOW;\n\n  constructor(name?: string) {\n    super([\"in\", \"load\"], [\"out\"], name);\n  }\n\n  override tick() {\n    if (this.in(\"load\").voltage() === HIGH) {\n      this.bit = this.in().voltage();\n    }\n  }\n\n  override tock() {\n    this.out().pull(this.bit ?? 0);\n  }\n}\n\nexport class Register extends ClockedChip {\n  bits: number = 0x00;\n\n  constructor(name?: string) {\n    super([\"in[16]\", \"load\"], [\"out[16]\"], name);\n  }\n\n  override tick() {\n    if (this.in(\"load\").voltage() === HIGH) {\n      this.bits = this.in().busVoltage & 0xffff;\n    }\n  }\n\n  override tock() {\n    this.out().busVoltage = this.bits & 0xffff;\n  }\n\n  override get(name: string, offset?: number): Pin | undefined {\n    return name === this.name ? this.out() : super.get(name, offset);\n  }\n}\n\nexport class VRegister extends Register {\n  override render() {\n    return [\n      <RegisterComponent\n        name={this.name ?? `Chip ${this.id}`}\n        bits={this.bits}\n      />,\n    ];\n  }\n}\n\nexport class PC extends ClockedChip {\n  bits: number = 0x00;\n\n  constructor(name?: string) {\n    super([\"in[16]\", \"load\", \"inc\", \"reset\"], [\"out[16]\"], name);\n  }\n\n  override render() {\n    return [<RegisterComponent name=\"PC\" bits={this.bits} />];\n  }\n\n  override tick() {\n    if (this.in(\"reset\").voltage() === HIGH) {\n      this.bits = 0;\n    } else if (this.in(\"load\").voltage() === HIGH) {\n      this.bits = this.in().busVoltage & 0xffff;\n    } else if (this.in(\"inc\").voltage() === HIGH) {\n      this.bits += 1;\n    }\n  }\n\n  override tock() {\n    this.out().busVoltage = this.bits & 0xffff;\n  }\n\n  override get(name: string, offset?: number): Pin | undefined {\n    return name === this.name ? this.out() : super.get(name, offset);\n  }\n}\n","import { ClockedChip } from \"../../chip\";\n\nexport class DFF extends ClockedChip {\n  constructor(name?: string) {\n    super([\"in\"], [\"out\"], name, [\"t\"]);\n  }\n\n  override tick() {\n    // Read in into t\n    let t = this.in().voltage();\n    this.pin(\"t\").pull(t);\n  }\n\n  override tock() {\n    // write t into out\n    let t = this.pin(\"t\").voltage();\n    this.out().pull(t);\n  }\n}\n","import { assertExists } from \"@davidsouther/jiffies/lib/esm/assert\";\nimport ohm from \"ohm-js\";\nimport raw from \"raw.macro\";\nimport {\n  ASSIGN,\n  ASSIGN_ASM,\n  ASSIGN_OP,\n  COMMANDS,\n  COMMANDS_ASM,\n  COMMANDS_OP,\n  JUMP,\n  JUMP_ASM,\n  JUMP_OP,\n} from \"../simulator/cpu/alu\";\nimport { KEYBOARD, SCREEN } from \"../simulator/cpu/memory\";\nimport { makeC } from \"../util/asm\";\nimport { grammars, makeParser, baseSemantics } from \"./base\";\n\nexport const asmGrammar = raw(\"./grammars/asm.ohm\");\nexport const grammar = ohm.grammar(asmGrammar, grammars);\nexport const asmSemantics = grammar.extendSemantics(baseSemantics);\n\n// reload ...\n\nexport interface Asm {\n  instructions: AsmInstruction[];\n}\n\nexport type AsmInstruction =\n  | AsmAInstruction\n  | AsmCInstruction\n  | AsmLabelInstruction;\n\nexport type AsmAInstruction = AsmALabelInstruction | AsmAValueInstruction;\nexport interface AsmALabelInstruction {\n  type: \"A\";\n  label: string;\n}\n\nexport interface AsmAValueInstruction {\n  type: \"A\";\n  value: number;\n}\n\nfunction isALabelInstruction(\n  inst: AsmAInstruction\n): inst is AsmALabelInstruction {\n  return (inst as AsmALabelInstruction).label !== undefined;\n}\n\nexport interface AsmCInstruction {\n  type: \"C\";\n  op: COMMANDS_OP;\n  isM: boolean;\n  store?: ASSIGN_OP;\n  jump?: JUMP_OP;\n}\n\nexport interface AsmLabelInstruction {\n  type: \"L\";\n  label: string;\n}\n\nasmSemantics.addAttribute<Asm>(\"asm\", {\n  Root(asm) {\n    return {\n      instructions: asm\n        .child(0)\n        .children.map(({ instruction }) => instruction as AsmInstruction),\n    };\n  },\n});\n\nasmSemantics.addAttribute<AsmInstruction>(\"instruction\", {\n  AInstruction(_at, val): AsmAInstruction {\n    try {\n      return {\n        type: \"A\",\n        value: val.value,\n      };\n    } catch (e) {}\n    try {\n      return {\n        type: \"A\",\n        label: val.name,\n      };\n    } catch (e) {}\n\n    throw new Error(`AsmAInstruction must have either a name or a value`);\n  },\n  CInstruction(assignN, opN, jmpN): AsmCInstruction {\n    const assign = assignN.child(0)?.child(0)?.sourceString as ASSIGN_ASM;\n    const op = opN.sourceString as COMMANDS_ASM;\n    const jmp = jmpN.child(0)?.child(1)?.sourceString as JUMP_ASM;\n    const isM =\n      assignN.sourceString.includes(\"M\") || opN.sourceString.includes(\"M\");\n    const inst: AsmCInstruction = {\n      type: \"C\",\n      op: COMMANDS.asm[op],\n      isM,\n    };\n    if (jmp) inst.jump = JUMP.asm[jmp];\n    if (assign) inst.store = ASSIGN.asm[assign];\n    return inst;\n  },\n  Label(_o, { name }, _c): AsmLabelInstruction {\n    return {\n      type: \"L\",\n      label: name,\n    };\n  },\n});\n\nexport function fillLabel(asm: Asm) {\n  const symbols = new Map<string, number>([\n    [\"R0\", 0],\n    [\"R1\", 1],\n    [\"R2\", 2],\n    [\"R3\", 3],\n    [\"R4\", 4],\n    [\"R5\", 5],\n    [\"R6\", 6],\n    [\"R7\", 7],\n    [\"R8\", 8],\n    [\"R9\", 9],\n    [\"R10\", 10],\n    [\"R11\", 11],\n    [\"R12\", 12],\n    [\"R13\", 13],\n    [\"R14\", 14],\n    [\"R15\", 15],\n    [\"SP\", 0],\n    [\"LCL\", 1],\n    [\"ARG\", 2],\n    [\"THIS\", 3],\n    [\"THAT\", 4],\n    [\"SCREEN\", SCREEN],\n    [\"KBD\", KEYBOARD],\n  ]);\n\n  function transmuteAInstruction(instruction: AsmALabelInstruction) {\n    const value = assertExists(symbols.get(instruction.label));\n    (instruction as unknown as AsmAValueInstruction).value = value;\n    delete (instruction as unknown as { label: undefined }).label;\n  }\n\n  let unfilled: AsmALabelInstruction[] = [];\n  let line = 0;\n  for (const instruction of asm.instructions) {\n    if (instruction.type === \"L\") {\n      if (symbols.has(instruction.label)) {\n        throw new Error(`ASM Duplicate label ${instruction.label}`);\n      } else {\n        symbols.set(instruction.label, line);\n      }\n      continue;\n    }\n\n    line += 1;\n\n    if (instruction.type === \"A\") {\n      if (isALabelInstruction(instruction)) {\n        unfilled.push(instruction);\n      }\n    }\n  }\n\n  unfilled.forEach(transmuteAInstruction);\n}\n\nexport function emit(asm: Asm): number[] {\n  return asm.instructions\n    .map((inst) => {\n      if (inst.type === \"A\") {\n        if (isALabelInstruction(inst)) {\n          throw new Error(`ASM Emitting unfilled A instruction`);\n        }\n        return inst.value;\n      }\n      if (inst.type === \"C\") {\n        return makeC(inst.isM, inst.op, inst.store, inst.jump);\n      }\n      return undefined;\n    })\n    .filter((op): op is number => op !== undefined);\n}\n\nexport const ASM = {\n  grammar: asmGrammar,\n  semantics: asmSemantics,\n  parser: grammar,\n  parse: makeParser<Asm>(grammar, asmSemantics),\n  passes: {\n    fillLabel,\n    emit,\n  },\n};\n","import { FileSystem } from \"@davidsouther/jiffies/lib/esm/fs\";\nimport { Err, isErr, Ok } from \"@davidsouther/jiffies/lib/esm/result\";\nimport { ASM } from \"../languages/asm\";\nimport { int2 } from \"../util/twos\";\n\nexport async function load(fs: FileSystem, path: string): Promise<number[]> {\n  if (path.endsWith(\".hack\")) {\n    return loadHack(fs, path);\n  }\n\n  if (path.endsWith(\".asm\")) {\n    return loadAsm(fs, path);\n  }\n\n  throw new Error(`Cannot load file without hack or asm extension ${path}`);\n}\n\nexport async function loadAsm(fs: FileSystem, path: string): Promise<number[]> {\n  const source = await fs.readFile(path);\n  const parsed = ASM.parse(source);\n  if (isErr(parsed)) {\n    throw Err(parsed);\n  }\n\n  const asm = Ok(parsed);\n  ASM.passes.fillLabel(asm);\n  return ASM.passes.emit(asm);\n}\n\nexport async function loadHack(\n  fs: FileSystem,\n  path: string\n): Promise<number[]> {\n  return (await fs.readFile(path))\n    .split(\"\\n\")\n    .filter((line) => line.trim() !== \"\")\n    .map(int2);\n}\n","import { assert } from \"@davidsouther/jiffies/lib/esm/assert\";\nimport { FileSystem } from \"@davidsouther/jiffies/lib/esm/fs\";\nimport { op } from \"../../util/asm\";\nimport { int10, int16, int2 } from \"../../util/twos\";\nimport { load } from \"../fs\";\n\nexport const FORMATS = [\"bin\", \"dec\", \"hex\", \"asm\"];\nexport type Format = typeof FORMATS[number];\n\nexport const SCREEN = 0x4000;\nexport const SCREEN_ROWS = 512;\nexport const SCREEN_COLS = 256;\nexport const KEYBOARD = 0x6000;\n\nexport class Memory {\n  #memory: Int16Array;\n\n  get size(): number {\n    return this.#memory.length;\n  }\n\n  constructor(memory: ArrayBuffer | number) {\n    if (typeof memory === \"number\") {\n      this.#memory = new Int16Array(memory);\n    } else {\n      this.#memory = new Int16Array(memory);\n    }\n  }\n\n  get(index: number): number {\n    if (index < 0 || index >= this.size) {\n      return 0xffff;\n    }\n    return this.#memory[index] ?? 0;\n  }\n\n  set(index: number, value: number): void {\n    if (index >= 0 && index < this.size) {\n      this.#memory[index] = value & 0xffff;\n    }\n  }\n\n  update(cell: number, value: string, format: Format) {\n    let current: number;\n    switch (format) {\n      case \"asm\":\n        current = op(value);\n        break;\n      case \"bin\":\n        current = int2(value);\n        break;\n      case \"hex\":\n        current = int16(value);\n        break;\n      case \"dec\":\n      default:\n        current = int10(value);\n        break;\n    }\n\n    if (isFinite(current) && current <= 0xffff) {\n      this.set(cell, current);\n    }\n  }\n\n  async load(fs: FileSystem, path: string) {\n    try {\n      (await load(fs, path)).map((v, i) => this.set(i, v));\n    } catch (cause) {\n      // throw new Error(`ROM32K Failed to load file ${path}`, { cause });\n      throw new Error(`Memory Failed to load file ${path}`);\n    }\n  }\n\n  range(start = 0, end = this.size): number[] {\n    return [...this.#memory.slice(start, end)];\n  }\n\n  *map<T>(\n    fn: (index: number, value: number) => T,\n    start = 0,\n    end = this.size\n  ): Iterable<T> {\n    assert(start < end);\n    for (let i = start; i < end; i++) {\n      yield fn(i, this.get(i));\n    }\n  }\n}\n","import produce from \"immer\";\nimport { Dispatch, useEffect, useReducer, useState } from \"react\";\n\nexport function useImmerReducer<T, Reducers extends Record<string, Function>>(\n  reducers: Reducers,\n  initialState: T\n) {\n  return useReducer(\n    (\n      state: T,\n      command: {\n        action: keyof Reducers;\n        payload?: {};\n      }\n    ) =>\n      produce(state, (draft: T) => {\n        reducers[command.action](draft, command.payload as any);\n      }),\n    initialState\n  );\n}\n\nexport function useStateInitializer<T>(init: T): [T, Dispatch<T>] {\n  const [state, setState] = useState<T>(init);\n  useEffect(() => {\n    setState(init);\n  }, [init]);\n  return [state, setState];\n}\n","import { width } from \"@davidsouther/jiffies/lib/esm/dom/css/sizing\";\nimport { useCallback, useState } from \"react\";\nimport { useStateInitializer } from \"../../util/react\";\n\nconst Mode = { VIEW: 0, EDIT: 1 };\n\nexport const InlineEdit = (props: {\n  mode?: keyof typeof Mode;\n  value: string;\n  onChange: (value: string) => void;\n}) => {\n  const [mode, setMode] = useState(props.mode ?? Mode.VIEW);\n  const [value, setValue] = useStateInitializer(props.value);\n\n  const render = () => {\n    switch (mode) {\n      case Mode.EDIT:\n        return edit();\n      case Mode.VIEW:\n        return view();\n      default:\n        return <span />;\n    }\n  };\n\n  const view = () => (\n    <span\n      style={{ cursor: \"text\", ...width(\"full\", \"inline\") }}\n      onClick={() => {\n        setMode(Mode.EDIT);\n      }}\n    >\n      {value}\n    </span>\n  );\n\n  const doSelect = useCallback(\n    (ref: HTMLInputElement | null) => ref?.select(),\n    []\n  );\n  const doChange = useCallback(\n    (target: EventTarget & HTMLInputElement) => {\n      setMode(Mode.VIEW);\n      setValue(target.value ?? \"\");\n      props.onChange(target.value ?? \"\");\n    },\n    [props, setMode, setValue]\n  );\n  const edit = () => {\n    const edit = (\n      <span style={{ display: \"block\", position: \"relative\" }}>\n        <input\n          ref={doSelect}\n          style={{\n            zIndex: \"10\",\n            position: \"absolute\",\n            left: \"0\",\n            marginTop: \"-0.375rem\",\n          }}\n          onBlur={({ target }) => doChange(target)}\n          onKeyPress={({ key, target }) => {\n            if (key === \"Enter\") {\n              doChange(target);\n            }\n          }}\n          type=\"text\"\n          defaultValue={value}\n        />\n      </span>\n    );\n    return edit;\n  };\n\n  return render();\n};\n\nexport default InlineEdit;\n","import {\n  Key,\n  MutableRefObject,\n  ReactNode,\n  useCallback,\n  useEffect,\n  useMemo,\n  useReducer,\n  useRef,\n} from \"react\";\n\nexport interface VirtualScrollSettings {\n  /**Minimum offset into the adapter. Default is 0.  */\n  minIndex: number;\n  /** Maximum offset into the adapter. Default is Number.MAX_SAFE_INTEGER.  */\n  maxIndex: number;\n  /** Initial index to start rendering from. Default is minIndex.  */\n  startIndex: number;\n  /**\n   * Number of items to render in visible area. Default is entire range from\n   * minIndex to maxIndex.\n   */\n  count: number;\n  /**\n   * Maximum number of items to render on either side of the visible area.\n   * Default is `count`.\n   */\n  tolerance: number;\n  /** Height of each item, in pixels. Default is 20px. */\n  itemHeight: number;\n}\n\nexport interface VirtualScrollDataAdapter<T> {\n  (offset: number, limit: number): Iterable<T>;\n}\n\nexport function arrayAdapter<T>(data: T[]): VirtualScrollDataAdapter<T> {\n  return (offset, limit) => data.slice(offset, offset + limit);\n}\n\nexport interface VirtualScrollProps<T, U extends ReactNode> {\n  settings?: Partial<VirtualScrollSettings>;\n  get: VirtualScrollDataAdapter<T>;\n  row: (t: T) => U;\n  rowKey: (t: T) => Key;\n}\n\nexport function fillVirtualScrollSettings(\n  settings: Partial<VirtualScrollSettings>\n): VirtualScrollSettings {\n  const {\n    minIndex = 0,\n    maxIndex = Number.MAX_SAFE_INTEGER,\n    startIndex = 0,\n    itemHeight = 20,\n    count = maxIndex - minIndex + 1,\n    tolerance = count,\n  } = settings;\n\n  return { minIndex, maxIndex, startIndex, itemHeight, count, tolerance };\n}\n\nexport function initialState<T>(\n  settings: VirtualScrollSettings,\n  adapter: VirtualScrollDataAdapter<T>,\n  ref: MutableRefObject<HTMLDivElement | null>\n): VirtualScrollState<T> {\n  // From Denis Hilt, https://blog.logrocket.com/virtual-scrolling-core-principles-and-basic-implementation-in-react/\n  const { minIndex, maxIndex, startIndex, itemHeight, count, tolerance } =\n    settings;\n  const bufferedItems = count + 2 * tolerance;\n  const itemsAbove = Math.max(0, startIndex - tolerance - minIndex);\n\n  const viewportHeight = count * itemHeight;\n  const totalHeight = (maxIndex - minIndex + 1) * itemHeight;\n  const toleranceHeight = tolerance * itemHeight;\n  const bufferHeight = viewportHeight + 2 * toleranceHeight;\n  const topPaddingHeight = itemsAbove * itemHeight;\n  const bottomPaddingHeight = totalHeight - (topPaddingHeight + bufferHeight);\n\n  const state: VirtualScrollState<T> = {\n    scrollTop: 0,\n    settings,\n    viewportHeight,\n    totalHeight,\n    toleranceHeight,\n    bufferedItems,\n    topPaddingHeight,\n    bottomPaddingHeight,\n    data: [],\n  };\n\n  return {\n    ...state,\n    ...doScroll(topPaddingHeight + toleranceHeight, state, adapter),\n  };\n}\n\nexport function getData<T>(\n  minIndex: number,\n  maxIndex: number,\n  offset: number,\n  limit: number,\n  get: VirtualScrollDataAdapter<T>\n): T[] {\n  const start = Math.max(0, minIndex, offset);\n  const end = Math.min(maxIndex, offset + limit - 1);\n  const data = get(start, end - start);\n  return [...data];\n}\n\ninterface ScrollUpdate<T> {\n  scrollTop: number;\n  topPaddingHeight: number;\n  bottomPaddingHeight: number;\n  data: T[];\n}\n\nexport function doScroll<T>(\n  scrollTop: number,\n  state: VirtualScrollState<T>,\n  get: VirtualScrollDataAdapter<T>\n): ScrollUpdate<T> {\n  const {\n    totalHeight,\n    toleranceHeight,\n    bufferedItems,\n    settings: { itemHeight, minIndex, maxIndex },\n  } = state;\n  const index =\n    minIndex + Math.floor((scrollTop - toleranceHeight) / itemHeight);\n  const data = getData(minIndex, maxIndex, index, bufferedItems, get);\n  const topPaddingHeight = Math.max((index - minIndex) * itemHeight, 0);\n  const bottomPaddingHeight = Math.max(\n    totalHeight - (topPaddingHeight + data.length * itemHeight),\n    0\n  );\n\n  return { scrollTop, topPaddingHeight, bottomPaddingHeight, data };\n}\n\ninterface VirtualScrollState<T> {\n  settings: VirtualScrollSettings;\n  scrollTop: number; // px\n  bufferedItems: number; // count\n  totalHeight: number; // px\n  viewportHeight: number; // px\n  topPaddingHeight: number; // px\n  bottomPaddingHeight: number; // px\n  toleranceHeight: number; // px\n  data: T[];\n}\n\nconst scrollReducer =\n  <T extends {}>(get: VirtualScrollDataAdapter<T>) =>\n  (state: VirtualScrollState<T>, scrollTop: number) => ({\n    ...state,\n    ...doScroll(scrollTop, state, get),\n  });\n\nexport const VirtualScroll = <T extends {}, U extends ReactNode = ReactNode>(\n  props: VirtualScrollProps<T, U> & { className?: string }\n) => {\n  const viewportRef = useRef<HTMLDivElement | null>(null);\n\n  const { settings, startState, reducer } = useMemo(() => {\n    const settings = fillVirtualScrollSettings(props.settings ?? {});\n    const startState = initialState<T>(settings, props.get, viewportRef);\n    const reducer = scrollReducer(props.get);\n    return { settings, reducer, startState };\n  }, [props.settings, props.get]);\n\n  const [state, dispatchScroll] = useReducer(reducer, startState);\n\n  useEffect(() => {\n    if (viewportRef.current !== null) {\n      dispatchScroll(viewportRef.current.scrollTop);\n    }\n  }, [settings, props.row]);\n\n  const initialScroll = useCallback(\n    (div: HTMLDivElement | null) => {\n      if (div) {\n        div.scrollTop = viewportRef.current\n          ? viewportRef.current.scrollTop\n          : settings.startIndex * settings.itemHeight;\n      }\n      viewportRef.current = div;\n    },\n    [viewportRef, settings.startIndex, settings.itemHeight]\n  );\n\n  const rows = state.data.map((d) => (\n    <div key={props.rowKey(d)} style={{ height: `${settings.itemHeight}px` }}>\n      {props.row(d)}\n    </div>\n  ));\n\n  return (\n    <div\n      ref={initialScroll}\n      style={{\n        height: `${state.viewportHeight}px`,\n        overflowY: \"scroll\",\n        overflowAnchor: \"none\",\n      }}\n      className={props.className ?? \"\"}\n      onScroll={(e) => dispatchScroll((e.target as HTMLDivElement).scrollTop)}\n    >\n      <div style={{ height: `${state.topPaddingHeight}px` }} />\n      {rows}\n      <div style={{ height: `${state.bottomPaddingHeight}px` }} />\n    </div>\n  );\n};\n\nexport default VirtualScroll;\n","import { ReactNode, useCallback, useContext, useMemo, useState } from \"react\";\nimport { rounded } from \"@davidsouther/jiffies/lib/esm/dom/css/border\";\n\nimport {\n  Format,\n  FORMATS,\n  Memory as MemoryChip,\n} from \"../../simulator/cpu/memory\";\nimport { asm } from \"../../util/asm\";\nimport { bin, dec, hex } from \"../../util/twos\";\nimport InlineEdit from \"../pico/inline_edit\";\nimport VirtualScroll, { VirtualScrollSettings } from \"../pico/virtual_scroll\";\nimport { Icon } from \"../pico/icon\";\nimport { AppContext } from \"../../App.context\";\nimport { t } from \"@lingui/macro\";\n\nconst ITEM_HEIGHT = 34;\n\nexport const MemoryBlock = ({\n  memory,\n  jmp = { value: 0 },\n  highlight = -1,\n  editable = false,\n  format = dec,\n  onChange = () => {},\n}: {\n  jmp?: { value: number };\n  memory: MemoryChip;\n  highlight?: number;\n  editable?: boolean;\n  format?: (v: number) => string;\n  onChange?: (i: number, value: string, previous: number) => void;\n}) => {\n  const settings = useMemo<Partial<VirtualScrollSettings>>(\n    () => ({\n      count: 20,\n      maxIndex: memory.size,\n      itemHeight: ITEM_HEIGHT,\n      startIndex: jmp.value,\n    }),\n    [memory.size, jmp]\n  );\n  const get = useCallback(\n    (offset: number, count: number) =>\n      memory\n        .range(offset, offset + count)\n        .map((v, i) => [i + offset, v] as [number, number]),\n    [memory]\n  );\n  const row = useCallback(\n    ([i, v]: [number, number]) => (\n      <MemoryCell\n        index={i}\n        value={format(v)}\n        editable={editable}\n        highlight={i === highlight}\n        onChange={onChange}\n      />\n    ),\n    [format, editable, highlight, onChange]\n  );\n\n  return (\n    <VirtualScroll<[number, number], ReactNode>\n      settings={settings}\n      get={get}\n      row={row}\n      rowKey={([i]) => i}\n    />\n  );\n};\n\nexport const MemoryCell = ({\n  index,\n  value,\n  highlight = false,\n  editable = false,\n  onChange = () => {},\n}: {\n  index: number;\n  value: string;\n  highlight?: boolean;\n  editable?: boolean;\n  onChange?: (i: number, value: string, previous: number) => void;\n}) => (\n  <div style={{ display: \"flex\", height: \"100%\" }}>\n    <code\n      style={{\n        ...rounded(\"none\"),\n        ...(highlight\n          ? { background: \"var(--code-kbd-background-color)\" }\n          : {}),\n      }}\n    >\n      {hex(index)}\n    </code>\n    <code\n      style={{\n        flex: \"1\",\n        textAlign: \"right\",\n        ...rounded(\"none\"),\n        ...(highlight\n          ? { background: \"var(--code-kbd-background-color)\" }\n          : {}),\n      }}\n    >\n      {editable ? (\n        <InlineEdit\n          value={value}\n          onChange={(newValue: string) =>\n            onChange(index, newValue, Number(value))\n          }\n        />\n      ) : (\n        <span>{value}</span>\n      )}\n    </code>\n  </div>\n);\n\nexport const Memory = ({\n  name = \"Memory\",\n  highlight = -1,\n  editable = true,\n  memory,\n  format = \"dec\",\n}: {\n  name?: string;\n  editable?: boolean;\n  highlight?: number;\n  memory: MemoryChip;\n  format: Format;\n}) => {\n  const [fmt, setFormat] = useState(format);\n  const [jmp, setJmp] = useState(\"0\");\n  const [goto, setGoto] = useState({ value: 0 });\n\n  const jumpTo = () => {\n    setGoto({ value: Number(jmp) });\n  };\n\n  const { filePicker, fs, setStatus } = useContext(AppContext);\n  const doLoad = useCallback(async () => {\n    try {\n      const file = await filePicker.select();\n      await memory.load(fs, file);\n    } catch (e) {\n      console.error(e);\n      setStatus(`Failed to load into memory`);\n    }\n  }, [fs, filePicker, memory, setStatus]);\n\n  return (\n    <article className=\"panel\">\n      <header>\n        <div>{name}</div>\n        <fieldset role=\"group\">\n          <button onClick={doLoad} className=\"flex-0\">\n            <Icon name=\"upload_file\" />\n          </button>\n          <input\n            style={{ width: \"4em\", height: \"100%\" }}\n            placeholder={t`Goto`}\n            onKeyDown={({ key }) => key === \"Enter\" && jumpTo()}\n            onChange={({ target: { value } }) => setJmp(value ?? \"0\")}\n          />\n          <button onClick={jumpTo} className=\"flex-0\">\n            <Icon name=\"move_down\" />\n          </button>\n          {FORMATS.map((option) => (\n            <label\n              className=\"flex-0\"\n              key={option}\n              role=\"button\"\n              aria-current={option === fmt}\n            >\n              <input\n                type=\"radio\"\n                name={name}\n                value={option}\n                checked={option === fmt}\n                onChange={() => setFormat(option)}\n              />\n              {option}\n            </label>\n          ))}\n        </fieldset>\n      </header>\n      <MemoryBlock\n        jmp={goto}\n        memory={memory}\n        highlight={highlight}\n        editable={editable}\n        format={(v: number) => doFormat(fmt, v)}\n        onChange={(i: number, v: string) => memory.update(i, v, fmt ?? \"dec\")}\n      />\n    </article>\n  );\n};\n\nexport default Memory;\n\nfunction doFormat(format: Format, v: number): string {\n  switch (format) {\n    case \"bin\":\n      return bin(v);\n    case \"hex\":\n      return hex(v);\n    case \"asm\":\n      return asm(v);\n    case \"dec\":\n    default:\n      return dec(v);\n  }\n}\n","import { Bus, ClockedChip, Pin } from \"../../chip\";\nimport { assert } from \"@davidsouther/jiffies/lib/esm/assert\";\nimport { Memory as MemoryComponent } from \"../../../../components/chips/memory\";\nimport { Memory, Memory as MemoryChip } from \"../../../cpu/memory\";\n\nexport class RAM extends ClockedChip {\n  protected memory: MemoryChip;\n  private nextData: number = 0;\n  private address: number = 0;\n\n  constructor(protected readonly width: number, name?: string) {\n    super([\"in[16]\", \"load\", `address[${width}]`], [`out[16]`], name);\n    this.memory = new MemoryChip(Math.pow(2, this.width));\n  }\n\n  override tick() {\n    const load = this.in(\"load\").voltage();\n    this.address = this.in(\"address\").busVoltage;\n    if (load) {\n      this.nextData = this.in().busVoltage;\n      this.memory.set(this.address, this.nextData);\n    }\n  }\n\n  override tock() {\n    this.out().busVoltage = this.memory?.get(this.address) ?? 0;\n  }\n\n  override eval() {\n    const address = this.in(\"address\").busVoltage;\n    this.out().busVoltage = this.memory?.get(address) ?? 0;\n  }\n\n  at(idx: number): Pin {\n    assert(\n      idx < this.memory.size,\n      () => `Request out of bounds (${idx} >= ${this.memory.size})`\n    );\n    return new RamBus(`${this.name}[${idx}]`, idx, this.memory);\n  }\n\n  override render() {\n    return [\n      <MemoryComponent name={this.name} memory={this.memory} format=\"dec\" />,\n    ];\n  }\n}\n\nexport class RamBus extends Bus {\n  constructor(\n    name: string,\n    private readonly index: number,\n    private ram: Memory\n  ) {\n    super(name);\n  }\n\n  override get busVoltage(): number {\n    return this.ram.get(this.index);\n  }\n\n  override set busVoltage(num: number) {\n    this.ram.set(this.index, num);\n  }\n}\n\nexport class RAM8 extends RAM {\n  constructor(name?: string) {\n    super(3, name);\n  }\n\n  override render() {\n    return [<span>RAM {this.width}</span>];\n  }\n}\n\nexport class RAM64 extends RAM {\n  constructor(name?: string) {\n    super(6, name);\n  }\n}\n\nexport class RAM512 extends RAM {\n  constructor(name?: string) {\n    super(9, name);\n  }\n}\n\nexport class RAM4K extends RAM {\n  constructor(name?: string) {\n    super(12, name);\n  }\n}\n\nexport class RAM16K extends RAM {\n  constructor(name?: string) {\n    super(14, name);\n  }\n}\n","import { CSSProperties, ReactNode } from \"react\";\n\nexport const Panel = (props: {\n  children: ReactNode;\n  header?: ReactNode;\n  footer?: ReactNode;\n  className?: string;\n  style?: CSSProperties;\n}) => {\n  return (\n    <article className={[\"panel\", props.className ?? \"\"].join(\" \")}>\n      {props.header && <header>{props.header}</header>}\n      <main>{props.children}</main>\n      {props.footer && <footer>{props.footer}</footer>}\n    </article>\n  );\n};\n\nexport const Accordian = (props: {\n  children: ReactNode;\n  summary: ReactNode;\n  className?: string;\n  style?: CSSProperties;\n  open?: boolean;\n}) => {\n  return (\n    <details\n      className={props.className ?? \"\"}\n      open={props.open}\n      style={props.style}\n    >\n      <summary>\n        <div className=\"flex row align-baseline\">{props.summary}</div>\n      </summary>\n      {props.children}\n    </details>\n  );\n};\n","import { assertExists } from \"@davidsouther/jiffies/lib/esm/assert\";\nimport { Trans } from \"@lingui/macro\";\nimport { useEffect, useRef } from \"react\";\nimport { Memory, SCREEN } from \"../../simulator/cpu/memory\";\nimport { Panel } from \"../shell/panel\";\n\nconst WHITE = \"white\";\nconst BLACK = \"black\";\ntype COLOR = typeof WHITE | typeof BLACK;\n\nfunction get(mem: Memory, x: number, y: number): COLOR {\n  const byte = mem.get(SCREEN + 32 * y + ((x / 16) | 0));\n  const bit = byte & (1 << x % 16);\n  return bit === 0 ? WHITE : BLACK;\n}\n\nfunction set(data: Uint8ClampedArray, x: number, y: number, value: COLOR) {\n  const pixel = (y * 512 + x) * 4;\n  const color = value === WHITE ? 255 : 0;\n  data[pixel] = color;\n  data[pixel + 1] = color;\n  data[pixel + 2] = color;\n  data[pixel + 3] = 255;\n}\n\nexport const Screen = ({ memory }: { memory: Memory }) => {\n  let canvas = useRef<HTMLCanvasElement>();\n  useEffect(() => {\n    const ctx = canvas.current?.getContext(\"2d\") ?? undefined;\n\n    if (ctx) {\n      const image = assertExists(\n        ctx.getImageData(0, 0, 512, 256),\n        \"Failed to create Context2d\"\n      );\n      for (let col = 0; col < 512; col++) {\n        for (let row = 0; row < 256; row++) {\n          const color = get(memory, col, row);\n          set(image.data, col, row, color);\n        }\n      }\n      ctx.putImageData(image, 0, 0);\n    }\n  }, [memory]);\n\n  return (\n    <Panel header={<Trans>Screen</Trans>}>\n      <figure\n        style={{\n          width: \"100%\",\n          maxWidth: \"512px\",\n          boxSizing: \"content-box\",\n          marginInline: \"auto\",\n          margin: \"0\",\n          borderTop: \"2px solid gray\",\n          borderLeft: \"2px solid gray\",\n          borderBottom: \"2px solid lightgray\",\n          borderRight: \"2px solid lightgray\",\n        }}\n      >\n        <canvas\n          ref={(ref) => (canvas.current = ref ?? undefined)}\n          width={512}\n          height={256}\n        ></canvas>\n      </figure>\n    </Panel>\n  );\n};\n","import { KeyboardEvent, useCallback, useState } from \"react\";\nimport { Keyboard as KeyboardChip } from \"../../simulator/chip/builtins/computer/computer\";\nimport { Icon } from \"../pico/icon\";\nimport { RegisterComponent } from \"./register\";\n\nconst KeyMap: Record<string, number | undefined> = {\n  // Delete: 127,\n  Enter: 128,\n  Backspace: 129,\n  ArrowLeft: 130,\n  ArrowUp: 131,\n  ArrowRight: 132,\n  ArrowDown: 133,\n  Home: 134,\n  End: 135,\n  PageUp: 136,\n  PageDown: 137,\n  Insert: 138,\n  Delete: 139,\n  Escape: 140,\n  F1: 141,\n  F2: 142,\n  F3: 143,\n  F4: 144,\n  F5: 145,\n  F6: 146,\n  F7: 147,\n  F8: 148,\n  F9: 149,\n  F10: 150,\n  F11: 151,\n  F12: 152,\n};\n\nfunction keyPressToHackCharacter(keypress: KeyboardEvent): number {\n  if (KeyMap[keypress.key]) {\n    return KeyMap[keypress.key]!;\n  }\n  if (keypress.key.length === 1) {\n    const code = keypress.key.charCodeAt(0);\n    if (code >= 32 && code <= 126) {\n      return code;\n    }\n  }\n\n  return 0;\n}\n\nexport const Keyboard = ({ keyboard }: { keyboard: KeyboardChip }) => {\n  const [showPicker, setShowPicker] = useState(false);\n  const [bits, setBits] = useState(keyboard.out().busVoltage);\n\n  const setKey = useCallback(\n    (event: KeyboardEvent<HTMLInputElement>) => {\n      const key = keyPressToHackCharacter(event);\n      if (key === 0) {\n        return;\n      }\n      event.preventDefault();\n      keyboard.setKey(key);\n      setBits(keyboard.out().busVoltage);\n      setShowPicker(false);\n    },\n    [keyboard, setShowPicker, setBits]\n  );\n\n  const changeKey = useCallback(() => {\n    setShowPicker(true);\n  }, []);\n\n  return (\n    <div className=\"flex row align-baseline\">\n      <div className=\"flex-1\">\n        <RegisterComponent name=\"Keyboard\" bits={bits} />\n      </div>\n      <div className=\"flex-1\">\n        {showPicker ? (\n          <input ref={(e) => e?.focus()} type=\"text\" onKeyDown={setKey} />\n        ) : (\n          <button onClick={changeKey}>\n            <Icon name=\"keyboard\" />\n          </button>\n        )}\n      </div>\n    </div>\n  );\n};\n","import { alu, COMMANDS_OP, Flags } from \"./alu\";\nimport { Memory } from \"./memory\";\n\nexport interface CPUInput {\n  inM: number;\n  instruction: number;\n  reset: boolean;\n}\n\nexport interface CPUOutput {\n  outM: number;\n  writeM: boolean;\n  addressM: number;\n}\n\nexport interface CPUState {\n  A: number;\n  D: number;\n  PC: number;\n  ALU: number;\n  flag: number;\n}\n\nexport function emptyState(): CPUState {\n  return { A: 0, D: 0, PC: 0, ALU: 0, flag: Flags.Zero };\n}\n\nconst BITS = {\n  c: 0b1000_0000_0000_0000,\n  x1: 0b1001_0000_0000_0000,\n  x2: 0b1001_0000_0000_0000,\n  am: 0b1001_0000_0000_0000,\n  op: 0b0000_1111_1100_0000,\n  d1: 0b1000_0000_0010_0000,\n  d2: 0b1000_0000_0001_0000,\n  d3: 0b1000_0000_0000_1000,\n  j1: 0b1000_0000_0000_0001,\n  j2: 0b1000_0000_0000_0010,\n  j3: 0b1000_0000_0000_0100,\n};\n\nexport function decode(instruction: number) {\n  function bit(bit: number): boolean {\n    return (instruction & bit) === bit;\n  }\n  const bits = {\n    c: bit(BITS.c),\n    x1: bit(BITS.x1),\n    x2: bit(BITS.x2),\n    am: bit(BITS.am),\n    op: ((instruction & BITS.op) >> 6) as COMMANDS_OP,\n    d1: bit(BITS.d1),\n    d2: bit(BITS.d2),\n    d3: bit(BITS.d3),\n    j1: bit(BITS.j1),\n    j2: bit(BITS.j2),\n    j3: bit(BITS.j3),\n  };\n\n  return bits;\n}\n\nexport function cpuTick(\n  { inM, instruction }: CPUInput,\n  { A, D, PC }: CPUState\n): [CPUState, boolean] {\n  const bits = decode(instruction);\n  const a = bits.am ? inM : A;\n  const [ALU, flag] = alu(bits.op, D, a);\n\n  return [{ A, D, PC: PC + 1, ALU, flag }, bits.d3];\n}\n\nexport function cpuTock(\n  { inM, instruction, reset }: CPUInput,\n  { A, D, PC, ALU, flag }: CPUState\n): [CPUOutput, CPUState] {\n  const bits = decode(instruction);\n\n  const j1 = bits.j1 && flag === Flags.Positive;\n  const j2 = bits.j2 && flag === Flags.Zero;\n  const j3 = bits.j3 && flag === Flags.Negative;\n  const jmp = j1 || j2 || j3;\n\n  PC = reset ? 0 : jmp ? A : PC;\n\n  if (bits.d2) {\n    D = ALU;\n  }\n\n  if (!bits.c) {\n    A = instruction & 0x7fff;\n  } else if (bits.d1) {\n    A = ALU;\n  }\n\n  const a = bits.am ? inM : A;\n  const alu2 = alu(bits.op, D, a);\n\n  ALU = alu2[0];\n  flag = alu2[1];\n\n  const output: CPUOutput = {\n    addressM: A,\n    outM: ALU,\n    writeM: bits.d3,\n  };\n\n  const state: CPUState = {\n    A,\n    D,\n    ALU,\n    flag,\n    PC,\n  };\n\n  return [output, state];\n}\n\nexport function cpu(input: CPUInput, state: CPUState): [CPUOutput, CPUState] {\n  const [tickState, _writeM] = cpuTick(input, state);\n  return cpuTock(input, tickState);\n}\n\nexport class CPU {\n  RAM: Memory;\n  ROM: Memory;\n\n  #pc = 0;\n  #a = 0;\n  #d = 0;\n\n  #tickState: CPUState = {\n    A: 0,\n    D: 0,\n    PC: 0,\n    ALU: 0,\n    flag: Flags.Zero,\n  };\n\n  get PC() {\n    return this.#pc;\n  }\n\n  get A() {\n    return this.#a;\n  }\n\n  get D() {\n    return this.#d;\n  }\n\n  constructor({\n    RAM = new Memory(0x7fff),\n    ROM,\n  }: {\n    RAM?: Memory;\n    ROM: Memory;\n  }) {\n    this.RAM = RAM;\n    this.ROM = ROM;\n  }\n\n  reset() {\n    this.#pc = 0;\n    this.#a = 0;\n    this.#d = 0;\n  }\n\n  tick() {\n    const [{ addressM, outM, writeM }, { A, D, PC }] = cpu(\n      {\n        inM: this.RAM.get(this.#a),\n        instruction: this.ROM.get(this.#pc),\n        reset: false,\n      },\n      {\n        A: this.#a,\n        D: this.#d,\n        PC: this.#pc,\n        ALU: this.#d,\n        flag: Flags.Zero,\n      }\n    );\n\n    this.#a = A;\n    this.#d = D;\n    this.#pc = PC;\n\n    if (writeM) {\n      this.RAM.set(addressM, outM);\n    }\n  }\n}\n","import { FileSystem } from \"@davidsouther/jiffies/lib/esm/fs\";\nimport { Screen as ScreenComponent } from \"../../../../components/chips/screen\";\nimport { Keyboard as KeyboardComponent } from \"../../../../components/chips/keyboard\";\nimport { Chip, ClockedChip, ConstantBus, HIGH, LOW, Pin } from \"../../chip\";\nimport { RAM, RAM16K } from \"../sequential/ram\";\nimport {\n  CPUInput,\n  CPUState,\n  cpuTick,\n  cpuTock,\n  decode,\n  emptyState,\n} from \"../../../cpu/cpu\";\nimport { int10 } from \"../../../../util/twos\";\nimport { loadHack } from \"../../../fs\";\nimport { Flags } from \"../../../cpu/alu\";\nimport { RegisterComponent } from \"../../../../components/chips/register\";\nimport { ALUComponent } from \"../../../../components/chips/alu\";\nimport { KEYBOARD, SCREEN } from \"../../../cpu/memory\";\n\nexport class ROM32K extends RAM {\n  constructor() {\n    super(16, \"ROM\");\n  }\n\n  override async load(fs: FileSystem, path: string) {\n    try {\n      (await loadHack(fs, path)).map((v, i) => (this.at(i).busVoltage = v));\n    } catch (cause) {\n      // throw new Error(`ROM32K Failed to load file ${path}`, { cause });\n      throw new Error(`ROM32K Failed to load file ${path}`);\n    }\n  }\n}\n\nexport class Screen extends RAM {\n  static readonly OFFSET = SCREEN;\n\n  constructor() {\n    super(13, \"Screen\");\n  }\n\n  override render() {\n    return [<ScreenComponent memory={this.memory} />];\n  }\n}\n\nexport class Keyboard extends Chip {\n  static readonly OFFSET = KEYBOARD;\n\n  constructor() {\n    super([], [\"out[16]\"], \"Keyboard\");\n  }\n\n  setKey(key: number) {\n    this.out().busVoltage = key & 0xffff;\n  }\n\n  clearKey() {\n    this.out().busVoltage = 0;\n  }\n\n  override render() {\n    return [<KeyboardComponent keyboard={this} />];\n  }\n}\n\nexport class Memory extends ClockedChip {\n  private ram = new RAM16K();\n  private screen = new Screen();\n  private keyboard = new Keyboard();\n  private address = 0;\n\n  constructor() {\n    super([\"in[16]\", \"load\", \"address[15])\"], [\"out[16]\"], \"Memory\");\n    this.parts.add(this.keyboard);\n    this.parts.add(this.screen);\n    this.parts.add(this.ram);\n  }\n\n  override tick() {\n    const load = this.in(\"load\").voltage();\n    this.address = this.in(\"address\").busVoltage;\n    if (load) {\n      const inn = this.in().busVoltage;\n      if (this.address >= Keyboard.OFFSET) {\n        // Keyboard, do nothing\n      } else if (this.address >= Screen.OFFSET) {\n        this.screen.at(this.address - Screen.OFFSET).busVoltage = inn;\n      } else {\n        this.ram.at(this.address).busVoltage = inn;\n      }\n    }\n  }\n\n  override tock() {\n    this.eval();\n  }\n\n  override eval() {\n    if (!this.ram) return;\n    this.address = this.in(\"address\").busVoltage;\n    let out = 0;\n    if (this.address >= Keyboard.OFFSET) {\n      // Keyboard, do nothing\n      out = this.keyboard?.out().busVoltage ?? 0;\n    } else if (this.address >= Screen.OFFSET) {\n      out = this.screen?.at(this.address - Screen.OFFSET).busVoltage ?? 0;\n    } else {\n      out = this.ram?.at(this.address).busVoltage ?? 0;\n    }\n    this.out().busVoltage = out;\n  }\n\n  override in(pin?: string): Pin {\n    if (pin?.startsWith(\"RAM16K\")) {\n      const idx = int10(pin.match(/\\[(?<idx>\\d+)]/)?.groups?.idx ?? \"0\");\n      return this.ram.at(idx);\n    }\n    if (pin?.startsWith(\"Screen\")) {\n      const idx = int10(pin.match(/\\[(?<idx>\\d+)]/)?.groups?.idx ?? \"0\");\n      return this.screen.at(idx);\n    }\n    return super.in(pin);\n  }\n\n  override get(name: string, offset = 0): Pin | undefined {\n    if (name.startsWith(\"RAM16K\")) {\n      return this.at(offset & 0x3fff);\n    }\n    if (name.startsWith(\"Screen\")) {\n      return this.at(offset & (0x1fff + Screen.OFFSET));\n    }\n    if (name.startsWith(\"Keyboard\")) {\n      return this.at(Keyboard.OFFSET);\n    }\n    if (name.startsWith(\"Memory\")) {\n      return this.at(offset);\n    }\n    return super.get(name, offset);\n  }\n\n  at(offset: number): Pin {\n    if (offset >= Keyboard.OFFSET) {\n      return this.keyboard.out();\n    }\n    if (offset >= Screen.OFFSET) {\n      return this.screen.at(offset - Screen.OFFSET);\n    } else {\n      return this.ram.at(offset);\n    }\n  }\n}\n\nexport class CPU extends ClockedChip {\n  private state: CPUState = emptyState();\n\n  constructor() {\n    super(\n      [\"inM[16]\", \"instruction[16]\", \"reset\"],\n      [\"outM[16]\", \"writeM\", \"addressM[15]\", \"pc[15]\"]\n    );\n  }\n\n  override tick(): void {\n    const [state, writeM] = cpuTick(this.cpuInput(), this.state);\n    this.state = state;\n    this.out(\"writeM\").pull(writeM ? HIGH : LOW);\n    this.out(\"outM\").busVoltage = this.state.ALU ?? 0;\n  }\n\n  override tock(): void {\n    if (!this.state) return; // Skip initial tock\n    const [output, state] = cpuTock(this.cpuInput(), this.state);\n    this.state = state;\n\n    this.out(\"addressM\").busVoltage = output.addressM ?? 0;\n    this.out(\"outM\").busVoltage = output.outM ?? 0;\n    this.out(\"writeM\").pull(output.writeM ? HIGH : LOW);\n    this.out(\"pc\").busVoltage = this.state?.PC ?? 0;\n  }\n\n  private cpuInput(): CPUInput {\n    const inM = this.in(\"inM\").busVoltage;\n    const instruction = this.in(\"instruction\").busVoltage;\n    const reset = this.in(\"reset\").busVoltage === 1;\n    return { inM, instruction, reset };\n  }\n\n  override get(pin: string, offset?: number): Pin | undefined {\n    if (pin?.startsWith(\"ARegister\")) {\n      return new ConstantBus(\"ARegister\", this.state.A);\n    }\n    if (pin?.startsWith(\"DRegister\")) {\n      return new ConstantBus(\"DRegister\", this.state.D);\n    }\n    if (pin?.startsWith(\"PC\")) {\n      return new ConstantBus(\"PC\", this.state.PC);\n    }\n    return super.get(pin, offset);\n  }\n\n  override render() {\n    const bits = decode(this.in(\"instruction\").busVoltage);\n    return [\n      <RegisterComponent name={\"A\"} bits={this.state.A} />,\n      <RegisterComponent name={\"D\"} bits={this.state.D} />,\n      <RegisterComponent name={\"PC\"} bits={this.state.PC} />,\n      <ALUComponent\n        A={bits.am ? this.in(\"inM\").busVoltage : this.state.A}\n        D={this.state.D}\n        out={this.state.ALU}\n        op={bits.op}\n        flag={this.state.flag as keyof typeof Flags}\n      />,\n    ];\n  }\n}\n\nexport class Computer extends Chip {\n  #ram = new Memory();\n  #rom = new ROM32K();\n  #cpu = new CPU();\n\n  constructor() {\n    super([\"reset\"], []);\n\n    this.wire(this.#cpu, [\n      { from: { name: \"reset\", start: 0 }, to: { name: \"reset\", start: 0 } },\n      {\n        from: { name: \"instruction\", start: 0 },\n        to: { name: \"instruction\", start: 0 },\n      },\n      { from: { name: \"outM\", start: 0 }, to: { name: \"inM\", start: 0 } },\n      { from: { name: \"writeM\", start: 0 }, to: { name: \"writeM\", start: 0 } },\n      {\n        from: { name: \"addressM\", start: 0 },\n        to: { name: \"addressM\", start: 0 },\n      },\n    ]);\n\n    this.wire(this.#rom, [\n      { from: { name: \"pc\", start: 0 }, to: { name: \"address\", start: 0 } },\n      {\n        from: { name: \"instruction\", start: 0 },\n        to: { name: \"out\", start: 0 },\n      },\n    ]);\n\n    this.wire(this.#ram, [\n      { from: { name: \"inM\", start: 0 }, to: { name: \"in\", start: 0 } },\n      { from: { name: \"writeM\", start: 0 }, to: { name: \"load\", start: 0 } },\n      {\n        from: { name: \"addressM\", start: 0 },\n        to: { name: \"address\", start: 0 },\n      },\n      { from: { name: \"outM\", start: 0 }, to: { name: \"out\", start: 0 } },\n    ]);\n  }\n\n  override eval() {\n    super.eval();\n  }\n\n  override get(name: string, offset?: number): Pin | undefined {\n    if (\n      name.startsWith(\"PC\") ||\n      name.startsWith(\"ARegister\") ||\n      name.startsWith(\"DRegister\")\n    ) {\n      return this.#cpu.get(name);\n    }\n    if (name.startsWith(\"RAM16K\")) {\n      return this.#ram.get(name, offset);\n    }\n    return super.get(name, offset);\n  }\n\n  override load(fs: FileSystem, path: string): Promise<void> {\n    return this.#rom.load(fs, path);\n  }\n}\n","import { Err, Ok, Result } from \"@davidsouther/jiffies/lib/esm/result\";\nimport { Chip } from \"../chip\";\n\nimport { And, And16 } from \"./logic/and\";\nimport { DMux, DMux4Way, DMux8Way } from \"./logic/dmux\";\nimport { Mux, Mux16, Mux4Way16, Mux8Way16 } from \"./logic/mux\";\nimport { Nand, Nand16 } from \"./logic/nand\";\nimport { Not, Not16 } from \"./logic/not\";\nimport { Or, Or16, Or8way } from \"./logic/or\";\nimport { Xor, Xor16 } from \"./logic/xor\";\n\nimport { Add16 } from \"./arithmetic/add_16\";\nimport { ALU, ALUNoStat } from \"./arithmetic/alu\";\nimport { FullAdder } from \"./arithmetic/full_adder\";\nimport { HalfAdder } from \"./arithmetic/half_adder\";\nimport { Inc16 } from \"./arithmetic/inc16\";\n\nimport { Bit, PC, Register, VRegister } from \"./sequential/bit\";\nimport { DFF } from \"./sequential/dff\";\nimport { RAM16K, RAM4K, RAM512, RAM64, RAM8 } from \"./sequential/ram\";\nimport {\n  Computer,\n  CPU,\n  Keyboard,\n  Memory,\n  ROM32K,\n  Screen,\n} from \"./computer/computer\";\n\nexport {\n  And,\n  And16,\n  DMux,\n  Mux,\n  Mux16,\n  Mux4Way16,\n  Mux8Way16,\n  Nand,\n  Nand16,\n  Not,\n  Not16,\n  Or,\n  Or16,\n  Or8way,\n  Xor,\n  Xor16,\n  HalfAdder,\n  FullAdder,\n  Add16,\n  Inc16,\n  ALU,\n  Bit,\n  Register,\n  VRegister as ARegister,\n  VRegister as DRegister,\n  DFF,\n  RAM8,\n  RAM64,\n  RAM512,\n  RAM4K,\n  RAM16K,\n};\n\nexport const REGISTRY = new Map<string, () => Chip>(\n  (\n    [\n      [\"Nand\", Nand],\n      [\"Nand16\", Nand16],\n      [\"Not\", Not],\n      [\"Not16\", Not16],\n      [\"And\", And],\n      [\"And16\", And16],\n      [\"Or\", Or],\n      [\"Or16\", Or16],\n      [\"Or8Way\", Or8way],\n      [\"XOr\", Xor],\n      [\"XOr16\", Xor16],\n      [\"Xor\", Xor],\n      [\"Xor16\", Xor16],\n      [\"Mux\", Mux],\n      [\"Mux16\", Mux16],\n      [\"Mux4Way16\", Mux4Way16],\n      [\"Mux8Way16\", Mux8Way16],\n      [\"DMux\", DMux],\n      [\"DMux4Way\", DMux4Way],\n      [\"DMux8Way\", DMux8Way],\n      [\"HalfAdder\", HalfAdder],\n      [\"FullAdder\", FullAdder],\n      [\"Add16\", Add16],\n      [\"Inc16\", Inc16],\n      [\"ALU\", ALU],\n      [\"ALUNoStat\", ALUNoStat],\n      [\"DFF\", DFF],\n      [\"Bit\", Bit],\n      [\"Register\", Register],\n      [\"ARegister\", Register],\n      [\"DRegister\", Register],\n      [\"PC\", PC],\n      [\"RAM8\", RAM8],\n      [\"RAM64\", RAM64],\n      [\"RAM512\", RAM512],\n      [\"RAM4K\", RAM4K],\n      [\"RAM16K\", RAM16K],\n      [\"ROM32K\", ROM32K],\n      [\"Screen\", Screen],\n      [\"Keyboard\", Keyboard],\n      [\"CPU\", CPU],\n      [\"Computer\", Computer],\n      [\"Memory\", Memory],\n      [\"ARegister\", VRegister],\n      [\"DRegister\", VRegister],\n    ] as [string, { new (): Chip }][]\n  ).map(([name, ChipCtor]) => [\n    name,\n    () => {\n      const chip = new ChipCtor();\n      chip.name = name;\n      return chip;\n    },\n  ])\n);\n\nexport function getBuiltinChip(name: string): Result<Chip> {\n  const chip = REGISTRY.get(name);\n  return chip\n    ? Ok(chip())\n    : Err(new Error(`Chip ${name} not in builtin registry`));\n}\n","import { Err, isErr, Ok, Result } from \"@davidsouther/jiffies/lib/esm/result\";\nimport { HDL, HdlParse } from \"../../languages/hdl\";\nimport { getBuiltinChip } from \"./builtins/index\";\nimport { Chip, Connection } from \"./chip\";\n\nfunction pinWidth(start: number, end: number | undefined): number | undefined {\n  if (end === undefined) {\n    return undefined;\n  }\n  if (end >= start) {\n    return end - start + 1;\n  }\n  if (start > 0 && end === 0) {\n    return 1;\n  }\n  throw new Error(`Bus specification has start > end (${start} > ${end})`);\n}\n\nexport function parse(\n  code: string\n): Result<Chip, Error | { message: string; shortMessage: string }> {\n  const parsed = HDL.parse(code.toString());\n  if (isErr(parsed)) return parsed;\n  return build(Ok(parsed));\n}\n\nexport function build(parts: HdlParse): Result<Chip, Error> {\n  if (parts.parts === \"BUILTIN\") {\n    return getBuiltinChip(parts.name.toString());\n  }\n\n  const buildChip = new Chip(\n    parts.ins.map(({ pin, width }) => ({ pin: pin.toString(), width })),\n    parts.outs.map(({ pin, width }) => ({ pin: pin.toString(), width })),\n    parts.name.toString(),\n    [],\n    parts.clocked\n  );\n\n  for (const part of parts.parts) {\n    const builtin = getBuiltinChip(part.name.toString());\n    if (isErr(builtin)) return builtin;\n    const partChip = Ok(builtin);\n\n    const wires = part.wires.map<Connection>(({ lhs, rhs }) => ({\n      to: {\n        name: lhs.pin.toString(),\n        start: lhs.start ?? 0,\n        width: pinWidth(lhs.start ?? 0, lhs.end),\n      },\n      from: {\n        name: rhs.pin.toString(),\n        start: rhs.start ?? 0,\n        width: pinWidth(rhs.start ?? 0, rhs.end),\n      },\n    }));\n\n    try {\n      buildChip.wire(partChip, wires);\n    } catch (e) {\n      return Err(e as Error);\n    }\n  }\n\n  return Ok(buildChip);\n}\n","import { assert } from \"@davidsouther/jiffies/lib/esm/assert\";\nimport { bin, dec, hex } from \"../util/twos\";\nimport { Test } from \"./tst\";\n\nexport class Output {\n  private readonly fmt: \"B\" | \"X\" | \"D\" | \"S\";\n  private readonly lPad: number;\n  private readonly rPad: number;\n  private readonly len: number;\n  private readonly index: number;\n  private readonly builtin: boolean;\n\n  // new Output(inst.id, inst.style, inst.width, inst.lpad, inst.rpad)\n  constructor(\n    private variable: string,\n    format = \"%B1.1.1\",\n    len?: number,\n    lPad?: number,\n    rPad?: number,\n    builtin?: boolean,\n    index?: number\n  ) {\n    if (\n      format.startsWith(\"%\") &&\n      len === undefined &&\n      lPad === undefined &&\n      rPad === undefined\n    ) {\n      const { fmt, lPad, rPad, len } = format.match(\n        /^%(?<fmt>[BDXS])(?<lPad>\\d+)\\.(?<len>\\d+)\\.(?<rPad>\\d+)$/\n      )?.groups as {\n        fmt: \"B\" | \"X\" | \"D\" | \"S\";\n        lPad: string;\n        rPad: string;\n        len: string;\n      };\n      this.fmt = fmt;\n      this.lPad = parseInt(lPad);\n      this.rPad = parseInt(rPad);\n      this.len = parseInt(len);\n      this.builtin = false;\n      this.index = -1;\n    } else {\n      assert([\"B\", \"X\", \"D\", \"S\"].includes(format[0]));\n      this.fmt = format[0] as \"B\" | \"X\" | \"D\" | \"S\";\n      this.len = len ?? 3;\n      this.lPad = lPad ?? 1;\n      this.rPad = rPad ?? 1;\n      this.builtin = builtin ?? false;\n      this.index = index ?? -1;\n    }\n  }\n\n  header(test: Test) {\n    let variable = `${this.variable}`;\n    if (this.builtin) {\n      const index = this.index >= 0 ? this.index : \"\";\n      variable = `${variable}[${index}]`;\n    }\n    if (variable.length > this.len + this.lPad + this.rPad) {\n      return variable.substring(0, this.len + this.lPad + this.rPad);\n    }\n    return this.padCenter(variable);\n  }\n\n  print(test: Test) {\n    const val = test.getVar(this.variable, this.index);\n    if (this.fmt === \"S\") {\n      return this.padLeft(val as string);\n    }\n\n    const fmt = { B: bin, D: dec, X: hex }[this.fmt];\n    let value = fmt(val as number);\n    if (this.fmt === \"D\") {\n      return this.padRight(value);\n    } else {\n      return this.padCenter(value.slice(value.length - this.len));\n    }\n  }\n\n  private padCenter(value: string) {\n    const space = this.lPad + this.len + this.rPad;\n    const leftSpace = Math.floor((space - value.length) / 2);\n    const rightSpace = space - leftSpace - value.length;\n    const padLeft = leftSpace + value.length;\n    const padRight = padLeft + rightSpace;\n    value = value.padStart(padLeft);\n    value = value.padEnd(padRight);\n    return value;\n  }\n\n  private padLeft(value: string) {\n    value = value.substring(0, this.len);\n    const padRight = this.rPad + this.len;\n    const padLeft = this.lPad + padRight;\n    value = value.padEnd(padRight);\n    value = value.padStart(padLeft);\n    return value;\n  }\n\n  private padRight(value: string) {\n    value = value.substring(0, this.len);\n    const padLeft = this.lPad + this.len;\n    const padRight = this.rPad + padLeft;\n    value = value.padStart(padLeft);\n    value = value.padEnd(padRight);\n    return value;\n  }\n}\n","import { checkExhaustive } from \"@davidsouther/jiffies/lib/esm/assert\";\nimport { FileSystem } from \"@davidsouther/jiffies/lib/esm/fs\";\nimport { Span } from \"../languages/base\";\nimport {\n  Tst,\n  TstLineStatement,\n  TstOperation,\n  TstOutputSpec,\n  TstStatement,\n} from \"../languages/tst\";\nimport { Bus, Chip, HIGH, Low, LOW } from \"./chip/chip\";\nimport { Clock } from \"./chip/clock\";\nimport { Output } from \"./output\";\n\nexport abstract class Test<IS extends TestInstruction = TestInstruction> {\n  protected readonly instructions: (IS | TestInstruction)[] = [];\n  protected _outputList: Output[] = [];\n  protected _log: string = \"\";\n  fs: FileSystem = new FileSystem();\n\n  setFileSystem(fs: FileSystem) {\n    this.fs = fs;\n  }\n\n  async load(filename: string) {}\n  async compareTo(filename: string) {}\n  outputFile(filename: string): void {}\n  outputList(outputs: Output[]): void {\n    this._outputList = outputs;\n  }\n\n  addInstruction(instruction: IS | TestInstruction) {\n    this.instructions.push(instruction);\n  }\n\n  reset() {\n    this._steps = this.instructions[Symbol.iterator]();\n    this._log = \"\";\n  }\n\n  _steps: IterableIterator<IS | TestInstruction> | undefined;\n  _step: IteratorResult<IS | TestInstruction, IS | TestInstruction> | undefined;\n\n  get steps(): Iterator<IS | TestInstruction> {\n    if (this._steps === undefined) {\n      this.reset();\n    }\n    return this._steps!;\n  }\n\n  get currentStep(): IS | TestInstruction | undefined {\n    return this._step?.value;\n  }\n\n  async step() {\n    this._step = this.steps.next();\n    if (!this._step.done) {\n      await this._step.value.do(this);\n      return true;\n    }\n    return false;\n  }\n\n  async run() {\n    while (await this.step());\n  }\n\n  echo(content: string) {}\n\n  clearEcho() {}\n\n  protected readonly breakpoints: Map<string, number> = new Map();\n  addBreakpoint(variable: string, value: number) {\n    this.breakpoints.set(variable, value);\n  }\n  clearBreakpoints() {\n    this.breakpoints.clear();\n  }\n\n  output() {\n    const values = this._outputList.map((output) => output.print(this));\n    this._log += `|${values.join(\"|\")}|\\n`;\n  }\n\n  header() {\n    const values = this._outputList.map((output) => output.header(this));\n    this._log += `|${values.join(\"|\")}|\\n`;\n  }\n\n  log() {\n    return this._log;\n  }\n\n  abstract hasVar(variable: string | number): boolean;\n  abstract getVar(variable: string | number, offset?: number): number | string;\n  abstract setVar(variable: string, value: number, offset?: number): void;\n}\n\nfunction isTstLineStatment(line: TstStatement): line is TstLineStatement {\n  return (line as TstLineStatement).ops !== undefined;\n}\n\nexport class ChipTest extends Test<ChipTestInstruction> {\n  private chip: Chip = new Low();\n  private clock = Clock.get();\n\n  static from(tst: Tst): ChipTest {\n    const test = new ChipTest();\n\n    for (const line of tst.lines) {\n      if (isTstLineStatment(line)) {\n        test.addInstruction(ChipTest.makeLineStatement(line));\n      } else {\n        const repeat = new TestRepeatInstruction(line.count);\n        test.addInstruction(repeat);\n        for (const statement of line.statements) {\n          repeat.addInstruction(ChipTest.makeLineStatement(statement));\n        }\n      }\n    }\n\n    return test;\n  }\n\n  private static makeLineStatement(line: TstLineStatement) {\n    const statement = new TestCompoundInstruction();\n    statement.span = line.span;\n    for (const op of line.ops) {\n      statement.addInstruction(ChipTest.makeInstruction(op));\n    }\n    return statement;\n  }\n\n  private static makeInstruction(inst: TstOperation) {\n    const { op } = inst;\n    switch (op) {\n      case \"tick\":\n        return new TestTickInstruction();\n      case \"tock\":\n        return new TestTockInstruction();\n      case \"eval\":\n        return new TestEvalInstruction();\n      case \"output\":\n        return new TestOutputInstruction();\n      case \"set\":\n        return new TestSetInstruction(inst.id, inst.value, inst.index);\n      case \"output-list\":\n        return new TestOutputListInstruction(inst.spec);\n      case \"echo\":\n        return new TestEchoInstruction(inst.message);\n      case \"clear-echo\":\n        return new TestClearEchoInstruction();\n      case \"load\":\n        return new TestLoadROMInstruction(inst.file);\n      default:\n        checkExhaustive(op, `Unknown tst operation ${op}`);\n    }\n  }\n\n  with(chip: Chip): this {\n    this.chip = chip;\n    return this;\n  }\n\n  hasVar(variable: string | number): boolean {\n    if (variable === \"time\") {\n      return true;\n    }\n    variable = `${variable}`;\n    // Look up built-in chip state variables\n    return (\n      this.chip.in(variable) !== undefined ||\n      this.chip.out(variable) !== undefined\n    );\n  }\n\n  getVar(variable: string | number, offset?: number): number | string {\n    variable = `${variable}`;\n    if (variable === \"time\") {\n      return this.clock.toString();\n    }\n    const pin = this.chip.get(variable, offset);\n    if (!pin) return 0;\n    return pin instanceof Bus ? pin.busVoltage : pin.voltage();\n  }\n\n  setVar(variable: string, value: number, offset?: number): void {\n    // Look up built-in chip state variables\n    const pinOrBus = this.chip.get(variable, offset);\n    if (pinOrBus instanceof Bus) {\n      pinOrBus.busVoltage = value;\n    } else {\n      pinOrBus?.pull(value === 0 ? LOW : HIGH);\n    }\n  }\n\n  eval(): void {\n    this.chip.eval();\n  }\n\n  tick(): void {\n    this.chip.eval();\n    this.clock.tick();\n  }\n\n  tock(): void {\n    this.chip.eval();\n    this.clock.tock();\n  }\n\n  override async load(filename: string) {\n    await this.chip.load(this.fs, filename);\n  }\n\n  override async run() {\n    this.clock.reset();\n    await super.run();\n  }\n}\n\nexport class CPUTest extends Test<CPUTestInstruction> {\n  hasVar(_variable: string | number): boolean {\n    return false;\n  }\n  getVar(_variable: string | number): number {\n    return 0;\n  }\n  setVar(_variable: string, _value: number): void {}\n  ticktock(): void {}\n}\n\nexport class VMTest extends Test<VMTestInstruction> {\n  hasVar(_variable: string | number): boolean {\n    return false;\n  }\n  getVar(_variable: string | number): number {\n    return 0;\n  }\n  setVar(_variable: string, _value: number): void {}\n  vmstep(): void {}\n}\n\nexport interface TestInstruction {\n  span?: Span;\n  do(test: Test): Promise<void> | void;\n}\n\nexport class TestSetInstruction implements TestInstruction {\n  constructor(\n    private variable: string,\n    private value: number,\n    private index?: number | undefined\n  ) {}\n\n  do(test: Test): void {\n    test.setVar(this.variable, this.value, this.index);\n  }\n}\n\nexport class TestOutputInstruction implements TestInstruction {\n  do(test: Test) {\n    test.output();\n  }\n}\n\nexport class TestOutputListInstruction implements TestInstruction {\n  private outputs: Output[] = [];\n\n  constructor(specs: TstOutputSpec[] = []) {\n    for (const spec of specs) {\n      this.addOutput(spec);\n    }\n  }\n\n  addOutput(inst: TstOutputSpec) {\n    this.outputs.push(\n      new Output(\n        inst.id,\n        inst.style,\n        inst.width,\n        inst.lpad,\n        inst.rpad,\n        inst.builtin,\n        inst.address\n      )\n    );\n  }\n\n  do(test: Test) {\n    test.outputList(this.outputs);\n    test.header();\n  }\n}\n\nexport class TestCompoundInstruction implements TestInstruction {\n  protected readonly instructions: TestInstruction[] = [];\n  span?: Span;\n\n  addInstruction(instruction: TestInstruction) {\n    this.instructions.push(instruction);\n  }\n\n  async do(test: Test) {\n    for (const instruction of this.instructions) {\n      await instruction.do(test);\n    }\n  }\n}\n\nexport class TestRepeatInstruction extends TestCompoundInstruction {\n  constructor(public readonly repeat: number) {\n    super();\n  }\n\n  override async do(test: Test) {\n    for (let i = 0; i < this.repeat; i++) {\n      await super.do(test);\n    }\n  }\n}\n\nexport class Condition {\n  constructor(\n    public readonly x: string | number,\n    public readonly y: string | number,\n    public readonly op: \"<\" | \"<=\" | \"=\" | \">=\" | \">\" | \"<>\"\n  ) {}\n\n  check(test: Test): boolean {\n    const x = test.hasVar(this.x) ? test.getVar(this.x) : this.x;\n    const y = test.hasVar(this.y) ? test.getVar(this.y) : this.y;\n\n    if (typeof x === \"string\" || typeof y === \"string\") {\n      switch (this.op) {\n        case \"=\":\n          return `${x}` === `${y}`;\n        case \"<>\":\n          return `${x}` !== `${y}`;\n      }\n    } else {\n      switch (this.op) {\n        case \"<\":\n          return x < y;\n        case \"<=\":\n          return x <= y;\n        case \">\":\n          return x > y;\n        case \">=\":\n          return x >= y;\n        case \"=\":\n          return x === y;\n        case \"<>\":\n          return x !== y;\n      }\n    }\n    return false;\n  }\n}\n\nexport class TestWhileInstruction extends TestCompoundInstruction {\n  constructor(public readonly condition: Condition) {\n    super();\n  }\n\n  override async do(test: Test) {\n    while (this.condition.check(test)) {\n      for (const instruction of this.instructions) {\n        await instruction.do(test);\n      }\n    }\n  }\n}\n\nexport class TestEchoInstruction implements TestInstruction {\n  constructor(public readonly content: string) {}\n  do(test: Test) {\n    test.echo(this.content);\n  }\n}\n\nexport class TestClearEchoInstruction implements TestInstruction {\n  do(test: Test) {\n    test.clearEcho();\n  }\n}\n\nexport class TestLoadROMInstruction implements TestInstruction {\n  constructor(readonly file: string) {}\n  async do(test: Test) {\n    await test.load(this.file);\n  }\n}\n\nexport class TestBreakpointInstruction implements TestInstruction {\n  constructor(readonly variable: string, readonly value: number) {}\n\n  do(test: Test) {\n    test.addBreakpoint(this.variable, this.value);\n  }\n}\n\nexport class TestClearBreakpointsInstruction implements TestInstruction {\n  do(test: Test) {\n    test.clearBreakpoints();\n  }\n}\n\nexport interface ChipTestInstruction extends TestInstruction {\n  _chipTestInstruction_: true;\n  do(test: ChipTest): Promise<void> | void;\n}\n\nexport class TestEvalInstruction implements ChipTestInstruction {\n  readonly _chipTestInstruction_ = true;\n  do(test: ChipTest) {\n    test.eval();\n  }\n}\n\nexport class TestTickInstruction implements ChipTestInstruction {\n  readonly _chipTestInstruction_ = true;\n  do(test: ChipTest) {\n    test.tick();\n  }\n}\n\nexport class TestTockInstruction implements ChipTestInstruction {\n  readonly _chipTestInstruction_ = true;\n  do(test: ChipTest) {\n    test.tock();\n  }\n}\n\nexport interface CPUTestInstruction extends TestInstruction {\n  _cpuTestInstruction_: true;\n  do(test: CPUTest): Promise<void> | void;\n}\n\nexport class TestTickTockInstruction implements CPUTestInstruction {\n  readonly _cpuTestInstruction_ = true;\n  do(test: CPUTest) {\n    test.ticktock();\n  }\n}\n\nexport interface VMTestInstruction extends TestInstruction {\n  _vmTestInstruction_: true;\n  do(test: VMTest): Promise<void> | void;\n}\n\nexport class TestVMStepInstruction implements VMTestInstruction {\n  readonly _vmTestInstruction_ = true;\n  do(test: VMTest) {\n    test.vmstep();\n  }\n}\n","import {\n  FileSystem,\n  LocalStorageFileSystemAdapter,\n} from \"@davidsouther/jiffies/lib/esm/fs\";\nimport { createContext } from \"react\";\n\nexport const StorageContext = createContext(\n  new FileSystem(new LocalStorageFileSystemAdapter())\n);\n","import { Err, isErr, Ok } from \"@davidsouther/jiffies/lib/esm/result\";\nimport { display } from \"@davidsouther/jiffies/lib/esm/display\";\nimport { t } from \"@lingui/macro\";\nimport { Dispatch, MutableRefObject, useContext, useMemo, useRef } from \"react\";\n\nimport { HDL } from \"../languages/hdl\";\nimport { TST } from \"../languages/tst\";\nimport { build as buildChip } from \"../simulator/chip/builder\";\nimport { getBuiltinChip } from \"../simulator/chip/builtins/index\";\nimport { Low, Pin, Chip as SimChip, Chip } from \"../simulator/chip/chip\";\nimport { Clock } from \"../simulator/chip/clock\";\nimport { ChipTest } from \"../simulator/tst\";\nimport { StorageContext } from \"../util/storage\";\nimport { AppContext } from \"../App.context\";\nimport { ImmPin, reducePins } from \"../components/pinout\";\nimport { REGISTRY } from \"../simulator/chip/builtins\";\nimport { FileSystem } from \"@davidsouther/jiffies/lib/esm/fs\";\nimport { Span } from \"../languages/base\";\nimport { useImmerReducer } from \"../util/react\";\n\nexport const PROJECT_NAMES = [\n  [\"01\", t`Project 1`],\n  [\"02\", t`Project 2`],\n  [\"03\", t`Project 3`],\n  [\"05\", t`Project 5`],\n];\n\nexport const PROJECTS: Record<\"01\" | \"02\" | \"03\" | \"05\", string[]> = {\n  \"01\": [\n    \"Not\",\n    \"And\",\n    \"Or\",\n    \"XOr\",\n    \"Mux\",\n    \"DMux\",\n    \"Not16\",\n    \"And16\",\n    \"Or16\",\n    \"Mux16\",\n    \"Mux4Way16\",\n    \"Mux8Way16\",\n    \"DMux4Way\",\n    \"DMux8Way\",\n    \"Or8Way\",\n  ],\n  \"02\": [\"HalfAdder\", \"FullAdder\", \"Add16\", \"Inc16\", \"AluNoStat\", \"ALU\"],\n  \"03\": [\"Bit\", \"Register\", \"PC\", \"RAM8\", \"RAM64\", \"RAM512\", \"RAM4k\", \"RAM16k\"],\n  \"05\": [\"Memory\", \"CPU\", \"Computer\"],\n};\n\nfunction dropdowns(storage: Record<string, string>) {\n  const project = (storage[\"/chip/project\"] as keyof typeof PROJECTS) ?? \"01\";\n  const chips = PROJECTS[project];\n  const chipName = storage[\"/chip/chip\"] ?? chips[0];\n  return { project, chips, chipName };\n}\n\nfunction makeHdl(name: string) {\n  return `CHIP ${name} {\n    IN in;\n    OUT out;\n    PARTS:\n  }`;\n}\n\nfunction makeTst() {\n  return `repeat 10 {\n      tick,\n      tock;\n    }`;\n}\n\nfunction makeCmp() {\n  return `| in|out|`;\n}\n\nexport interface ChipPageState {\n  files: Files;\n  sim: ChipSim;\n  controls: ControlsState;\n}\n\nexport interface ChipSim {\n  clocked: boolean;\n  inPins: ImmPin[];\n  outPins: ImmPin[];\n  internalPins: ImmPin[];\n  parts: Set<Chip>;\n  pending: boolean;\n  invalid: boolean;\n}\n\nexport interface Files {\n  hdl: string;\n  cmp: string;\n  tst: string;\n  out: string;\n}\n\nexport interface ControlsState {\n  project: keyof typeof PROJECTS;\n  chips: string[];\n  chipName: string;\n  hasBuiltin: boolean;\n  runningTest: boolean;\n  span?: Span;\n}\n\nfunction reduceChip(chip: SimChip, pending = false, invalid = false): ChipSim {\n  return {\n    clocked: chip.clocked,\n    inPins: reducePins(chip.ins),\n    outPins: reducePins(chip.outs),\n    internalPins: reducePins(chip.pins),\n    parts: new Set(chip.parts),\n    pending,\n    invalid,\n  };\n}\n\nconst clock = Clock.get();\n\nexport type ChipStoreDispatch = Dispatch<{\n  action: keyof ReturnType<typeof makeChipStore>[\"reducers\"];\n  payload?: {};\n}>;\n\nexport function makeChipStore(\n  fs: FileSystem,\n  setStatus: (status: string) => void,\n  storage: Record<string, string>,\n  dispatch: MutableRefObject<ChipStoreDispatch>\n) {\n  let { project, chips, chipName } = dropdowns(storage);\n  let chip = new Low();\n  let test = new ChipTest();\n\n  const initialState: ChipPageState = (() => {\n    const controls: ControlsState = {\n      project,\n      chips,\n      chipName,\n      hasBuiltin: REGISTRY.has(chipName),\n      runningTest: false,\n    };\n\n    let maybeChip = getBuiltinChip(controls.chipName);\n    if (isErr(maybeChip)) {\n      setStatus(display(Err(maybeChip)));\n    } else {\n      chip = Ok(maybeChip);\n    }\n\n    const sim = reduceChip(chip);\n\n    setTimeout(() => {\n      actions.reloadChip();\n    });\n\n    return {\n      controls,\n      files: {\n        hdl: \"\",\n        cmp: \"\",\n        tst: \"\",\n        out: \"\",\n      },\n      sim,\n    };\n  })();\n\n  const reducers = {\n    setFiles(\n      state: ChipPageState,\n      {\n        hdl = state.files.hdl,\n        tst = state.files.tst,\n        cmp = state.files.cmp,\n        out = \"\",\n      }: {\n        hdl?: string;\n        tst?: string;\n        cmp?: string;\n        out?: string;\n      }\n    ) {\n      state.files.hdl = hdl;\n      state.files.tst = tst;\n      state.files.cmp = cmp;\n      state.files.out = out;\n    },\n\n    updateChip(\n      state: ChipPageState,\n      payload?: { pending?: boolean; invalid?: boolean }\n    ) {\n      state.sim = reduceChip(chip, payload?.pending, payload?.invalid);\n      state.controls.chips = PROJECTS[state.controls.project];\n      state.controls.chipName = chip.name ?? chipName;\n      if (!state.controls.chips.includes(state.controls.chipName)) {\n        state.controls.chips = [\n          ...state.controls.chips,\n          state.controls.chipName,\n        ];\n      }\n    },\n\n    setProject(state: ChipPageState, project: keyof typeof PROJECTS) {\n      const chips = PROJECTS[project];\n      const chipName =\n        state.controls.chipName && chips.includes(state.controls.chipName)\n          ? state.controls.chipName\n          : chips[0];\n      state.controls.project = project;\n      state.controls.chips = chips;\n      this.setChip(state, chipName);\n    },\n\n    setChip(state: ChipPageState, chipName: string) {\n      state.controls.chipName = chipName;\n      state.controls.hasBuiltin = REGISTRY.has(chipName);\n    },\n\n    testRunning(state: ChipPageState) {\n      state.controls.runningTest = true;\n    },\n    testFinished(state: ChipPageState) {\n      state.controls.runningTest = false;\n    },\n    updateTestStep(state: ChipPageState) {\n      state.files.out = test?.log() ?? \"\";\n      state.controls.span = test?.currentStep?.span;\n      this.updateChip(state, {\n        pending: state.sim.pending,\n        invalid: state.sim.invalid,\n      });\n    },\n  };\n\n  const actions = {\n    setProject(p: keyof typeof PROJECTS) {\n      project = storage[\"/chip/project\"] = p;\n      dispatch.current({ action: \"setProject\", payload: project });\n      this.setChip(PROJECTS[project][0]);\n    },\n\n    setChip(chip: string, project = storage[\"/chip/project\"]) {\n      chipName = storage[\"/chip/chip\"] = chip;\n      dispatch.current({ action: \"setChip\", payload: chipName });\n      this.loadChip(project, chipName);\n    },\n\n    reset() {\n      Clock.get().reset();\n      chip.reset();\n      test.reset();\n      dispatch.current({ action: \"setFiles\", payload: {} });\n      dispatch.current({ action: \"updateChip\" });\n    },\n\n    updateFiles({ hdl, tst, cmp }: { hdl: string; tst: string; cmp: string }) {\n      dispatch.current({ action: \"setFiles\", payload: { hdl, tst, cmp } });\n      try {\n        this.compileChip(hdl);\n        this.compileTest(tst);\n      } catch (e) {\n        setStatus(display(e));\n      }\n    },\n\n    compileChip(hdl: string) {\n      chip.remove();\n      const maybeParsed = HDL.parse(hdl);\n      if (isErr(maybeParsed)) {\n        setStatus(\"Failed to parse chip\");\n        dispatch.current({ action: \"updateChip\", payload: { invalid: true } });\n        return;\n      }\n      const maybeChip = buildChip(Ok(maybeParsed));\n      if (isErr(maybeChip)) {\n        setStatus(display(Err(maybeChip)));\n        dispatch.current({ action: \"updateChip\", payload: { invalid: true } });\n        return;\n      }\n      setStatus(t`Compiled ${chip.name}`);\n      this.replaceChip(Ok(maybeChip));\n    },\n\n    replaceChip(nextChip: SimChip) {\n      // Store current inPins\n      const inPins = chip.ins;\n      for (const [pin, { busVoltage }] of inPins) {\n        if (nextChip.ins.has(pin)) {\n          nextChip.ins.get(pin)!.busVoltage = busVoltage;\n        }\n      }\n      nextChip.eval();\n      chip = nextChip;\n      dispatch.current({ action: \"updateChip\" });\n    },\n\n    async loadChip(project: string, name: string) {\n      storage[\"/chip/chip\"] = name;\n      const fsName = (ext: string) =>\n        `/projects/${project}/${name}/${name}.${ext}`;\n\n      const [hdl, tst, cmp] = await Promise.all([\n        fs.readFile(fsName(\"hdl\")).catch(() => makeHdl(name)),\n        fs.readFile(fsName(\"tst\")).catch(() => makeTst()),\n        fs.readFile(fsName(\"cmp\")).catch(() => makeCmp()),\n      ]);\n\n      dispatch.current({ action: \"setFiles\", payload: { hdl, tst, cmp } });\n      this.compileChip(hdl);\n      this.compileTest(tst);\n    },\n\n    async saveChip(hdl: string, prj = project, name = chipName) {\n      dispatch.current({ action: \"setFiles\", payload: { hdl } });\n      const path = `/projects/${prj}/${name}/${name}.hdl`;\n      await fs.writeFile(path, hdl);\n      setStatus(`Saved ${path}`);\n    },\n\n    toggle(pin: Pin, i: number | undefined) {\n      if (i !== undefined) {\n        pin.busVoltage = pin.busVoltage ^ (1 << i);\n      } else {\n        if (pin.width === 1) {\n          pin.toggle();\n        } else {\n          pin.busVoltage += 1;\n        }\n      }\n      dispatch.current({ action: \"updateChip\", payload: { pending: true } });\n    },\n\n    eval() {\n      chip.eval();\n      dispatch.current({ action: \"updateChip\" });\n    },\n\n    clock() {\n      clock.toggle();\n      dispatch.current({ action: \"updateChip\" });\n    },\n\n    useBuiltin() {\n      const nextChip = getBuiltinChip(chipName);\n      if (isErr(nextChip)) {\n        setStatus(\n          `Failed to load builtin ${chipName}: ${display(Err(nextChip))}`\n        );\n        return;\n      }\n      this.replaceChip(Ok(nextChip));\n    },\n\n    reloadChip() {\n      this.loadChip(project, chipName);\n    },\n\n    compileTest(file: string) {\n      dispatch.current({ action: \"setFiles\", payload: { tst: file } });\n      const tst = TST.parse(file);\n\n      if (isErr(tst)) {\n        setStatus(t`Failed to parse test`);\n        return false;\n      }\n      setStatus(t`Parsed tst`);\n\n      test = ChipTest.from(Ok(tst)).with(chip);\n      test.setFileSystem(fs);\n      dispatch.current({ action: \"updateTestStep\" });\n      return true;\n    },\n\n    async runTest(file: string) {\n      if (!this.compileTest(file)) {\n        return;\n      }\n      dispatch.current({ action: \"testRunning\" });\n\n      fs.pushd(\"/samples\");\n      await test.run();\n      fs.popd();\n\n      dispatch.current({ action: \"updateTestStep\" });\n    },\n\n    async tick() {\n      await test.step();\n    },\n  };\n\n  return { initialState, reducers, actions };\n}\n\nexport function useChipPageStore() {\n  const fs = useContext(StorageContext);\n  const { setStatus } = useContext(AppContext);\n  const storage: Record<string, string> = useMemo(() => localStorage, []);\n\n  const dispatch = useRef<ChipStoreDispatch>(() => {});\n\n  const { initialState, reducers, actions } = useMemo(\n    () => makeChipStore(fs, setStatus, storage, dispatch),\n    [fs, setStatus, storage, dispatch]\n  );\n\n  const [state, dispatcher] = useImmerReducer(reducers, initialState);\n  dispatch.current = dispatcher;\n\n  return { state, dispatch, actions };\n}\n","import ohm from \"ohm-js\";\nimport raw from \"raw.macro\";\nimport { grammars, makeParser, baseSemantics } from \"./base\";\n\nexport type Cell = string;\nexport type Line = Cell[];\nexport type Cmp = Line[];\n\nexport const cmpGrammar = raw(\"./grammars/cmp.ohm\");\nexport const grammar = ohm.grammar(cmpGrammar, grammars);\nexport const cmpSemantics = grammar.extendSemantics(baseSemantics);\n\ncmpSemantics.addAttribute<Cell>(\"cell\", {\n  cell(value, _) {\n    return value.sourceString;\n  },\n});\n\ncmpSemantics.addAttribute<Line>(\"line\", {\n  line(_a, cells, _b) {\n    return cells.children.map((c) => c.cell);\n  },\n});\n\ncmpSemantics.addAttribute<Cmp>(\"root\", {\n  Root(lines) {\n    return lines.children.map((c) => c.line);\n  },\n});\n\nexport const CMP = {\n  grammar: cmpGrammar,\n  semantics: cmpSemantics,\n  parser: grammar,\n  parse: makeParser<Cmp>(grammar, cmpSemantics),\n};\n","import { Plural, Trans } from \"@lingui/macro\";\nimport { Err, isErr, Ok } from \"@davidsouther/jiffies/lib/esm/result\";\nimport { display } from \"@davidsouther/jiffies/lib/esm/display\";\nimport { range } from \"@davidsouther/jiffies/lib/esm/range\";\nimport { CMP } from \"../languages/cmp\";\n\nexport const DiffTable = ({\n  className = \"\",\n  out,\n  cmp,\n}: {\n  out: string;\n  cmp: string;\n  className?: string;\n}) => {\n  const output = CMP.parse(out);\n  const compare = CMP.parse(cmp);\n\n  if (isErr(output)) {\n    return (\n      <details>\n        <summary>\n          <Trans>Failed to parse output</Trans>\n        </summary>\n        <pre>{display(Err(output))}</pre>\n        <code>\n          <pre>{out}</pre>\n        </code>\n      </details>\n    );\n  }\n\n  if (isErr(compare)) {\n    return (\n      <details>\n        <summary>\n          <Trans>Failed to parse compare</Trans>\n        </summary>\n        <code>\n          <pre>{display(Err(compare))}</pre>\n          <pre>{cmp}</pre>\n        </code>\n      </details>\n    );\n  }\n\n  const cmpData = Ok(compare);\n  const outData = Ok(output);\n  let failures = 0;\n  const table = range(0, Math.max(cmpData.length, outData.length)).map((i) => {\n    const cmpI = cmpData[i] ?? [];\n    const outI = outData[i] ?? [];\n    return range(0, Math.max(cmpI.length, outI.length))\n      .map((_, j) => [cmpI[j] ?? \"\", outI[j] ?? \"\"])\n      .map(([cmp, out]) => {\n        const cell = {\n          cmp: cmp ?? '\"',\n          out: out ?? '\"',\n          pass:\n            cmp?.trim().match(/^\\*+$/) !== null || out?.trim() === cmp?.trim(),\n        };\n        if (!cell.pass) {\n          failures += 1;\n        }\n        return cell;\n      });\n  });\n\n  return (\n    <div className={\"scroll-x \" + className}>\n      <p>\n        <Plural\n          value={failures}\n          one={`${failures} failure`}\n          other={`${failures} failures`}\n        />\n      </p>\n      <table\n        style={{\n          fontFamily: \"var(--font-family-monospace)\",\n          marginBottom: \"none\",\n        }}\n      >\n        <tbody>\n          {table.map((row, i) => (\n            <tr key={i}>\n              {row.map(({ cmp, out, pass }, i) => (\n                <DiffCell cmp={cmp} out={out} pass={pass} key={i} />\n              ))}\n            </tr>\n          ))}\n        </tbody>\n      </table>\n    </div>\n  );\n};\n\nconst DiffCell = ({\n  cmp,\n  out,\n  pass,\n}: {\n  cmp: string;\n  out: string;\n  pass: boolean;\n}) => {\n  return pass ? (\n    <>\n      <td>{cmp}</td>\n      <td></td>\n    </>\n  ) : (\n    <>\n      <td>\n        <ins>{cmp}</ins>\n      </td>\n      <td>\n        <del>{out}</del>\n      </td>\n    </>\n  );\n};\n","import { debounce } from \"@davidsouther/jiffies/lib/esm/debounce\";\nimport { Trans } from \"@lingui/macro\";\nimport MonacoEditor, { useMonaco } from \"@monaco-editor/react\";\nimport * as monacoT from \"monaco-editor/esm/vs/editor/editor.api\";\nimport { OnMount } from \"@monaco-editor/react\";\nimport ohm from \"ohm-js\";\nimport {\n  CSSProperties,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { AppContext } from \"../App.context\";\n\nimport { Span, UNKNOWN_PARSE_ERROR } from \"../languages/base\";\n\nimport \"./editor.scss\";\n\nexport const ErrorPanel = ({ error }: { error?: ohm.MatchResult }) => {\n  return error?.failed() ? (\n    <details className=\"ErrorPanel\" open>\n      <summary role=\"button\" className=\"secondary\">\n        <Trans>Parse Error</Trans>\n      </summary>\n      <pre>\n        <code>\n          {error?.message ?? error?.shortMessage ?? UNKNOWN_PARSE_ERROR}\n        </code>\n      </pre>\n    </details>\n  ) : (\n    <></>\n  );\n};\n\nconst Textarea = ({\n  value,\n  onChange,\n  language,\n  disabled = false,\n}: {\n  value: string;\n  onChange: (value: string) => void;\n  language: string;\n  disabled?: boolean;\n}) => {\n  const [text, setText] = useState(value);\n  return (\n    <textarea\n      data-testid={`editor-${language}`}\n      disabled={disabled}\n      value={text}\n      onChange={(e) => {\n        const value = e.target?.value;\n        setText(value);\n        onChange(value);\n      }}\n    />\n  );\n};\n\nconst Monaco = ({\n  value,\n  onChange,\n  language,\n  error,\n  disabled = false,\n  highlight,\n}: {\n  value: string;\n  onChange: (value: string) => void;\n  language: string;\n  error?: ohm.MatchResult | undefined;\n  disabled?: boolean;\n  highlight?: Span;\n}) => {\n  const { theme } = useContext(AppContext);\n  const monaco = useMonaco();\n\n  const editor = useRef<monacoT.editor.IStandaloneCodeEditor>();\n  const decorations = useRef<string[]>([]);\n\n  // Set options when mounting\n  const onMount: OnMount = useCallback((ed) => {\n    editor.current = ed;\n    editor.current?.updateOptions({\n      fontFamily: `\"JetBrains Mono\", source-code-pro, Menlo, Monaco,\n      Consolas, \"Roboto Mono\", \"Ubuntu Monospace\", \"Noto Mono\", \"Oxygen Mono\",\n      \"Liberation Mono\", monospace, \"Apple Color Emoji\", \"Segoe UI Emoji\",\n      \"Segoe UI Symbol\", \"Noto Color Emoji\"`,\n      fontSize: 16,\n      minimap: {\n        enabled: false,\n      },\n    });\n  }, []);\n\n  // Mark and center highlighted spans\n  useEffect(() => {\n    if (!editor.current) return;\n    const model = editor.current.getModel();\n    const nextDecoration: monacoT.editor.IModelDeltaDecoration[] = [];\n    if (model && highlight) {\n      const start = model.getPositionAt(highlight.start);\n      const end = model.getPositionAt(highlight.end);\n      const range = monaco?.Range.fromPositions(start, end);\n      if (range) {\n        nextDecoration.push({\n          range,\n          options: { inlineClassName: \"highlight\" },\n        });\n        editor.current.revealRangeInCenter(range);\n      }\n    }\n    decorations.current = editor.current.deltaDecorations(\n      decorations.current,\n      nextDecoration\n    );\n  }, [editor, highlight, monaco]);\n\n  // Set themes\n  useEffect(() => {\n    const isDark =\n      theme === \"system\"\n        ? window.matchMedia(\"prefers-color-scheme: dark\").matches\n        : theme === \"dark\";\n    editor.current?.updateOptions({\n      theme: isDark ? \"vs-dark\" : \"vs\",\n    });\n  }, [editor, theme]);\n\n  // Prevent editing disabled editors\n  useEffect(() => {\n    if (editor.current === undefined) return;\n    editor.current.updateOptions({ readOnly: disabled });\n  }, [editor, disabled]);\n\n  // Add error markers on parse failure\n  useEffect(() => {\n    if (editor.current === undefined) return;\n    if (monaco === null) return;\n    const model = editor.current.getModel();\n    if (model === null) return;\n    if (error === undefined || error.succeeded()) {\n      monaco.editor.setModelMarkers(model, language, []);\n      return;\n    }\n    // Line 7, col 5:\n    const { line, column, message } =\n      /Line (?<line>\\d+), col (?<column>\\d+): (?<message>.*)/.exec(\n        error.shortMessage ?? \"\"\n      )?.groups ?? { line: 1, column: 1, message: \"could not parse error\" };\n    const startLineNumber = Number(line);\n    const endLineNumber = startLineNumber;\n    const startColumn = Number(column);\n    const restOfLine = model\n      .getLineContent(startLineNumber)\n      .substring(startColumn - 1);\n    let endColumn =\n      startColumn + (restOfLine.match(/([^\\s]+)/)?.[0].length ?? 1);\n    if (endColumn <= startColumn) {\n      endColumn = startColumn + 1;\n    }\n\n    monaco.editor.setModelMarkers(model, language, [\n      {\n        message,\n        startColumn,\n        startLineNumber,\n        endColumn,\n        endLineNumber,\n        severity: monacoT.MarkerSeverity.Error,\n      },\n    ]);\n  }, [error, editor, monaco, language]);\n\n  return (\n    <>\n      <MonacoEditor\n        value={value}\n        onChange={(v = \"\") => onChange(v)}\n        language={language}\n        onMount={onMount}\n      />\n      {disabled && <div className=\"overlay\" />}\n    </>\n  );\n};\n\nexport const Editor = ({\n  className = \"\",\n  style = {},\n  disabled = false,\n  value,\n  onChange,\n  grammar,\n  language,\n  highlight,\n}: {\n  className?: string;\n  style?: CSSProperties;\n  disabled?: boolean;\n  value: string;\n  onChange: (source: string) => void;\n  grammar: ohm.Grammar;\n  language: string;\n  highlight?: Span;\n}) => {\n  const [error, setError] = useState<ohm.MatchResult>();\n  const { monaco } = useContext(AppContext);\n\n  const parse = useCallback(\n    (text: string = \"\") => {\n      const parsed = grammar.match(text);\n      setError(parsed.failed() ? parsed : undefined);\n    },\n    [setError, grammar]\n  );\n\n  useEffect(() => parse(value), [parse, value]);\n  const doParse = useMemo(() => debounce(parse, 500), [parse]);\n\n  const onChangeCB = useCallback(\n    (text: string = \"\") => {\n      onChange(text);\n      doParse(text);\n    },\n    [doParse, onChange]\n  );\n\n  return (\n    <div className={`Editor ${className}`} style={style}>\n      {monaco.canUse && monaco.wants ? (\n        <Monaco\n          value={value}\n          onChange={onChangeCB}\n          language={language}\n          error={error}\n          disabled={disabled}\n          highlight={highlight}\n        />\n      ) : (\n        <>\n          <Textarea\n            value={value}\n            onChange={onChangeCB}\n            language={language}\n            disabled={disabled}\n          />\n          <ErrorPanel error={error} />\n        </>\n      )}\n    </div>\n  );\n};\n","import { Trans } from \"@lingui/macro\";\nimport { ReactNode } from \"react\";\nimport { Chip } from \"../../simulator/chip/chip\";\n\nexport const Visualizations = ({ parts }: { parts: Set<Chip> }) => {\n  const visualizations: [string, ReactNode][] = [...parts].flatMap((part) =>\n    part.render().map((v, i) => [`${part.id}_${i}`, v] as [string, ReactNode])\n  );\n\n  if (visualizations.length === 0) {\n    return <Trans>None</Trans>;\n  }\n\n  return (\n    <>\n      {visualizations.map(([p, v]) => (\n        <div key={p}>{v}</div>\n      ))}\n    </>\n  );\n};\n","import { Dispatch, MutableRefObject, useMemo, useRef } from \"react\";\nimport { useImmerReducer } from \"../util/react\";\n\nexport const MAX_STEPS = 1000;\n\nexport abstract class Timer {\n  frame() {\n    this.tick();\n    this.finishFrame();\n  }\n\n  abstract tick(): void;\n\n  abstract finishFrame(): void;\n\n  abstract reset(): void;\n\n  abstract toggle(): void;\n\n  steps = 1; // How many steps to take per update\n  speed = 1000; // how often to update, in ms\n  get running() {\n    return this.#running;\n  }\n\n  #running = false;\n  #sinceLastFrame = 0;\n  #lastUpdate = 0;\n  #run = () => {\n    if (!this.#running) {\n      return;\n    }\n    const now = Date.now();\n    const delta = now - this.#lastUpdate;\n    this.#lastUpdate = now;\n    this.#sinceLastFrame += delta;\n    if (this.#sinceLastFrame > this.speed) {\n      for (let i = 0; i < Math.min(this.steps, MAX_STEPS); i++) {\n        this.tick();\n      }\n      this.finishFrame();\n      this.#sinceLastFrame -= this.speed;\n    }\n    requestAnimationFrame(this.#run);\n  };\n\n  start() {\n    this.#running = true;\n    this.#lastUpdate = Date.now() - this.speed;\n    this.#run();\n    this.toggle();\n  }\n\n  stop() {\n    this.#running = false;\n    this.toggle();\n  }\n}\n\nexport interface TimerStoreState {\n  steps: number;\n  speed: number;\n  running: boolean;\n}\n\nexport type TimerStoreDispatch = Dispatch<{\n  action: keyof ReturnType<typeof makeTimerStore>[\"reducers\"];\n  payload?: {};\n}>;\n\nconst makeTimerStore = (\n  timer: Timer,\n  dispatch: MutableRefObject<TimerStoreDispatch>\n) => {\n  const initialState: TimerStoreState = {\n    running: timer.running,\n    speed: timer.speed,\n    steps: timer.steps,\n  };\n\n  const finishFrame = timer.finishFrame.bind(timer);\n  timer.finishFrame = function () {\n    finishFrame();\n    dispatch.current({ action: \"update\" });\n  };\n\n  const reducers = {\n    update(state: TimerStoreState) {\n      state.running = timer.running;\n      state.speed = timer.speed;\n      state.steps = timer.steps;\n    },\n    setSteps(state: TimerStoreState, steps: number) {\n      state.steps = steps;\n    },\n    setSpeed(state: TimerStoreState, speed: number) {\n      state.speed = speed;\n    },\n  };\n\n  const actions = {\n    frame() {\n      timer.frame();\n    },\n    start() {\n      timer.start();\n      dispatch.current({ action: \"update\" });\n    },\n    stop() {\n      timer.stop();\n      dispatch.current({ action: \"update\" });\n    },\n    reset() {\n      timer.reset();\n      dispatch.current({ action: \"update\" });\n    },\n  };\n\n  return { initialState, reducers, actions };\n};\n\nexport function useTimer(timer: Timer) {\n  const dispatch = useRef<TimerStoreDispatch>(() => {});\n\n  const { initialState, reducers, actions } = useMemo(\n    () => makeTimerStore(timer, dispatch),\n    [timer, dispatch]\n  );\n\n  const [state, dispatcher] = useImmerReducer(reducers, initialState);\n\n  dispatch.current = dispatcher;\n\n  return { state, dispatch: dispatch.current, actions };\n}\n","import { ReactNode } from \"react\";\nimport { t } from \"@lingui/macro\";\nimport { Timer, useTimer } from \"../simulator/timer\";\nimport { Icon } from \"./pico/icon\";\n\nexport const Runbar = (props: { runner: Timer; children?: ReactNode }) => {\n  const runner = useTimer(props.runner);\n  return (\n    <fieldset role=\"group\">\n      <button\n        className=\"flex-0\"\n        onClick={() => runner.actions.frame()}\n        data-tooltip={t`Next`}\n      >\n        <Icon name=\"skip_next\"></Icon>\n      </button>\n      <button\n        className=\"flex-0\"\n        onClick={() => runner.actions.reset()}\n        data-tooltip={t`Reset`}\n      >\n        <Icon name=\"first_page\"></Icon>\n      </button>\n      <button\n        className=\"flex-0\"\n        onClick={() =>\n          runner.state.running ? runner.actions.stop() : runner.actions.start()\n        }\n        data-tooltip={runner.state.running ? t`Stop` : t`Run`}\n      >\n        <Icon name={runner.state.running ? \"pause\" : \"play_arrow\"}></Icon>\n      </button>\n      <select\n        className=\"flex-1\"\n        name=\"speed\"\n        value={runner.state.speed}\n        onChange={(e) => {\n          runner.dispatch({\n            action: \"setSpeed\",\n            payload: Number(e.target?.value ?? runner.state.speed),\n          });\n        }}\n        disabled={runner.state.running}\n      >\n        {[\n          [16, t`60FPS`],\n          [500, t`Fast`],\n          [1000, t`Normal`],\n          [2000, t`Slow`],\n        ].map(([speed, label]) => (\n          <option key={speed} value={speed}>\n            {label}\n          </option>\n        ))}\n      </select>\n      <select\n        className=\"flex-1\"\n        name=\"steps\"\n        value={runner.state.steps}\n        onChange={(e) => {\n          runner.dispatch({\n            action: \"setSteps\",\n            payload: Number(e.target?.value ?? runner.state.steps),\n          });\n        }}\n        disabled={runner.state.running}\n      >\n        {[\n          [1, t`1 Step`],\n          [500, \"500\"],\n          [1000, \"1000\"],\n          [2000, \"2000\"],\n        ].map(([steps, label]) => (\n          <option key={steps} value={steps}>\n            {label}\n          </option>\n        ))}\n      </select>\n      {props.children}\n    </fieldset>\n  );\n};\n","import { useEffect, useMemo, useRef, useState } from \"react\";\nimport { Trans } from \"@lingui/macro\";\n\nimport \"./chip.scss\";\n\nimport { FullPinout } from \"../components/pinout\";\nimport { Files, PROJECTS, PROJECT_NAMES, useChipPageStore } from \"./chip.store\";\nimport { DiffTable } from \"../components/difftable\";\nimport { Editor } from \"../components/editor\";\nimport { HDL } from \"../languages/hdl\";\nimport { TST } from \"../languages/tst\";\nimport { CMP } from \"../languages/cmp\";\nimport { Visualizations } from \"../components/chips/visualizations\";\nimport { Accordian, Panel } from \"../components/shell/panel\";\nimport { Runbar } from \"../components/runbar\";\nimport { Timer } from \"../simulator/timer\";\nimport { useStateInitializer } from \"../util/react\";\n\nexport const Chip = () => {\n  const { state, actions, dispatch } = useChipPageStore();\n\n  const [hdl, setHdl] = useStateInitializer(state.files.hdl);\n  const [tst, setTst] = useStateInitializer(state.files.tst);\n  const [cmp, setCmp] = useStateInitializer(state.files.cmp);\n  const [out] = useStateInitializer(state.files.out);\n\n  const saveChip = () => {\n    actions.saveChip(hdl);\n  };\n\n  const compile = useRef<(files?: Partial<Files>) => void>(() => {});\n  compile.current = async (files: Partial<Files> = {}) => {\n    await actions.updateFiles({\n      hdl: files.hdl ?? hdl,\n      tst: files.tst ?? tst,\n      cmp: files.cmp ?? cmp,\n    });\n  };\n\n  const runner = useRef<Timer>();\n  useEffect(() => {\n    runner.current = new (class ChipTimer extends Timer {\n      async reset(): Promise<void> {\n        await compile.current();\n        await actions.reset();\n      }\n\n      finishFrame(): void {\n        dispatch.current({ action: \"updateTestStep\" });\n      }\n\n      async tick(): Promise<void> {\n        actions.tick();\n      }\n\n      toggle(): void {\n        dispatch.current({ action: \"updateTestStep\" });\n      }\n    })();\n\n    return () => {\n      runner.current?.stop();\n    };\n  }, [compile, actions, dispatch]);\n\n  const clockActions = useMemo(\n    () => ({\n      toggle() {\n        actions.clock();\n      },\n      reset() {\n        actions.reset();\n      },\n    }),\n    [actions]\n  );\n\n  const [useBuiltin, setUseBuiltin] = useState(false);\n  const toggleUseBuiltin = async () => {\n    if (useBuiltin) {\n      compile.current();\n      setUseBuiltin(false);\n    } else {\n      actions.useBuiltin();\n      setUseBuiltin(true);\n    }\n  };\n\n  const selectors = (\n    <>\n      <div>\n        <Trans>Chip</Trans>\n      </div>\n      <fieldset role=\"group\">\n        <select\n          value={state.controls.project}\n          onChange={({ target: { value } }) => {\n            actions.setProject(value as keyof typeof PROJECTS);\n          }}\n          data-testid=\"project-picker\"\n        >\n          {PROJECT_NAMES.map(([number, label]) => (\n            <option key={number} value={number}>\n              {label}\n            </option>\n          ))}\n        </select>\n        <select\n          value={state.controls.chipName}\n          onChange={({ target: { value } }) => {\n            actions.setChip(value);\n          }}\n          data-testid=\"chip-picker\"\n        >\n          {state.controls.chips.map((chip) => (\n            <option key={chip} value={chip}>\n              {chip}\n            </option>\n          ))}\n        </select>\n      </fieldset>\n      <fieldset role=\"group\">\n        <button\n          onClick={actions.eval}\n          onKeyDown={actions.eval}\n          disabled={!state.sim.pending}\n        >\n          <Trans>Eval</Trans>\n        </button>\n      </fieldset>\n    </>\n  );\n  const hdlPanel = (\n    <Panel\n      className=\"_hdl_panel\"\n      header={\n        <>\n          <div tabIndex={0}>HDL</div>\n          <fieldset>\n            {state.controls.hasBuiltin && (\n              <label>\n                <input\n                  type=\"checkbox\"\n                  role=\"switch\"\n                  checked={useBuiltin}\n                  onChange={toggleUseBuiltin}\n                />\n                <Trans>Builtin</Trans>\n              </label>\n            )}\n          </fieldset>\n          <fieldset role=\"group\">\n            <button onClick={saveChip} disabled={useBuiltin}>\n              <Trans>Save</Trans>\n            </button>\n          </fieldset>\n        </>\n      }\n    >\n      <Editor\n        className=\"flex-1\"\n        value={hdl}\n        onChange={(source) => {\n          setHdl(source);\n          compile.current({ hdl: source });\n        }}\n        grammar={HDL.parser}\n        language={\"hdl\"}\n        disabled={useBuiltin}\n      />\n    </Panel>\n  );\n\n  const pinsPanel = (\n    <Panel className=\"_parts_panel\" header={selectors}>\n      {state.sim.invalid ? (\n        <Trans>Invalid Chip</Trans>\n      ) : (\n        <>\n          <FullPinout\n            sim={state.sim}\n            toggle={actions.toggle}\n            clockActions={clockActions}\n          />\n          <Accordian summary={<Trans>Visualizations</Trans>} open={true}>\n            <main>\n              <Visualizations parts={state.sim.parts} />\n            </main>\n          </Accordian>\n        </>\n      )}\n    </Panel>\n  );\n\n  const testPanel = (\n    <Panel className=\"_test_panel\">\n      <Accordian\n        summary={\n          <>\n            <div className=\"flex-1\">\n              <Trans>Test</Trans>\n            </div>\n            <div className=\"flex-2\">\n              {runner.current && <Runbar runner={runner.current} />}\n            </div>\n          </>\n        }\n        style={{ position: \"relative\" }}\n      >\n        <Editor\n          style={{\n            position: \"absolute\",\n            height: \"calc(100% - var(--line-height) * var(--font-size) * 2)\",\n          }}\n          value={tst}\n          onChange={setTst}\n          grammar={TST.parser}\n          language={\"tst\"}\n          highlight={state.controls.span}\n        />\n      </Accordian>\n      <Accordian\n        summary={<Trans>Compare File</Trans>}\n        style={{ position: \"relative\" }}\n      >\n        <Editor\n          style={{\n            position: \"absolute\",\n            height: \"calc(100% - var(--line-height) * var(--font-size) * 2)\",\n          }}\n          value={cmp}\n          onChange={setCmp}\n          grammar={CMP.parser}\n          language={\"cmp\"}\n        />\n      </Accordian>\n      <Accordian summary={<Trans>Output File</Trans>} open={true}>\n        <div style={{ paddingLeft: \"var(--block-spacing-horizontal)\" }}>\n          <DiffTable cmp={cmp} out={out} />\n        </div>\n      </Accordian>\n    </Panel>\n  );\n\n  return (\n    <div className=\"ChipPage grid\">\n      {hdlPanel}\n      {pinsPanel}\n      {testPanel}\n    </div>\n  );\n};\n\nexport default Chip;\n","export type COMMANDS_ASM =\n  | \"0\"\n  | \"1\"\n  | \"-1\"\n  | \"D\"\n  | \"A\"\n  | \"M\"\n  | \"!D\"\n  | \"!A\"\n  | \"-D\"\n  | \"-A\"\n  | \"D+1\"\n  | \"A+1\"\n  | \"D-1\"\n  | \"A-1\"\n  | \"D+A\"\n  | \"D-A\"\n  | \"D-M\"\n  | \"A-D\"\n  | \"D&A\"\n  | \"D&M\"\n  | \"D|A\"\n  | \"D|M\";\n\nexport type COMMANDS_OP =\n  | 0b101010\n  | 0b111111\n  | 0b111010\n  | 0b001100\n  | 0b110000\n  | 0b110000\n  | 0b001101\n  | 0b110001\n  | 0b001111\n  | 0b110011\n  | 0b011111\n  | 0b110111\n  | 0b001110\n  | 0b110010\n  | 0b000010\n  | 0b010011\n  | 0b010011\n  | 0b000111\n  | 0b000000\n  | 0b000000\n  | 0b010101\n  | 0b010101;\n\nexport const COMMANDS: {\n  asm: Record<COMMANDS_ASM, COMMANDS_OP>;\n  op: Record<COMMANDS_OP, COMMANDS_ASM>;\n} = {\n  asm: {\n    \"0\": 0b101010, // 42 0x2A\n    \"1\": 0b111111, // 63 0x3F\n    \"-1\": 0b111010, // 58 0x3A\n    D: 0b001100, // 12 0x0C\n    A: 0b110000, // 48 0x30\n    M: 0b110000, // 48 0x30\n    \"!D\": 0b001101, // 13 0x0D\n    \"!A\": 0b110001, // 49 0x31\n    \"-D\": 0b001111, // 15 0x0F\n    \"-A\": 0b110011, // 51 0x33\n    \"D+1\": 0b011111, // 31 0x1F\n    \"A+1\": 0b110111, // 55 0x37\n    \"D-1\": 0b001110, // 14 0x0E\n    \"A-1\": 0b110010, // 50 0x32\n    \"D+A\": 0b000010, //  2 0x02\n    \"D-A\": 0b010011, // 19 0x13\n    \"D-M\": 0b010011, // 19 0x13\n    \"A-D\": 0b000111, //  7 0x07\n    \"D&A\": 0b000000, //  0 0x00\n    \"D&M\": 0b000000, //  0 0x00\n    \"D|A\": 0b010101, // 21 0x15\n    \"D|M\": 0b010101, // 21 0x15\n  },\n  op: {\n    0x2a: \"0\",\n    0x3f: \"1\",\n    0x3a: \"-1\",\n    0x0c: \"D\",\n    0x30: \"A\",\n    0x0d: \"!D\",\n    0x31: \"!A\",\n    0x0f: \"-D\",\n    0x33: \"-A\",\n    0x1f: \"D+1\",\n    0x37: \"A+1\",\n    0x0e: \"D-1\",\n    0x32: \"A-1\",\n    0x02: \"D+A\",\n    0x13: \"D-A\",\n    0x07: \"A-D\",\n    0x00: \"D&A\",\n    0x15: \"D|A\",\n  },\n};\n\nexport type ASSIGN_ASM = \"\" | \"M\" | \"D\" | \"MD\" | \"A\" | \"AM\" | \"AD\" | \"AMD\";\nexport type ASSIGN_OP = 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7;\n\nexport const ASSIGN: {\n  asm: Record<ASSIGN_ASM, ASSIGN_OP>;\n  op: Record<ASSIGN_OP, ASSIGN_ASM>;\n} = {\n  asm: {\n    \"\": 0x0,\n    M: 0b001,\n    D: 0b010,\n    MD: 0b011,\n    A: 0b100,\n    AM: 0b101,\n    AD: 0b110,\n    AMD: 0b111,\n  },\n  op: {\n    0x0: \"\",\n    0x1: \"M\",\n    0x2: \"D\",\n    0x3: \"MD\",\n    0x4: \"A\",\n    0x5: \"AM\",\n    0x6: \"AD\",\n    0x7: \"AMD\",\n  },\n};\n\nexport type JUMP_ASM =\n  | \"\"\n  | \"JGT\"\n  | \"JEQ\"\n  | \"JGE\"\n  | \"JLT\"\n  | \"JNE\"\n  | \"JLE\"\n  | \"JMP\";\nexport type JUMP_OP = 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7;\nexport const JUMP: {\n  asm: Record<JUMP_ASM, JUMP_OP>;\n  op: Record<JUMP_OP, JUMP_ASM>;\n} = {\n  asm: {\n    \"\": 0b0,\n    JGT: 0b001,\n    JEQ: 0b010,\n    JGE: 0b011,\n    JLT: 0b100,\n    JNE: 0b101,\n    JLE: 0b110,\n    JMP: 0b111,\n  },\n  op: {\n    0x0: \"\",\n    0x1: \"JGT\",\n    0x2: \"JEQ\",\n    0x3: \"JGE\",\n    0x4: \"JLT\",\n    0x5: \"JNE\",\n    0x6: \"JLE\",\n    0x7: \"JMP\",\n  },\n};\n\nexport const Flags = {\n  0x01: \"Positive\",\n  0x00: \"Zero\",\n  0x0f: \"Negative\",\n  Positive: 0x01,\n  Zero: 0x00,\n  Negative: 0x0f,\n};\n\nexport function alu(op: number, d: number, a: number): [number, number] {\n  let o = 0;\n  switch (op) {\n    case 0x2a:\n      o = 0;\n      break;\n    case 0x3f:\n      o = 1;\n      break;\n    case 0x3a:\n      o = -1;\n      break;\n    case 0x0c:\n      o = d;\n      break;\n    case 0x30:\n      o = a;\n      break;\n    case 0x0d:\n      o = ~d;\n      break;\n    case 0x31:\n      o = ~a;\n      break;\n    case 0x0f:\n      o = -d;\n      break;\n    case 0x33:\n      o = -a;\n      break;\n    case 0x1f:\n      o = d + 1;\n      break;\n    case 0x37:\n      o = a + 1;\n      break;\n    case 0x0e:\n      o = d - 1;\n      break;\n    case 0x32:\n      o = a - 1;\n      break;\n    case 0x02:\n      o = d + a;\n      break;\n    case 0x13:\n      o = d - a;\n      break;\n    case 0x07:\n      o = a - d;\n      break;\n    case 0x00:\n      o = d & a;\n      break;\n    case 0x15:\n      o = d | a;\n      break;\n  }\n\n  o = o & 0xffff;\n  const flags =\n    o === 0 ? Flags.Zero : o & 0x8000 ? Flags.Negative : Flags.Positive;\n  return [o, flags];\n}\n","import {\n  ASSIGN,\n  ASSIGN_ASM,\n  ASSIGN_OP,\n  COMMANDS,\n  COMMANDS_ASM,\n  COMMANDS_OP,\n  JUMP,\n  JUMP_ASM,\n  JUMP_OP,\n} from \"../simulator/cpu/alu\";\n\nexport type CommandOps = keyof typeof COMMANDS.op;\nexport type JumpOps = keyof typeof JUMP.op;\nexport type StoreOps = keyof typeof ASSIGN.op;\n\nexport function asm(op: number): string {\n  if (op & 0x8000) {\n    return cInstruction(op);\n  }\n  return aInstruction(op);\n}\n\nfunction cInstruction(op: number): string {\n  op = op & 0xffff; // Clear high order bits\n  const mop = (op & 0x1000) >> 12;\n  let cop: CommandOps = ((op & 0b0000111111000000) >> 6) as CommandOps;\n  let sop: StoreOps = ((op & 0b0000000000111000) >> 3) as StoreOps;\n  let jop: JumpOps = (op & 0b0000000000000111) as JumpOps;\n\n  if (COMMANDS.op[cop] === undefined) {\n    // Invalid commend\n    return \"#ERR\";\n  }\n\n  let command = COMMANDS.op[cop];\n  if (mop) {\n    command = command.replace(/A/g, \"M\") as COMMANDS_ASM;\n  }\n\n  const store = ASSIGN.op[sop];\n  const jump = JUMP.op[jop];\n\n  let instruction: string = command;\n  if (store) {\n    instruction = `${store}=${instruction}`;\n  }\n  if (jump) {\n    instruction = `${instruction};${jump}`;\n  }\n\n  return instruction;\n}\n\nfunction aInstruction(op: number): string {\n  return \"@\" + (op & 0x7fff).toString(10);\n}\n\nexport function op(asm: string): number {\n  if (asm[0] === \"@\") {\n    return aop(asm);\n  } else {\n    return cop(asm);\n  }\n}\n\nfunction aop(asm: string): number {\n  return parseInt(asm.substring(1), 10);\n}\n\nfunction cop(asm: string): number {\n  let parts = asm.match(\n    /(?:(?<assign>[AMD]{1,3})=)?(?<operation>[-!01ADM&|]{1,3})(?:;(?<jump>JGT|JLT|JGE|JLE|JEQ|JMP))?/\n  );\n  const { assign, operation, jump } = parts?.groups ?? {};\n  const mode = operation.includes(\"M\") || assign.includes(\"M\");\n  const aop = ASSIGN.asm[(assign as ASSIGN_ASM) ?? \"\"];\n  const jop = JUMP.asm[(jump as JUMP_ASM) ?? \"\"];\n  const cop = COMMANDS.asm[(operation as COMMANDS_ASM) ?? \"\"];\n\n  return makeC(mode, cop, aop, jop);\n}\n\nexport function makeC(\n  isM: boolean,\n  op: COMMANDS_OP,\n  assign: ASSIGN_OP = 0,\n  jmp: JUMP_OP = 0\n): number {\n  const C = 0xe000;\n  const A = isM ? 0x1000 : 0;\n  const O = op << 6;\n  const D = (assign ?? 0) << 3;\n  const J = jmp ?? 0;\n  return C + A + O + D + J;\n}\n","const Hex = [\n  \"0\",\n  \"1\",\n  \"2\",\n  \"3\",\n  \"4\",\n  \"5\",\n  \"6\",\n  \"7\",\n  \"8\",\n  \"9\",\n  \"A\",\n  \"B\",\n  \"C\",\n  \"D\",\n  \"E\",\n  \"F\",\n];\n\nexport function chars(i: number): string {\n  return Hex[i] ?? \"X\";\n}\n\nexport function bits(i: number): string {\n  switch (i) {\n    case 0x0:\n      return \"0000\";\n    case 0x1:\n      return \"0001\";\n    case 0x2:\n      return \"0010\";\n    case 0x3:\n      return \"0011\";\n    case 0x4:\n      return \"0100\";\n    case 0x5:\n      return \"0101\";\n    case 0x6:\n      return \"0110\";\n    case 0x7:\n      return \"0111\";\n    case 0x8:\n      return \"1000\";\n    case 0x9:\n      return \"1001\";\n    case 0xa:\n      return \"1010\";\n    case 0xb:\n      return \"1011\";\n    case 0xc:\n      return \"1100\";\n    case 0xd:\n      return \"1101\";\n    case 0xe:\n      return \"1110\";\n    case 0xf:\n      return \"1111\";\n    default:\n      return \"erro\";\n  }\n}\n\nexport function int(n: string, radix: number): number {\n  let i = parseInt(n.replace(/[^\\d+-.xa-fA-F]/g, \"\"), radix);\n  return i & 0xffff;\n}\n\nexport function int16(i: string): number {\n  return int(i, 16);\n}\n\nexport function int10(i: string): number {\n  return int(i, 10);\n}\n\nexport function int2(i: string): number {\n  return int(i, 2);\n}\n\nexport function hex(i: number): string {\n  const hu = chars((i & 0xf000) >> 12);\n  const hl = chars((i & 0x0f00) >> 8);\n  const lu = chars((i & 0x00f0) >> 4);\n  const ll = chars(i & 0x000f);\n\n  return `0x${hu}${hl}${lu}${ll}`;\n}\n\nexport function bin(i: number, precision = 16): string {\n  const hu = bits((i & 0xf000) >> 12);\n  const hl = bits((i & 0x0f00) >> 8);\n  const lu = bits((i & 0x00f0) >> 4);\n  const ll = bits(i & 0x000f);\n\n  // return `${hu} ${hl} ${lu} ${ll}`;\n  return `${hu}${hl}${lu}${ll}`.substring(16 - precision); // Match the book's formatting\n}\n\nexport function dec(i: number): string {\n  i = i & 0xffff;\n  if (i === 0x8000) {\n    return \"-32768\";\n  }\n  if (i & 0x8000) {\n    i = (~i + 1) & 0x7fff;\n    return `-${i}`;\n  }\n  return `${i}`;\n}\n\nexport function uns(i: number): string {\n  i = i & 0xffff;\n  return `${i}`;\n}\n\nexport function nand16(a: number, b: number): number {\n  a = a & 0xffff;\n  b = b & 0xffff;\n  let c = ~(a & b);\n  c = c & 0xffff;\n  return c;\n}\n"],"names":["Bus","name","width","state","next","this","range","map","newWidth","assert","push","busVoltage","voltage","bit","forEach","n","pull","reduce","b","i","nextVoltage","InSubBus","bus","start","connect","mask","high","low","mid","OutSubBus","ConstantBus","value","TRUE_BUS","FALSE_BUS","parsePinDecl","toPin","match","groups","pin","w","Number","Symbol","iterator","Pins","Map","has","set","minWidth","get","insert","values","id","Chip","ins","outs","internals","clocked","pins","parts","Set","clockedPins","inn","undefined","out","internal","Clock","$","subscribe","eval","size","offset","getBuiltin","BUILTIN_NAMES","includes","part","connections","add","to","from","isOutPin","wireOutPin","wireInPin","render","filter","v","toLowerCase","emplace","partPin","assertExists","chipPin","findPin","isInternal","Error","ensureWidth","remove","fs","path","load","Low","ClockedChip","level","tock","tick","unsubscribe","Math","pow","clock","ticks","subject","BehaviorSubject","update","Subject","Clockface","clockface","useState","display","setClockface","useEffect","subscription","useClockface","style","whiteSpace","reducePin","bits","reverse","reducePins","entries","FullPinout","props","sim","inPins","outPins","internalPins","className","ClockPinoutBlock","clockActions","PinoutBlock","header","length","toggle","disabled","pending","colSpan","immPin","Pin","role","onClick","maxWidth","reset","UNKNOWN_PARSE_ERROR","grammars","Base","ohm","baseSemantics","createSemantics","makeParser","grammar","semantics","property","root","source","succeeded","parsed","parse","Ok","Err","message","shortMessage","e","extendOperation","List","list","_","asIteration","addAttribute","decNumber","digits","int10","sourceString","wholeDec","binNumber","int2","hexNumber","int16","num","identifier","__","Name","child","String","_a","str","_b","hdlGrammar","hdlSemantics","extendSemantics","SubBus","startNode","endNode","end","WireSide","index","Wire","left","right","rhs","isTerminal","lhs","Wires","children","Part","_c","wires","Parts","c","BuiltinPart","PartList","ClockedList","PinDecl","PinList","body","Clocked","Root","HDL","parser","tstGrammar","tstSemantics","extendAttribute","Index","idx","FileName","_dot","ext","_open","dec","_close","OutputFormat","lpad","rpad","builtin","address","TstEvalOperation","op","TstOutputOperation","TstOutputListOperation","formats","spec","format","TstSetOperation","setOp","TstEchoOperation","TstClearEchoOperation","TstLoadROMOperation","_r","_l","file","TstRepeat","_o","statements","count","statement","TstStatement","stmt","ops","operation","span","startIdx","endIdx","break","Tst","lines","tst","TST","And","a","and","in","And16","and16","DMux","sel","dmux","DMux4Way","dmux4way","d","DMux8Way","dmux8way","f","g","h","mux16","mux16_4","s2","Mux","mux","Mux16","Mux4Way16","Mux8Way16","mux16_8","Nand","nand","Nand16","nand16","Not","Not16","or","Or","Or16","or16","Or8way","Xor","xor","Xor16","xor16","add16","Add16","ALUComponent","A","D","flag","bin","COMMANDS","Flags","ALUNoStat","x","y","alu","ALU","flags","ng","zr","halfAdder","HalfAdder","sum","carry","FullAdder","s","ca","fullAdder","Inc16","RegisterComponent","Bit","Register","VRegister","PC","DFF","t","asmGrammar","asmSemantics","isALabelInstruction","inst","label","asm","instructions","instruction","AInstruction","_at","val","type","CInstruction","assignN","opN","jmpN","assign","jmp","isM","jump","JUMP","store","ASSIGN","Label","ASM","passes","fillLabel","symbols","SCREEN","KEYBOARD","unfilled","line","emit","makeC","endsWith","loadHack","loadAsm","readFile","isErr","split","trim","FORMATS","Memory","memory","Int16Array","cell","current","isFinite","slice","fn","useImmerReducer","reducers","initialState","useReducer","command","produce","draft","action","payload","useStateInitializer","init","setState","Mode","mode","setMode","setValue","view","cursor","doSelect","useCallback","ref","select","doChange","target","onChange","edit","position","zIndex","marginTop","onBlur","onKeyPress","key","defaultValue","doScroll","scrollTop","totalHeight","toleranceHeight","bufferedItems","settings","itemHeight","minIndex","maxIndex","floor","data","limit","max","min","getData","topPaddingHeight","bottomPaddingHeight","viewportRef","useRef","useMemo","MAX_SAFE_INTEGER","startIndex","tolerance","fillVirtualScrollSettings","startState","adapter","viewportHeight","reducer","scrollReducer","dispatchScroll","row","initialScroll","div","rows","height","rowKey","overflowY","overflowAnchor","onScroll","MemoryBlock","highlight","editable","MemoryCell","rounded","background","hex","flex","textAlign","newValue","fmt","setFormat","setJmp","goto","setGoto","jumpTo","useContext","AppContext","filePicker","setStatus","doLoad","console","error","placeholder","onKeyDown","option","checked","doFormat","RAM","nextData","MemoryChip","RamBus","ram","RAM8","RAM64","RAM512","RAM4K","RAM16K","Panel","join","footer","Accordian","open","summary","WHITE","pixel","color","Screen","canvas","ctx","getContext","image","getImageData","col","putImageData","boxSizing","marginInline","margin","borderTop","borderLeft","borderBottom","borderRight","KeyMap","Enter","Backspace","ArrowLeft","ArrowUp","ArrowRight","ArrowDown","Home","End","PageUp","PageDown","Insert","Delete","Escape","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","Keyboard","keyboard","showPicker","setShowPicker","setBits","setKey","event","keypress","code","charCodeAt","keyPressToHackCharacter","preventDefault","changeKey","focus","BITS","decode","x1","x2","am","d1","d2","d3","j1","j2","j3","cpuTick","inM","cpuTock","alu2","addressM","outM","writeM","ROM32K","at","OFFSET","screen","startsWith","CPU","cpuInput","output","Computer","wire","REGISTRY","ChipCtor","chip","getBuiltinChip","pinWidth","build","toString","buildChip","partChip","Output","variable","len","lPad","rPad","parseInt","test","substring","padCenter","getVar","padLeft","B","X","padRight","space","leftSpace","rightSpace","padStart","padEnd","Test","_outputList","_log","FileSystem","_steps","_step","breakpoints","filename","outputs","steps","done","do","step","content","clear","print","isTstLineStatment","ChipTest","pinOrBus","addInstruction","makeLineStatement","repeat","TestRepeatInstruction","TestCompoundInstruction","makeInstruction","TestTickInstruction","TestTockInstruction","TestEvalInstruction","TestOutputInstruction","TestSetInstruction","TestOutputListInstruction","TestEchoInstruction","TestClearEchoInstruction","TestLoadROMInstruction","checkExhaustive","setVar","specs","addOutput","outputList","echo","clearEcho","_chipTestInstruction_","StorageContext","createContext","LocalStorageFileSystemAdapter","PROJECT_NAMES","PROJECTS","makeHdl","reduceChip","invalid","makeChipStore","storage","dispatch","project","chips","chipName","dropdowns","controls","hasBuiltin","runningTest","maybeChip","setTimeout","actions","reloadChip","files","hdl","cmp","setFiles","updateChip","setProject","setChip","testRunning","testFinished","updateTestStep","log","currentStep","p","loadChip","updateFiles","compileChip","compileTest","maybeParsed","replaceChip","nextChip","fsName","Promise","all","catch","saveChip","prj","writeFile","useBuiltin","with","setFileSystem","runTest","pushd","run","popd","cmpGrammar","cmpSemantics","cells","CMP","DiffTable","compare","cmpData","outData","failures","table","cmpI","outI","j","pass","fontFamily","marginBottom","DiffCell","ErrorPanel","failed","Textarea","language","text","setText","Monaco","theme","monaco","useMonaco","editor","decorations","onMount","ed","updateOptions","fontSize","minimap","enabled","model","getModel","nextDecoration","getPositionAt","Range","fromPositions","options","inlineClassName","revealRangeInCenter","deltaDecorations","isDark","window","matchMedia","matches","readOnly","setModelMarkers","exec","column","startLineNumber","endLineNumber","startColumn","endColumn","getLineContent","severity","monacoT","Editor","setError","doParse","debounce","onChangeCB","canUse","wants","Visualizations","visualizations","flatMap","Timer","speed","now","Date","delta","finishFrame","requestAnimationFrame","Runbar","runner","timer","running","bind","setSteps","setSpeed","frame","stop","makeTimerStore","dispatcher","useTimer","localStorage","useChipPageStore","setHdl","setTst","setCmp","compile","setUseBuiltin","toggleUseBuiltin","selectors","number","hdlPanel","tabIndex","pinsPanel","testPanel","paddingLeft","M","MD","AM","AD","AMD","JGT","JEQ","JGE","JLT","JNE","JLE","JMP","Positive","Zero","Negative","o","mop","cop","sop","jop","replace","cInstruction","aInstruction","aop","C","O","J","Hex","chars","int","radix","hu","hl","lu","ll","precision","uns"],"sourceRoot":""}